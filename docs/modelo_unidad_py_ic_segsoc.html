<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 9 08_Modelo_unidad_py_ic_segsoc | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024</title>
  <meta name="description" content="Manual de procesamiento." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 9 08_Modelo_unidad_py_ic_segsoc | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Manual de procesamiento." />
  <meta name="github-repo" content="psirusteam/coneval" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 9 08_Modelo_unidad_py_ic_segsoc | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024" />
  
  <meta name="twitter:description" content="Manual de procesamiento." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero" />


<meta name="date" content="2024-07-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modelo_unidad_py_ic_ali_nc.html"/>
<link rel="next" href="postbenchmarking_ictpc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Taller de instalación de capacidades en SAE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="respositodio-de-códigos.html"><a href="respositodio-de-códigos.html"><i class="fa fa-check"></i>Respositodio de códigos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="librerias-de-r-y-otros-insumos.html"><a href="librerias-de-r-y-otros-insumos.html"><i class="fa fa-check"></i>Librerias de <em>R</em> y otros insumos</a>
<ul>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html"><i class="fa fa-check"></i>Librerías Utilizadas</a>
<ul>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#manipulación-y-transformación-de-datos"><i class="fa fa-check"></i>Manipulación y Transformación de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#lectura-y-escritura-de-datos"><i class="fa fa-check"></i>Lectura y Escritura de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#análisis-de-datos-de-encuestas"><i class="fa fa-check"></i>Análisis de Datos de Encuestas</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#modelado-y-análisis-estadístico"><i class="fa fa-check"></i>Modelado y Análisis Estadístico</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#visualización-de-datos"><i class="fa fa-check"></i>Visualización de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#informes-y-reproducibilidad"><i class="fa fa-check"></i>Informes y Reproducibilidad</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#integración-con-otros-lenguajes"><i class="fa fa-check"></i>Integración con Otros Lenguajes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bases-de-datos-utilizadas.html"><a href="bases-de-datos-utilizadas.html"><i class="fa fa-check"></i>Bases de Datos Utilizadas</a></li>
<li class="chapter" data-level="" data-path="estructura-del-proyecto.html"><a href="estructura-del-proyecto.html"><i class="fa fa-check"></i>Estructura del Proyecto</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="union_bases.html"><a href="union_bases.html"><i class="fa fa-check"></i><b>1</b> 00_union_bases.R</a></li>
<li class="chapter" data-level="2" data-path="descarga_satelitales.html"><a href="descarga_satelitales.html"><i class="fa fa-check"></i><b>2</b> 01_Descarga_satelitales.R</a></li>
<li class="chapter" data-level="3" data-path="union_predictores.html"><a href="union_predictores.html"><i class="fa fa-check"></i><b>3</b> 02_Union_predictores.R</a></li>
<li class="chapter" data-level="4" data-path="estandarizar_muestra_cuestionario_ampliado.html"><a href="estandarizar_muestra_cuestionario_ampliado.html"><i class="fa fa-check"></i><b>4</b> 03_Estandarizar_muestra_cuestionario_ampliado.R</a></li>
<li class="chapter" data-level="5" data-path="armonizar_encuesta.html"><a href="armonizar_encuesta.html"><i class="fa fa-check"></i><b>5</b> 04_Armonizar_encuesta.R</a></li>
<li class="chapter" data-level="6" data-path="validacion_encuestas.html"><a href="validacion_encuestas.html"><i class="fa fa-check"></i><b>6</b> 05_Validacion_encuestas.R</a></li>
<li class="chapter" data-level="7" data-path="modelo_unidad_ictpc.html"><a href="modelo_unidad_ictpc.html"><i class="fa fa-check"></i><b>7</b> 06_Modelo_unidad_ictpc.R</a></li>
<li class="chapter" data-level="8" data-path="modelo_unidad_py_ic_ali_nc.html"><a href="modelo_unidad_py_ic_ali_nc.html"><i class="fa fa-check"></i><b>8</b> 07_Modelo_unidad_py_ic_ali_nc.R</a></li>
<li class="chapter" data-level="9" data-path="modelo_unidad_py_ic_segsoc.html"><a href="modelo_unidad_py_ic_segsoc.html"><i class="fa fa-check"></i><b>9</b> 08_Modelo_unidad_py_ic_segsoc</a></li>
<li class="chapter" data-level="10" data-path="postbenchmarking_ictpc.html"><a href="postbenchmarking_ictpc.html"><i class="fa fa-check"></i><b>10</b> 09_PostBenchmarking_ictpc.R</a></li>
<li class="chapter" data-level="11" data-path="postbenchmarking_ic_ali_nc.html"><a href="postbenchmarking_ic_ali_nc.html"><i class="fa fa-check"></i><b>11</b> 10_PostBenchmarking_ic_ali_nc.R</a></li>
<li class="chapter" data-level="12" data-path="postbenchmarking_ic_segsoc.html"><a href="postbenchmarking_ic_segsoc.html"><i class="fa fa-check"></i><b>12</b> 11_PostBenchmarking_ic_segsoc.r</a></li>
<li class="chapter" data-level="13" data-path="imputacion_censal.html"><a href="imputacion_censal.html"><i class="fa fa-check"></i><b>13</b> 12_Imputacion_censal.R</a></li>
<li class="chapter" data-level="14" data-path="estimacion_ent_02.html"><a href="estimacion_ent_02.html"><i class="fa fa-check"></i><b>14</b> 13_Estimacion_ent_02.R</a></li>
<li class="chapter" data-level="15" data-path="estimacion_municipios_ipm_pobreza.html"><a href="estimacion_municipios_ipm_pobreza.html"><i class="fa fa-check"></i><b>15</b> 14_estimacion_municipios_ipm_pobreza.R</a></li>
<li class="chapter" data-level="16" data-path="estimacion_municipios_ipm_pobreza_error.html"><a href="estimacion_municipios_ipm_pobreza_error.html"><i class="fa fa-check"></i><b>16</b> 15_estimacion_municipios_ipm_pobreza_error.R</a></li>
<li class="chapter" data-level="17" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i><b>17</b> 16_Mapas.R</a></li>
<li class="chapter" data-level="18" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html"><i class="fa fa-check"></i><b>18</b> 17_estimacion_municipios_carencias.R</a></li>
<li class="chapter" data-level="19" data-path="estimacion_municipios_carencias_error.html"><a href="estimacion_municipios_carencias_error.html"><i class="fa fa-check"></i><b>19</b> 18_estimacion_municipios_carencias_error.R</a></li>
<li class="chapter" data-level="20" data-path="mapas_carencias.html"><a href="mapas_carencias.html"><i class="fa fa-check"></i><b>20</b> 19_Mapas_carencias.R</a></li>
<li class="divider"></li>
<li><a Taller de instalación de capacidades en SAE </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelo_unidad_py_ic_segsoc" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Capítulo 9</span> 08_Modelo_unidad_py_ic_segsoc<a href="modelo_unidad_py_ic_segsoc.html#modelo_unidad_py_ic_segsoc" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Para la ejecución del presente análisis, se debe abrir el archivo <strong>08_Modelo_unidad_py_ic_segsoc.R</strong> disponible en la ruta <code>Rcodes/2020/08_Modelo_unidad_py_ic_segsoc.R</code>.</p>
<p>Este script en R se enfoca en la creación de un modelo multinivel para analizar la carencia en por cobertura de seguridad social usando datos de encuestas y censos. El proceso inicia con la limpieza del entorno de trabajo y la carga de librerías esenciales para el análisis. Se define el límite de memoria con <code>memory.limit(10000000)</code> para asegurar suficiente espacio durante el procesamiento de datos. Luego, se cargan los datos necesarios (<code>encuesta_sta</code>, <code>censo_sta</code>, <code>statelevel_predictors_df</code>) y se excluyen ciertas variables de los datos de predictores.</p>
<p>La selección de variables relevantes para el modelo se realiza a través de un procedimiento comentado que emplea la técnica de Recursive Feature Elimination (RFE) usando un modelo Random Forest implementado en Python. Las variables seleccionadas se listan explícitamente y se combinan con otras covariantes para formar cov_names. Posteriormente, se construye una fórmula del modelo (<code>formula_model</code>) que incluye efectos aleatorios para cve_mun, hlengua y discapacidad, y efectos fijos para las demás variables, considerando tanto la variabilidad dentro de cada grupo como las características específicas de cada variable.</p>
<p>El ajuste del modelo se realiza mediante la función modelo_dummy, transformando la variable de interés (<code>ic_segsoc</code>) en formato binario y utilizando los datos de encuesta y censo junto con la fórmula del modelo y las variables de agregación. Los resultados del modelo se guardan en un archivo RDS (<code>fit_mrp_ic_segsoc.rds</code>) y se documentan para futuros análisis. Esto incluye la exportación de los resultados del modelo multinivel y la creación de visualizaciones pertinentes para evaluar el desempeño del modelo y la distribución de las predicciones.</p>
<div id="limpieza-del-entorno-y-carga-de-bibliotecas-5" class="section level4 unnumbered hasAnchor">
<h4>Limpieza del Entorno y Carga de Bibliotecas<a href="modelo_unidad_py_ic_segsoc.html#limpieza-del-entorno-y-carga-de-bibliotecas-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se limpia el entorno de R y se cargan las bibliotecas necesarias para el análisis, incluyendo <code>reticulate</code> para interactuar con Python.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="modelo_unidad_py_ic_segsoc.html#cb53-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>())</span>
<span id="cb53-2"><a href="modelo_unidad_py_ic_segsoc.html#cb53-2" tabindex="-1"></a></span>
<span id="cb53-3"><a href="modelo_unidad_py_ic_segsoc.html#cb53-3" tabindex="-1"></a><span class="co"># Loading required libraries ----------------------------------------------</span></span>
<span id="cb53-4"><a href="modelo_unidad_py_ic_segsoc.html#cb53-4" tabindex="-1"></a></span>
<span id="cb53-5"><a href="modelo_unidad_py_ic_segsoc.html#cb53-5" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb53-6"><a href="modelo_unidad_py_ic_segsoc.html#cb53-6" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb53-7"><a href="modelo_unidad_py_ic_segsoc.html#cb53-7" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb53-8"><a href="modelo_unidad_py_ic_segsoc.html#cb53-8" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb53-9"><a href="modelo_unidad_py_ic_segsoc.html#cb53-9" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb53-10"><a href="modelo_unidad_py_ic_segsoc.html#cb53-10" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb53-11"><a href="modelo_unidad_py_ic_segsoc.html#cb53-11" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb53-12"><a href="modelo_unidad_py_ic_segsoc.html#cb53-12" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb53-13"><a href="modelo_unidad_py_ic_segsoc.html#cb53-13" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb53-14"><a href="modelo_unidad_py_ic_segsoc.html#cb53-14" tabindex="-1"></a></span>
<span id="cb53-15"><a href="modelo_unidad_py_ic_segsoc.html#cb53-15" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;pandas&quot;</span>)</span>
<span id="cb53-16"><a href="modelo_unidad_py_ic_segsoc.html#cb53-16" tabindex="-1"></a>sklearn_fs <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;sklearn.feature_selection&quot;</span>)</span>
<span id="cb53-17"><a href="modelo_unidad_py_ic_segsoc.html#cb53-17" tabindex="-1"></a>sklearn_ensemble <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;sklearn.ensemble&quot;</span>)</span></code></pre></div>
</div>
<div id="carga-de-datos-2" class="section level4 unnumbered hasAnchor">
<h4>Carga de Datos<a href="modelo_unidad_py_ic_segsoc.html#carga-de-datos-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se cargan los datos de la encuesta, el censo y los predictores a nivel estatal.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="modelo_unidad_py_ic_segsoc.html#cb54-1" tabindex="-1"></a><span class="fu">memory.limit</span>(<span class="dv">10000000</span>)</span>
<span id="cb54-2"><a href="modelo_unidad_py_ic_segsoc.html#cb54-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../source/modelos_freq.R&quot;</span>)</span>
<span id="cb54-3"><a href="modelo_unidad_py_ic_segsoc.html#cb54-3" tabindex="-1"></a><span class="co"># Loading data ------------------------------------------------------------</span></span>
<span id="cb54-4"><a href="modelo_unidad_py_ic_segsoc.html#cb54-4" tabindex="-1"></a></span>
<span id="cb54-5"><a href="modelo_unidad_py_ic_segsoc.html#cb54-5" tabindex="-1"></a><span class="fu">memory.limit</span>(<span class="dv">10000000</span>)</span>
<span id="cb54-6"><a href="modelo_unidad_py_ic_segsoc.html#cb54-6" tabindex="-1"></a>encuesta_sta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/enigh/encuesta_sta.rds&quot;</span>)</span>
<span id="cb54-7"><a href="modelo_unidad_py_ic_segsoc.html#cb54-7" tabindex="-1"></a>censo_sta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/muestra_ampliada/muestra_cuestionario_ampliado.rds&quot;</span>)</span>
<span id="cb54-8"><a href="modelo_unidad_py_ic_segsoc.html#cb54-8" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/predictores/statelevel_predictors_df.rds&quot;</span>)</span>
<span id="cb54-9"><a href="modelo_unidad_py_ic_segsoc.html#cb54-9" tabindex="-1"></a></span>
<span id="cb54-10"><a href="modelo_unidad_py_ic_segsoc.html#cb54-10" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">names</span>(statelevel_predictors_df)</span>
<span id="cb54-11"><a href="modelo_unidad_py_ic_segsoc.html#cb54-11" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> cov_names[<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">x =</span> cov_names, <span class="at">pattern =</span> <span class="st">&quot;^hog_|cve_mun&quot;</span>)]</span></code></pre></div>
</div>
<div id="selección-de-variables-2" class="section level4 unnumbered hasAnchor">
<h4>Selección de Variables<a href="modelo_unidad_py_ic_segsoc.html#selección-de-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se definen las variables de agregación y se seleccionan las variables predictoras más relevantes.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="modelo_unidad_py_ic_segsoc.html#cb55-1" tabindex="-1"></a><span class="do">## Selección de variables</span></span>
<span id="cb55-2"><a href="modelo_unidad_py_ic_segsoc.html#cb55-2" tabindex="-1"></a></span>
<span id="cb55-3"><a href="modelo_unidad_py_ic_segsoc.html#cb55-3" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span></span>
<span id="cb55-4"><a href="modelo_unidad_py_ic_segsoc.html#cb55-4" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;ent&quot;</span>,</span>
<span id="cb55-5"><a href="modelo_unidad_py_ic_segsoc.html#cb55-5" tabindex="-1"></a>    <span class="st">&quot;cve_mun&quot;</span>,</span>
<span id="cb55-6"><a href="modelo_unidad_py_ic_segsoc.html#cb55-6" tabindex="-1"></a>    <span class="st">&quot;area&quot;</span>,</span>
<span id="cb55-7"><a href="modelo_unidad_py_ic_segsoc.html#cb55-7" tabindex="-1"></a>    <span class="st">&quot;sexo&quot;</span>,</span>
<span id="cb55-8"><a href="modelo_unidad_py_ic_segsoc.html#cb55-8" tabindex="-1"></a>    <span class="st">&quot;edad&quot;</span>,</span>
<span id="cb55-9"><a href="modelo_unidad_py_ic_segsoc.html#cb55-9" tabindex="-1"></a>    <span class="st">&quot;discapacidad&quot;</span>,</span>
<span id="cb55-10"><a href="modelo_unidad_py_ic_segsoc.html#cb55-10" tabindex="-1"></a>    <span class="st">&quot;hlengua&quot;</span>,</span>
<span id="cb55-11"><a href="modelo_unidad_py_ic_segsoc.html#cb55-11" tabindex="-1"></a>    <span class="st">&quot;nivel_edu&quot;</span> )</span>
<span id="cb55-12"><a href="modelo_unidad_py_ic_segsoc.html#cb55-12" tabindex="-1"></a></span>
<span id="cb55-13"><a href="modelo_unidad_py_ic_segsoc.html#cb55-13" tabindex="-1"></a><span class="co"># encuesta_sta2 &lt;- encuesta_sta %&gt;%   mutate(</span></span>
<span id="cb55-14"><a href="modelo_unidad_py_ic_segsoc.html#cb55-14" tabindex="-1"></a><span class="co">#   yk = as.factor(ifelse(ic_asegsoc == 1 ,1,0))) %&gt;%</span></span>
<span id="cb55-15"><a href="modelo_unidad_py_ic_segsoc.html#cb55-15" tabindex="-1"></a><span class="co">#   inner_join(statelevel_predictors_df[, c(&quot;cve_mun&quot;,cov_names)])</span></span>
<span id="cb55-16"><a href="modelo_unidad_py_ic_segsoc.html#cb55-16" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-17"><a href="modelo_unidad_py_ic_segsoc.html#cb55-17" tabindex="-1"></a><span class="co"># table(encuesta_sta2$yk, encuesta_sta2$ic_segsoc)</span></span>
<span id="cb55-18"><a href="modelo_unidad_py_ic_segsoc.html#cb55-18" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-19"><a href="modelo_unidad_py_ic_segsoc.html#cb55-19" tabindex="-1"></a><span class="co"># # Convertir &#39;encuesta_sta2&#39; a un dataframe de Python</span></span>
<span id="cb55-20"><a href="modelo_unidad_py_ic_segsoc.html#cb55-20" tabindex="-1"></a><span class="co"># encuesta_sta2_py &lt;- pd$DataFrame(encuesta_sta2)</span></span>
<span id="cb55-21"><a href="modelo_unidad_py_ic_segsoc.html#cb55-21" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-22"><a href="modelo_unidad_py_ic_segsoc.html#cb55-22" tabindex="-1"></a><span class="co"># # Obtener &#39;X&#39; y &#39;y&#39; del dataframe de Python</span></span>
<span id="cb55-23"><a href="modelo_unidad_py_ic_segsoc.html#cb55-23" tabindex="-1"></a><span class="co"># X &lt;- encuesta_sta2_py[cov_names]</span></span>
<span id="cb55-24"><a href="modelo_unidad_py_ic_segsoc.html#cb55-24" tabindex="-1"></a><span class="co"># y &lt;- encuesta_sta2_py[[&#39;yk&#39;]]</span></span>
<span id="cb55-25"><a href="modelo_unidad_py_ic_segsoc.html#cb55-25" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-26"><a href="modelo_unidad_py_ic_segsoc.html#cb55-26" tabindex="-1"></a><span class="co"># # Crear el modelo de clasificación, por ejemplo, un Random Forest</span></span>
<span id="cb55-27"><a href="modelo_unidad_py_ic_segsoc.html#cb55-27" tabindex="-1"></a><span class="co"># modelo &lt;- sklearn_ensemble$RandomForestClassifier()</span></span>
<span id="cb55-28"><a href="modelo_unidad_py_ic_segsoc.html#cb55-28" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-29"><a href="modelo_unidad_py_ic_segsoc.html#cb55-29" tabindex="-1"></a><span class="co"># # Crear el selector RFE con el modelo y el número de características a seleccionar</span></span>
<span id="cb55-30"><a href="modelo_unidad_py_ic_segsoc.html#cb55-30" tabindex="-1"></a><span class="co"># selector &lt;- sklearn_fs$RFE(modelo, n_features_to_select = as.integer(10))</span></span>
<span id="cb55-31"><a href="modelo_unidad_py_ic_segsoc.html#cb55-31" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-32"><a href="modelo_unidad_py_ic_segsoc.html#cb55-32" tabindex="-1"></a><span class="co"># # Ajustar los datos</span></span>
<span id="cb55-33"><a href="modelo_unidad_py_ic_segsoc.html#cb55-33" tabindex="-1"></a><span class="co"># selector$fit(X, y)</span></span>
<span id="cb55-34"><a href="modelo_unidad_py_ic_segsoc.html#cb55-34" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-35"><a href="modelo_unidad_py_ic_segsoc.html#cb55-35" tabindex="-1"></a><span class="co"># # Obtener las variables seleccionadas</span></span>
<span id="cb55-36"><a href="modelo_unidad_py_ic_segsoc.html#cb55-36" tabindex="-1"></a><span class="co"># variables_seleccionadas &lt;- X[selector$support_] %&gt;% names()</span></span>
<span id="cb55-37"><a href="modelo_unidad_py_ic_segsoc.html#cb55-37" tabindex="-1"></a></span>
<span id="cb55-38"><a href="modelo_unidad_py_ic_segsoc.html#cb55-38" tabindex="-1"></a>variables_seleccionadas <span class="ot">&lt;-</span></span>
<span id="cb55-39"><a href="modelo_unidad_py_ic_segsoc.html#cb55-39" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb55-40"><a href="modelo_unidad_py_ic_segsoc.html#cb55-40" tabindex="-1"></a>    <span class="st">&quot;porc_rur&quot;</span>,</span>
<span id="cb55-41"><a href="modelo_unidad_py_ic_segsoc.html#cb55-41" tabindex="-1"></a>    <span class="st">&quot;porc_urb&quot;</span>,</span>
<span id="cb55-42"><a href="modelo_unidad_py_ic_segsoc.html#cb55-42" tabindex="-1"></a>    <span class="st">&quot;porc_ing_ilpi_rur&quot;</span>,</span>
<span id="cb55-43"><a href="modelo_unidad_py_ic_segsoc.html#cb55-43" tabindex="-1"></a>    <span class="st">&quot;porc_ing_ilpi_urb&quot;</span>,</span>
<span id="cb55-44"><a href="modelo_unidad_py_ic_segsoc.html#cb55-44" tabindex="-1"></a>    <span class="st">&quot;porc_jub_urb&quot;</span>,</span>
<span id="cb55-45"><a href="modelo_unidad_py_ic_segsoc.html#cb55-45" tabindex="-1"></a>    <span class="st">&quot;porc_segsoc15&quot;</span>,</span>
<span id="cb55-46"><a href="modelo_unidad_py_ic_segsoc.html#cb55-46" tabindex="-1"></a>    <span class="st">&quot;plp15&quot;</span>,</span>
<span id="cb55-47"><a href="modelo_unidad_py_ic_segsoc.html#cb55-47" tabindex="-1"></a>    <span class="st">&quot;ictpc15&quot;</span>,</span>
<span id="cb55-48"><a href="modelo_unidad_py_ic_segsoc.html#cb55-48" tabindex="-1"></a>    <span class="st">&quot;pob_urb&quot;</span>,</span>
<span id="cb55-49"><a href="modelo_unidad_py_ic_segsoc.html#cb55-49" tabindex="-1"></a>    <span class="st">&quot;pob_tot&quot;</span></span>
<span id="cb55-50"><a href="modelo_unidad_py_ic_segsoc.html#cb55-50" tabindex="-1"></a>  )</span>
<span id="cb55-51"><a href="modelo_unidad_py_ic_segsoc.html#cb55-51" tabindex="-1"></a></span>
<span id="cb55-52"><a href="modelo_unidad_py_ic_segsoc.html#cb55-52" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb55-53"><a href="modelo_unidad_py_ic_segsoc.html#cb55-53" tabindex="-1"></a>  <span class="st">&quot;modifica_humana&quot;</span>,</span>
<span id="cb55-54"><a href="modelo_unidad_py_ic_segsoc.html#cb55-54" tabindex="-1"></a>  <span class="st">&quot;acceso_hosp&quot;</span>,</span>
<span id="cb55-55"><a href="modelo_unidad_py_ic_segsoc.html#cb55-55" tabindex="-1"></a>  <span class="st">&quot;acceso_hosp_caminando&quot;</span>,</span>
<span id="cb55-56"><a href="modelo_unidad_py_ic_segsoc.html#cb55-56" tabindex="-1"></a>  <span class="st">&quot;cubrimiento_cultivo&quot;</span>,</span>
<span id="cb55-57"><a href="modelo_unidad_py_ic_segsoc.html#cb55-57" tabindex="-1"></a>  <span class="st">&quot;cubrimiento_urbano&quot;</span>,</span>
<span id="cb55-58"><a href="modelo_unidad_py_ic_segsoc.html#cb55-58" tabindex="-1"></a>  <span class="st">&quot;luces_nocturnas&quot;</span>,</span>
<span id="cb55-59"><a href="modelo_unidad_py_ic_segsoc.html#cb55-59" tabindex="-1"></a>  variables_seleccionadas</span>
<span id="cb55-60"><a href="modelo_unidad_py_ic_segsoc.html#cb55-60" tabindex="-1"></a>)</span>
<span id="cb55-61"><a href="modelo_unidad_py_ic_segsoc.html#cb55-61" tabindex="-1"></a></span>
<span id="cb55-62"><a href="modelo_unidad_py_ic_segsoc.html#cb55-62" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span></span>
<span id="cb55-63"><a href="modelo_unidad_py_ic_segsoc.html#cb55-63" tabindex="-1"></a>  <span class="fu">setdiff</span>(</span>
<span id="cb55-64"><a href="modelo_unidad_py_ic_segsoc.html#cb55-64" tabindex="-1"></a>    cov_names,</span>
<span id="cb55-65"><a href="modelo_unidad_py_ic_segsoc.html#cb55-65" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb55-66"><a href="modelo_unidad_py_ic_segsoc.html#cb55-66" tabindex="-1"></a>      <span class="st">&quot;elec_mun20&quot;</span>,</span>
<span id="cb55-67"><a href="modelo_unidad_py_ic_segsoc.html#cb55-67" tabindex="-1"></a>      <span class="st">&quot;elec_mun19&quot;</span>,</span>
<span id="cb55-68"><a href="modelo_unidad_py_ic_segsoc.html#cb55-68" tabindex="-1"></a>      <span class="st">&quot;transf_gobpc_15_20&quot;</span>,</span>
<span id="cb55-69"><a href="modelo_unidad_py_ic_segsoc.html#cb55-69" tabindex="-1"></a>      <span class="st">&quot;derhab_pea_15_20&quot;</span>,</span>
<span id="cb55-70"><a href="modelo_unidad_py_ic_segsoc.html#cb55-70" tabindex="-1"></a>      <span class="st">&quot;vabpc_15_19&quot;</span>,</span>
<span id="cb55-71"><a href="modelo_unidad_py_ic_segsoc.html#cb55-71" tabindex="-1"></a>      <span class="st">&quot;itlpis_15_20&quot;</span>,</span>
<span id="cb55-72"><a href="modelo_unidad_py_ic_segsoc.html#cb55-72" tabindex="-1"></a>      <span class="st">&quot;remespc_15_20&quot;</span>,</span>
<span id="cb55-73"><a href="modelo_unidad_py_ic_segsoc.html#cb55-73" tabindex="-1"></a>      <span class="st">&quot;desem_15_20&quot;</span>,</span>
<span id="cb55-74"><a href="modelo_unidad_py_ic_segsoc.html#cb55-74" tabindex="-1"></a>      <span class="st">&quot;porc_urb&quot;</span>,</span>
<span id="cb55-75"><a href="modelo_unidad_py_ic_segsoc.html#cb55-75" tabindex="-1"></a>      <span class="st">&quot;edad65mas_urb&quot;</span>,</span>
<span id="cb55-76"><a href="modelo_unidad_py_ic_segsoc.html#cb55-76" tabindex="-1"></a>      <span class="st">&quot;pob_tot&quot;</span>,</span>
<span id="cb55-77"><a href="modelo_unidad_py_ic_segsoc.html#cb55-77" tabindex="-1"></a>      <span class="st">&quot;acc_muyalto&quot;</span>,</span>
<span id="cb55-78"><a href="modelo_unidad_py_ic_segsoc.html#cb55-78" tabindex="-1"></a>      <span class="st">&quot;smg1&quot;</span>,</span>
<span id="cb55-79"><a href="modelo_unidad_py_ic_segsoc.html#cb55-79" tabindex="-1"></a>      <span class="st">&quot;ql_porc_cpa_rur&quot;</span>,</span>
<span id="cb55-80"><a href="modelo_unidad_py_ic_segsoc.html#cb55-80" tabindex="-1"></a>      <span class="st">&quot;ql_porc_cpa_urb&quot;</span></span>
<span id="cb55-81"><a href="modelo_unidad_py_ic_segsoc.html#cb55-81" tabindex="-1"></a>    )</span>
<span id="cb55-82"><a href="modelo_unidad_py_ic_segsoc.html#cb55-82" tabindex="-1"></a>  )</span>
<span id="cb55-83"><a href="modelo_unidad_py_ic_segsoc.html#cb55-83" tabindex="-1"></a></span>
<span id="cb55-84"><a href="modelo_unidad_py_ic_segsoc.html#cb55-84" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cov_registros, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)</span></code></pre></div>
</div>
<div id="definición-de-la-fórmula-del-modelo-1" class="section level4 unnumbered hasAnchor">
<h4>Definición de la Fórmula del Modelo<a href="modelo_unidad_py_ic_segsoc.html#definición-de-la-fórmula-del-modelo-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se define la fórmula del modelo incluyendo los efectos aleatorios y las variables predictoras seleccionadas.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="modelo_unidad_py_ic_segsoc.html#cb56-1" tabindex="-1"></a>formula_model <span class="ot">&lt;-</span></span>
<span id="cb56-2"><a href="modelo_unidad_py_ic_segsoc.html#cb56-2" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb56-3"><a href="modelo_unidad_py_ic_segsoc.html#cb56-3" tabindex="-1"></a>    <span class="st">&quot;cbind(si, no) ~ (1 | cve_mun) + (1 | hlengua) + (1 | discapacidad) +  nivel_edu + edad  + ent + area + sexo &quot;</span>,</span>
<span id="cb56-4"><a href="modelo_unidad_py_ic_segsoc.html#cb56-4" tabindex="-1"></a>    <span class="st">&quot; + &quot;</span>,</span>
<span id="cb56-5"><a href="modelo_unidad_py_ic_segsoc.html#cb56-5" tabindex="-1"></a>    cov_registros</span>
<span id="cb56-6"><a href="modelo_unidad_py_ic_segsoc.html#cb56-6" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="ajuste-del-modelo-2" class="section level4 unnumbered hasAnchor">
<h4>Ajuste del Modelo<a href="modelo_unidad_py_ic_segsoc.html#ajuste-del-modelo-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se ajusta el modelo utilizando la función <code>modelo_dummy</code> y se guarda el resultado.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="modelo_unidad_py_ic_segsoc.html#cb57-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">modelo_dummy</span>(</span>
<span id="cb57-2"><a href="modelo_unidad_py_ic_segsoc.html#cb57-2" tabindex="-1"></a>  <span class="at">encuesta_sta =</span> encuesta_sta <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">yk =</span> <span class="fu">ifelse</span>(ic_segsoc <span class="sc">==</span> <span class="dv">1</span> ,<span class="dv">1</span>,<span class="dv">0</span>)),</span>
<span id="cb57-3"><a href="modelo_unidad_py_ic_segsoc.html#cb57-3" tabindex="-1"></a>  <span class="at">predictors =</span> statelevel_predictors_df,</span>
<span id="cb57-4"><a href="modelo_unidad_py_ic_segsoc.html#cb57-4" tabindex="-1"></a>  <span class="at">censo_sta =</span> censo_sta,</span>
<span id="cb57-5"><a href="modelo_unidad_py_ic_segsoc.html#cb57-5" tabindex="-1"></a>  <span class="at">formula_mod =</span> formula_model,</span>
<span id="cb57-6"><a href="modelo_unidad_py_ic_segsoc.html#cb57-6" tabindex="-1"></a>  <span class="at">byAgrega =</span> byAgrega</span>
<span id="cb57-7"><a href="modelo_unidad_py_ic_segsoc.html#cb57-7" tabindex="-1"></a>)</span>
<span id="cb57-8"><a href="modelo_unidad_py_ic_segsoc.html#cb57-8" tabindex="-1"></a></span>
<span id="cb57-9"><a href="modelo_unidad_py_ic_segsoc.html#cb57-9" tabindex="-1"></a><span class="co">#--- Exporting Bayesian Multilevel Model Results ---#</span></span>
<span id="cb57-10"><a href="modelo_unidad_py_ic_segsoc.html#cb57-10" tabindex="-1"></a></span>
<span id="cb57-11"><a href="modelo_unidad_py_ic_segsoc.html#cb57-11" tabindex="-1"></a><span class="fu">saveRDS</span>(fit, <span class="at">file =</span> <span class="st">&quot;output/2020/modelos/fit_mrp_ic_segsoc.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modelo_unidad_py_ic_ali_nc.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="postbenchmarking_ictpc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2023MEXsae/08_Modelo_unidad_py_ic_segsoc.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.pdf", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.epub", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

</body>

</html>
