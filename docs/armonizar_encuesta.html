<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>04_Armonizar_encuesta.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020</title>
  <meta name="description" content="Manual de procesamiento." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="04_Armonizar_encuesta.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Manual de procesamiento." />
  <meta name="github-repo" content="psirusteam/coneval" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="04_Armonizar_encuesta.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020" />
  
  <meta name="twitter:description" content="Manual de procesamiento." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero" />


<meta name="date" content="2024-07-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estandarizar_muestra_cuestionario_ampliado.html"/>
<link rel="next" href="validacion_encuestas.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Taller de instalación de capacidades en SAE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#respositodio-de-códigos"><i class="fa fa-check"></i>Respositodio de códigos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-proyecto"><i class="fa fa-check"></i>Estructura del Proyecto</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#librerias-de-r-y-otros-insumos"><i class="fa fa-check"></i>Librerias de <em>R</em> y otros insumos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#bases-de-datos-utilizadas"><i class="fa fa-check"></i>Bases de Datos Utilizadas</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#indicadores-procesados"><i class="fa fa-check"></i>Indicadores procesados</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="union_bases.html"><a href="union_bases.html"><i class="fa fa-check"></i>00_union_bases.R</a></li>
<li class="chapter" data-level="" data-path="descarga_satelitales.html"><a href="descarga_satelitales.html"><i class="fa fa-check"></i>01_Descarga_satelitales.R</a></li>
<li class="chapter" data-level="" data-path="union_predictores.html"><a href="union_predictores.html"><i class="fa fa-check"></i>02_Union_predictores.R</a></li>
<li class="chapter" data-level="" data-path="estandarizar_muestra_cuestionario_ampliado.html"><a href="estandarizar_muestra_cuestionario_ampliado.html"><i class="fa fa-check"></i>03_Estandarizar_muestra_cuestionario_ampliado.R</a></li>
<li class="chapter" data-level="" data-path="armonizar_encuesta.html"><a href="armonizar_encuesta.html"><i class="fa fa-check"></i>04_Armonizar_encuesta.R</a></li>
<li class="chapter" data-level="" data-path="validacion_encuestas.html"><a href="validacion_encuestas.html"><i class="fa fa-check"></i>05_Validacion_encuestas.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_ictpc.html"><a href="modelo_unidad_ictpc.html"><i class="fa fa-check"></i>06_Modelo_unidad_ictpc.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_py_ic_ali_nc.html"><a href="modelo_unidad_py_ic_ali_nc.html"><i class="fa fa-check"></i>07_Modelo_unidad_py_ic_ali_nc.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_py_ic_segsoc.html"><a href="modelo_unidad_py_ic_segsoc.html"><i class="fa fa-check"></i>08_Modelo_unidad_py_ic_segsoc</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ictpc.html"><a href="postbenchmarking_ictpc.html"><i class="fa fa-check"></i>09_PostBenchmarking_ictpc.R</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ic_ali_nc.html"><a href="postbenchmarking_ic_ali_nc.html"><i class="fa fa-check"></i>10_PostBenchmarking_ic_ali_nc.R</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ic_segsoc.html"><a href="postbenchmarking_ic_segsoc.html"><i class="fa fa-check"></i>11_PostBenchmarking_ic_segsoc.r</a></li>
<li class="chapter" data-level="" data-path="imputacion_censal.html"><a href="imputacion_censal.html"><i class="fa fa-check"></i>12_Imputacion_censal.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_ent_02.html"><a href="estimacion_ent_02.html"><i class="fa fa-check"></i>13_Estimacion_ent_02.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_ipm_pobreza.html"><a href="estimacion_municipios_ipm_pobreza.html"><i class="fa fa-check"></i>14_estimacion_municipios_ipm_pobreza.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_ipm_pobreza_error.html"><a href="estimacion_municipios_ipm_pobreza_error.html"><i class="fa fa-check"></i>15_estimacion_municipios_ipm_pobreza_error.R</a></li>
<li class="chapter" data-level="" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i>16_Mapas.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html"><i class="fa fa-check"></i>17_estimacion_municipios_carencias.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_carencias_error.html"><a href="estimacion_municipios_carencias_error.html"><i class="fa fa-check"></i>18_estimacion_municipios_carencias_error.R</a></li>
<li class="chapter" data-level="" data-path="mapas_carencias.html"><a href="mapas_carencias.html"><i class="fa fa-check"></i>19_Mapas_carencias.R</a></li>
<li class="divider"></li>
<li><a Taller de instalación de capacidades en SAE </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="armonizar_encuesta.r" class="section level1 unnumbered hasAnchor">
<h1>04_Armonizar_encuesta.R<a href="armonizar_encuesta.html#armonizar_encuesta.r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Para la ejecución del presente archivo, debe abrir el archivo <strong>04_Armonizar_encuesta.R</strong> disponible en la ruta <em>Rcodes/2020/04_Armonizar_encuesta.R</em>. Este script está diseñado para llevar a cabo un análisis exhaustivo de datos a través de un proceso metódico en varias fases.</p>
<p>En la primera fase, el código elimina todos los objetos del entorno de R para asegurar que el análisis se inicie con un entorno limpio y sin datos residuales. A continuación, se cargan las bibliotecas necesarias para el análisis, que proporcionan herramientas esenciales para la manipulación de datos y la importación y exportación de archivos. Después, se leen las bases de datos del censo de personas 2020 y de la Encuesta Nacional de Ingresos y Gastos de los Hogares (ENIGH). Estas bases se utilizan para identificar y verificar indicadores relacionados con carencias sociales.</p>
<p>Posteriormente, se definen y validan las variables clave de la encuesta, como códigos de entidad, municipio, área, sexo, edad, nivel educativo, discapacidad y lengua indígena. Luego, se estandarizan las variables de la encuesta para alinear los datos con los del censo, se filtran los datos para eliminar inconsistencias y se guarda el conjunto de datos estandarizado. Además, se actualiza la tabla censal utilizando la técnica de calibración IPFP (Iterative Proportional Fitting Procedure) para asegurar que las distribuciones marginales de las variables estandarizadas coincidan con las del censo. Finalmente, se generan histogramas y gráficos de dispersión para visualizar los resultados de la calibración y se guarda el conjunto de datos ampliado.</p>
<div id="limpieza-del-entorno-y-carga-de-bibliotecas-1" class="section level4 unnumbered hasAnchor">
<h4>Limpieza del Entorno y Carga de Bibliotecas<a href="armonizar_encuesta.html#limpieza-del-entorno-y-carga-de-bibliotecas-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se limpia el entorno de R eliminando todos los objetos y se ejecuta el recolector de basura para liberar memoria.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="armonizar_encuesta.html#cb21-1" tabindex="-1"></a><span class="do">### Cleaning R environment </span><span class="al">###</span></span>
<span id="cb21-2"><a href="armonizar_encuesta.html#cb21-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb21-3"><a href="armonizar_encuesta.html#cb21-3" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<p>Se cargan varias bibliotecas esenciales para la manipulación y análisis de datos, incluyendo <code>tidyverse</code>, <code>data.table</code>, <code>openxlsx</code>, <code>magrittr</code>, <code>DataExplorer</code>, <code>haven</code>, <code>purrr</code>, <code>labelled</code> y <code>sampling</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="armonizar_encuesta.html#cb22-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb22-2"><a href="armonizar_encuesta.html#cb22-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb22-3"><a href="armonizar_encuesta.html#cb22-3" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb22-4"><a href="armonizar_encuesta.html#cb22-4" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb22-5"><a href="armonizar_encuesta.html#cb22-5" tabindex="-1"></a><span class="fu">library</span>(DataExplorer)</span>
<span id="cb22-6"><a href="armonizar_encuesta.html#cb22-6" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb22-7"><a href="armonizar_encuesta.html#cb22-7" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb22-8"><a href="armonizar_encuesta.html#cb22-8" tabindex="-1"></a><span class="fu">library</span>(labelled)</span>
<span id="cb22-9"><a href="armonizar_encuesta.html#cb22-9" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb22-10"><a href="armonizar_encuesta.html#cb22-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\f</span><span class="st">&quot;</span>)</span></code></pre></div>
</div>
<div id="lectura-de-datos" class="section level4 unnumbered hasAnchor">
<h4>Lectura de Datos<a href="armonizar_encuesta.html#lectura-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se leen las bases de datos <code>muestra_cuestionario_ampliado.rds</code> y <code>enigh.rds</code>, y se verifica la unicidad de los identificadores de entidad y municipio.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="armonizar_encuesta.html#cb23-1" tabindex="-1"></a>encuesta_ampliada <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/muestra_ampliada/muestra_cuestionario_ampliado.rds&quot;</span>)</span>
<span id="cb23-2"><a href="armonizar_encuesta.html#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="armonizar_encuesta.html#cb23-3" tabindex="-1"></a><span class="co"># Indicadores_MECXX: La base de datos Pobreza_15.dta contiene la información de </span></span>
<span id="cb23-4"><a href="armonizar_encuesta.html#cb23-4" tabindex="-1"></a><span class="co"># variables de carencias sociales a nivel individual (Utiliza como insumo la </span></span>
<span id="cb23-5"><a href="armonizar_encuesta.html#cb23-5" tabindex="-1"></a><span class="co"># información del MEC) </span></span>
<span id="cb23-6"><a href="armonizar_encuesta.html#cb23-6" tabindex="-1"></a>enigh <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output//2020/enigh.rds&quot;</span>)</span>
<span id="cb23-7"><a href="armonizar_encuesta.html#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="armonizar_encuesta.html#cb23-8" tabindex="-1"></a><span class="fu">n_distinct</span>(enigh<span class="sc">$</span>ent) <span class="co"># cod_dam</span></span>
<span id="cb23-9"><a href="armonizar_encuesta.html#cb23-9" tabindex="-1"></a><span class="fu">n_distinct</span>(enigh<span class="sc">$</span>cve_mun) <span class="co"># cod_mun</span></span></code></pre></div>
</div>
<div id="definición-de-variables-para-la-encuesta" class="section level4 unnumbered hasAnchor">
<h4>Definición de Variables para la Encuesta<a href="armonizar_encuesta.html#definición-de-variables-para-la-encuesta" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se definen y transforman las variables de área urbana o rural.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="armonizar_encuesta.html#cb24-1" tabindex="-1"></a><span class="co"># codigo municipio</span></span>
<span id="cb24-2"><a href="armonizar_encuesta.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="armonizar_encuesta.html#cb24-3" tabindex="-1"></a><span class="co"># area urabo o rural </span></span>
<span id="cb24-4"><a href="armonizar_encuesta.html#cb24-4" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(rururb) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor))</span>
<span id="cb24-5"><a href="armonizar_encuesta.html#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="armonizar_encuesta.html#cb24-6" tabindex="-1"></a>enigh <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb24-7"><a href="armonizar_encuesta.html#cb24-7" tabindex="-1"></a>  <span class="at">area =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(rururb, <span class="at">levels  =</span> <span class="st">&quot;values&quot;</span>),</span>
<span id="cb24-8"><a href="armonizar_encuesta.html#cb24-8" tabindex="-1"></a>  <span class="at">area =</span> <span class="fu">as.character</span>(area)</span>
<span id="cb24-9"><a href="armonizar_encuesta.html#cb24-9" tabindex="-1"></a>)</span>
<span id="cb24-10"><a href="armonizar_encuesta.html#cb24-10" tabindex="-1"></a></span>
<span id="cb24-11"><a href="armonizar_encuesta.html#cb24-11" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span>   <span class="fu">distinct</span>(rururb,area)</span></code></pre></div>
</div>
<div id="transformación-de-variables-demográficas-y-socioeconómicas" class="section level4 unnumbered hasAnchor">
<h4>Transformación de Variables Demográficas y Socioeconómicas<a href="armonizar_encuesta.html#transformación-de-variables-demográficas-y-socioeconómicas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se transforman las variables de sexo, edad, nivel educativo, discapacidad y lengua indígena para su uso en el análisis.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="armonizar_encuesta.html#cb25-1" tabindex="-1"></a><span class="co"># Sexo </span></span>
<span id="cb25-2"><a href="armonizar_encuesta.html#cb25-2" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sexo) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor))</span>
<span id="cb25-3"><a href="armonizar_encuesta.html#cb25-3" tabindex="-1"></a><span class="co"># 2 Mujer</span></span>
<span id="cb25-4"><a href="armonizar_encuesta.html#cb25-4" tabindex="-1"></a><span class="co"># 1 Hombre</span></span>
<span id="cb25-5"><a href="armonizar_encuesta.html#cb25-5" tabindex="-1"></a></span>
<span id="cb25-6"><a href="armonizar_encuesta.html#cb25-6" tabindex="-1"></a><span class="co"># Edad </span></span>
<span id="cb25-7"><a href="armonizar_encuesta.html#cb25-7" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(edad) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor))</span>
<span id="cb25-8"><a href="armonizar_encuesta.html#cb25-8" tabindex="-1"></a>encuesta_ampliada <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(edad)</span>
<span id="cb25-9"><a href="armonizar_encuesta.html#cb25-9" tabindex="-1"></a><span class="co"># 1 Menor de 14 años</span></span>
<span id="cb25-10"><a href="armonizar_encuesta.html#cb25-10" tabindex="-1"></a><span class="co"># 2 15 a 29 años</span></span>
<span id="cb25-11"><a href="armonizar_encuesta.html#cb25-11" tabindex="-1"></a><span class="co"># 3 30 a 44 años</span></span>
<span id="cb25-12"><a href="armonizar_encuesta.html#cb25-12" tabindex="-1"></a><span class="co"># 4 45 a 64 años</span></span>
<span id="cb25-13"><a href="armonizar_encuesta.html#cb25-13" tabindex="-1"></a><span class="co"># 5 65 años o más</span></span>
<span id="cb25-14"><a href="armonizar_encuesta.html#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="armonizar_encuesta.html#cb25-15" tabindex="-1"></a>enigh <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">g_edad =</span> <span class="fu">case_when</span>(edad <span class="sc">&lt;=</span> <span class="dv">14</span> <span class="sc">~</span> <span class="st">&quot;1&quot;</span>, <span class="co"># 0 a 14</span></span>
<span id="cb25-16"><a href="armonizar_encuesta.html#cb25-16" tabindex="-1"></a>                                     edad <span class="sc">&lt;=</span> <span class="dv">29</span> <span class="sc">~</span> <span class="st">&quot;2&quot;</span>, <span class="co"># 15 a 29</span></span>
<span id="cb25-17"><a href="armonizar_encuesta.html#cb25-17" tabindex="-1"></a>                                     edad <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&quot;3&quot;</span>, <span class="co"># 30 a 44</span></span>
<span id="cb25-18"><a href="armonizar_encuesta.html#cb25-18" tabindex="-1"></a>                                     edad <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;4&quot;</span>, <span class="co"># 45 a 64</span></span>
<span id="cb25-19"><a href="armonizar_encuesta.html#cb25-19" tabindex="-1"></a>                                     edad <span class="sc">&gt;</span>  <span class="dv">64</span> <span class="sc">~</span> <span class="st">&quot;5&quot;</span>, <span class="co"># 65 o mas</span></span>
<span id="cb25-20"><a href="armonizar_encuesta.html#cb25-20" tabindex="-1"></a>                                     <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)) </span>
<span id="cb25-21"><a href="armonizar_encuesta.html#cb25-21" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(g_edad) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor))</span>
<span id="cb25-22"><a href="armonizar_encuesta.html#cb25-22" tabindex="-1"></a></span>
<span id="cb25-23"><a href="armonizar_encuesta.html#cb25-23" tabindex="-1"></a><span class="co"># nivel educativo</span></span>
<span id="cb25-24"><a href="armonizar_encuesta.html#cb25-24" tabindex="-1"></a></span>
<span id="cb25-25"><a href="armonizar_encuesta.html#cb25-25" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(niv_ed) <span class="sc">%&gt;%</span></span>
<span id="cb25-26"><a href="armonizar_encuesta.html#cb25-26" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-27"><a href="armonizar_encuesta.html#cb25-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb25-28"><a href="armonizar_encuesta.html#cb25-28" tabindex="-1"></a></span>
<span id="cb25-29"><a href="armonizar_encuesta.html#cb25-29" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> </span>
<span id="cb25-30"><a href="armonizar_encuesta.html#cb25-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nivel_edu =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(niv_ed, <span class="at">levels  =</span> <span class="st">&quot;values&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-31"><a href="armonizar_encuesta.html#cb25-31" tabindex="-1"></a>  <span class="fu">group_by</span>(nivel_edu, g_edad) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor)) <span class="sc">%&gt;%</span></span>
<span id="cb25-32"><a href="armonizar_encuesta.html#cb25-32" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb25-33"><a href="armonizar_encuesta.html#cb25-33" tabindex="-1"></a></span>
<span id="cb25-34"><a href="armonizar_encuesta.html#cb25-34" tabindex="-1"></a>enigh <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb25-35"><a href="armonizar_encuesta.html#cb25-35" tabindex="-1"></a>  <span class="at">nivel_edu =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(niv_ed, <span class="at">levels  =</span> <span class="st">&quot;values&quot;</span>),</span>
<span id="cb25-36"><a href="armonizar_encuesta.html#cb25-36" tabindex="-1"></a>  <span class="at">nivel_edu =</span> <span class="fu">as.character</span>(nivel_edu)</span>
<span id="cb25-37"><a href="armonizar_encuesta.html#cb25-37" tabindex="-1"></a>)</span>
<span id="cb25-38"><a href="armonizar_encuesta.html#cb25-38" tabindex="-1"></a></span>
<span id="cb25-39"><a href="armonizar_encuesta.html#cb25-39" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span>   <span class="fu">distinct</span>(niv_ed,nivel_edu)</span>
<span id="cb25-40"><a href="armonizar_encuesta.html#cb25-40" tabindex="-1"></a></span>
<span id="cb25-41"><a href="armonizar_encuesta.html#cb25-41" tabindex="-1"></a><span class="co"># Discapacidad</span></span>
<span id="cb25-42"><a href="armonizar_encuesta.html#cb25-42" tabindex="-1"></a></span>
<span id="cb25-43"><a href="armonizar_encuesta.html#cb25-43" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(discap) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor)) </span>
<span id="cb25-44"><a href="armonizar_encuesta.html#cb25-44" tabindex="-1"></a></span>
<span id="cb25-45"><a href="armonizar_encuesta.html#cb25-45" tabindex="-1"></a>enigh <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb25-46"><a href="armonizar_encuesta.html#cb25-46" tabindex="-1"></a>  <span class="at">discapacidad =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(discap, <span class="at">levels  =</span> <span class="st">&quot;values&quot;</span>),</span>
<span id="cb25-47"><a href="armonizar_encuesta.html#cb25-47" tabindex="-1"></a>  <span class="at">discapacidad =</span> <span class="fu">as.character</span>(discapacidad)</span>
<span id="cb25-48"><a href="armonizar_encuesta.html#cb25-48" tabindex="-1"></a>)</span>
<span id="cb25-49"><a href="armonizar_encuesta.html#cb25-49" tabindex="-1"></a></span>
<span id="cb25-50"><a href="armonizar_encuesta.html#cb25-50" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span>   <span class="fu">distinct</span>(discap,discapacidad)</span>
<span id="cb25-51"><a href="armonizar_encuesta.html#cb25-51" tabindex="-1"></a></span>
<span id="cb25-52"><a href="armonizar_encuesta.html#cb25-52" tabindex="-1"></a><span class="co"># Habla dialecto o lengua indígena</span></span>
<span id="cb25-53"><a href="armonizar_encuesta.html#cb25-53" tabindex="-1"></a><span class="fu">attributes</span>(enigh<span class="sc">$</span>hli)</span>
<span id="cb25-54"><a href="armonizar_encuesta.html#cb25-54" tabindex="-1"></a></span>
<span id="cb25-55"><a href="armonizar_encuesta.html#cb25-55" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(hli) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor)) </span>
<span id="cb25-56"><a href="armonizar_encuesta.html#cb25-56" tabindex="-1"></a></span>
<span id="cb25-57"><a href="armonizar_encuesta.html#cb25-57" tabindex="-1"></a>enigh <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb25-58"><a href="armonizar_encuesta.html#cb25-58" tabindex="-1"></a>  <span class="at">hlengua =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(hli, <span class="at">levels  =</span> <span class="st">&quot;values&quot;</span>),</span>
<span id="cb25-59"><a href="armonizar_encuesta.html#cb25-59" tabindex="-1"></a>  <span class="at">hlengua =</span> <span class="fu">as.character</span>(hlengua)</span>
<span id="cb25-60"><a href="armonizar_encuesta.html#cb25-60" tabindex="-1"></a>)</span>
<span id="cb25-61"><a href="armonizar_encuesta.html#cb25-61" tabindex="-1"></a></span>
<span id="cb25-62"><a href="armonizar_encuesta.html#cb25-62" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span>   <span class="fu">distinct</span>(hlengua,hli)</span></code></pre></div>
</div>
<div id="análisis-de-variables-de-carencia" class="section level4 unnumbered hasAnchor">
<h4>Análisis de Variables de Carencia<a href="armonizar_encuesta.html#análisis-de-variables-de-carencia" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se analizan los indicadores de carencia y se visualiza la distribución logarítmica del ingreso per cápita.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="armonizar_encuesta.html#cb26-1" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(enigh<span class="sc">$</span>ictpc))</span>
<span id="cb26-2"><a href="armonizar_encuesta.html#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="armonizar_encuesta.html#cb26-3" tabindex="-1"></a><span class="co"># Indicador de carencia por acceso a servicios de salud</span></span>
<span id="cb26-4"><a href="armonizar_encuesta.html#cb26-4" tabindex="-1"></a><span class="fu">attributes</span>(enigh<span class="sc">$</span>ic_segsoc)</span>
<span id="cb26-5"><a href="armonizar_encuesta.html#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="armonizar_encuesta.html#cb26-6" tabindex="-1"></a><span class="co"># Indicador de carencia por acceso a la alimentación nutritiva y de calidad</span></span>
<span id="cb26-7"><a href="armonizar_encuesta.html#cb26-7" tabindex="-1"></a><span class="fu">attributes</span>(enigh<span class="sc">$</span>ic_ali_nc)</span>
<span id="cb26-8"><a href="armonizar_encuesta.html#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="armonizar_encuesta.html#cb26-9" tabindex="-1"></a>enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ic_segsoc) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(factor)) </span></code></pre></div>
</div>
<div id="preparación-y-guardado-del-conjunto-de-datos" class="section level4 unnumbered hasAnchor">
<h4>Preparación y Guardado del Conjunto de Datos<a href="armonizar_encuesta.html#preparación-y-guardado-del-conjunto-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se prepara el conjunto de datos final <code>encuesta_sta</code> con las variables de estudio y de diseño, y se guarda en un archivo <code>.rds</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="armonizar_encuesta.html#cb27-1" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb27-2"><a href="armonizar_encuesta.html#cb27-2" tabindex="-1"></a>encuesta_sta <span class="ot">&lt;-</span> enigh <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="armonizar_encuesta.html#cb27-3" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb27-4"><a href="armonizar_encuesta.html#cb27-4" tabindex="-1"></a>    <span class="at">ent =</span> <span class="fu">str_pad</span>(</span>
<span id="cb27-5"><a href="armonizar_encuesta.html#cb27-5" tabindex="-1"></a>      <span class="at">string =</span> ent,</span>
<span id="cb27-6"><a href="armonizar_encuesta.html#cb27-6" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">2</span>,</span>
<span id="cb27-7"><a href="armonizar_encuesta.html#cb27-7" tabindex="-1"></a>      <span class="at">pad =</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb27-8"><a href="armonizar_encuesta.html#cb27-8" tabindex="-1"></a>    ),</span>
<span id="cb27-9"><a href="armonizar_encuesta.html#cb27-9" tabindex="-1"></a>    cve_mun,</span>
<span id="cb27-10"><a href="armonizar_encuesta.html#cb27-10" tabindex="-1"></a>    area,</span>
<span id="cb27-11"><a href="armonizar_encuesta.html#cb27-11" tabindex="-1"></a>    sexo,</span>
<span id="cb27-12"><a href="armonizar_encuesta.html#cb27-12" tabindex="-1"></a>    <span class="at">edad =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(g_edad), <span class="st">&quot;99&quot;</span>, g_edad),</span>
<span id="cb27-13"><a href="armonizar_encuesta.html#cb27-13" tabindex="-1"></a>    <span class="at">nivel_edu =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nivel_edu), <span class="st">&quot;99&quot;</span>, nivel_edu),</span>
<span id="cb27-14"><a href="armonizar_encuesta.html#cb27-14" tabindex="-1"></a>    <span class="at">discapacidad =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(discapacidad), <span class="st">&quot;0&quot;</span>, discapacidad),</span>
<span id="cb27-15"><a href="armonizar_encuesta.html#cb27-15" tabindex="-1"></a>    <span class="at">hlengua =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(hlengua), <span class="st">&quot;0&quot;</span>, hlengua),</span>
<span id="cb27-16"><a href="armonizar_encuesta.html#cb27-16" tabindex="-1"></a>    </span>
<span id="cb27-17"><a href="armonizar_encuesta.html#cb27-17" tabindex="-1"></a>    <span class="do">## Variable de estudio</span></span>
<span id="cb27-18"><a href="armonizar_encuesta.html#cb27-18" tabindex="-1"></a>    <span class="at">ictpc =</span> <span class="fu">as.numeric</span>(ictpc),</span>
<span id="cb27-19"><a href="armonizar_encuesta.html#cb27-19" tabindex="-1"></a>    <span class="at">ic_segsoc =</span> <span class="fu">as.numeric</span>(ic_segsoc),</span>
<span id="cb27-20"><a href="armonizar_encuesta.html#cb27-20" tabindex="-1"></a>    <span class="at">ic_ali_nc =</span> <span class="fu">as.numeric</span>(ic_ali_nc),</span>
<span id="cb27-21"><a href="armonizar_encuesta.html#cb27-21" tabindex="-1"></a>    <span class="at">ic_rezedu =</span> <span class="fu">as.numeric</span>(ic_segsoc),</span>
<span id="cb27-22"><a href="armonizar_encuesta.html#cb27-22" tabindex="-1"></a>    <span class="at">ic_asalud =</span> <span class="fu">as.numeric</span>(ic_segsoc),</span>
<span id="cb27-23"><a href="armonizar_encuesta.html#cb27-23" tabindex="-1"></a>    <span class="at">ic_sbv =</span> <span class="fu">as.numeric</span>(ic_sbv_hog),</span>
<span id="cb27-24"><a href="armonizar_encuesta.html#cb27-24" tabindex="-1"></a>    <span class="at">ic_cv =</span> <span class="fu">as.numeric</span>(ic_cv_hog),</span>
<span id="cb27-25"><a href="armonizar_encuesta.html#cb27-25" tabindex="-1"></a>    </span>
<span id="cb27-26"><a href="armonizar_encuesta.html#cb27-26" tabindex="-1"></a>    <span class="do">## Variables diseño</span></span>
<span id="cb27-27"><a href="armonizar_encuesta.html#cb27-27" tabindex="-1"></a>    <span class="at">estrato =</span> est_dis,</span>
<span id="cb27-28"><a href="armonizar_encuesta.html#cb27-28" tabindex="-1"></a>    <span class="at">upm =</span> upm,</span>
<span id="cb27-29"><a href="armonizar_encuesta.html#cb27-29" tabindex="-1"></a>    <span class="at">fep =</span> factor</span>
<span id="cb27-30"><a href="armonizar_encuesta.html#cb27-30" tabindex="-1"></a>  )</span>
<span id="cb27-31"><a href="armonizar_encuesta.html#cb27-31" tabindex="-1"></a></span>
<span id="cb27-32"><a href="armonizar_encuesta.html#cb27-32" tabindex="-1"></a><span class="fu">map</span>(<span class="fu">c</span>(</span>
<span id="cb27-33"><a href="armonizar_encuesta.html#cb27-33" tabindex="-1"></a>  <span class="st">&quot;ent&quot;</span>,</span>
<span id="cb27-34"><a href="armonizar_encuesta.html#cb27-34" tabindex="-1"></a>  <span class="st">&quot;cve_mun&quot;</span>,</span>
<span id="cb27-35"><a href="armonizar_encuesta.html#cb27-35" tabindex="-1"></a>  <span class="st">&quot;area&quot;</span>,</span>
<span id="cb27-36"><a href="armonizar_encuesta.html#cb27-36" tabindex="-1"></a>  <span class="st">&quot;sexo&quot;</span>,</span>
<span id="cb27-37"><a href="armonizar_encuesta.html#cb27-37" tabindex="-1"></a>  <span class="st">&quot;edad&quot;</span>,</span>
<span id="cb27-38"><a href="armonizar_encuesta.html#cb27-38" tabindex="-1"></a>  <span class="st">&quot;nivel_edu&quot;</span>,</span>
<span id="cb27-39"><a href="armonizar_encuesta.html#cb27-39" tabindex="-1"></a>  <span class="st">&quot;hlengua&quot;</span>,</span>
<span id="cb27-40"><a href="armonizar_encuesta.html#cb27-40" tabindex="-1"></a>  <span class="st">&quot;discapacidad&quot;</span>,</span>
<span id="cb27-41"><a href="armonizar_encuesta.html#cb27-41" tabindex="-1"></a>  <span class="st">&quot;ic_segsoc&quot;</span>,</span>
<span id="cb27-42"><a href="armonizar_encuesta.html#cb27-42" tabindex="-1"></a>  <span class="st">&quot;ic_ali_nc&quot;</span></span>
<span id="cb27-43"><a href="armonizar_encuesta.html#cb27-43" tabindex="-1"></a>),</span>
<span id="cb27-44"><a href="armonizar_encuesta.html#cb27-44" tabindex="-1"></a><span class="cf">function</span>(x) {</span>
<span id="cb27-45"><a href="armonizar_encuesta.html#cb27-45" tabindex="-1"></a>  encuesta_sta <span class="sc">%&gt;%</span> <span class="fu">group_by_at</span>(x ) <span class="sc">%&gt;%</span></span>
<span id="cb27-46"><a href="armonizar_encuesta.html#cb27-46" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nd =</span> <span class="fu">sum</span>(fep)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-47"><a href="armonizar_encuesta.html#cb27-47" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">N =</span> <span class="fu">sum</span>(Nd),</span>
<span id="cb27-48"><a href="armonizar_encuesta.html#cb27-48" tabindex="-1"></a>           <span class="at">prop =</span> Nd <span class="sc">/</span> N)</span>
<span id="cb27-49"><a href="armonizar_encuesta.html#cb27-49" tabindex="-1"></a>})</span>
<span id="cb27-50"><a href="armonizar_encuesta.html#cb27-50" tabindex="-1"></a></span>
<span id="cb27-51"><a href="armonizar_encuesta.html#cb27-51" tabindex="-1"></a><span class="co"># Se guarda el conjunto de datos</span></span>
<span id="cb27-52"><a href="armonizar_encuesta.html#cb27-52" tabindex="-1"></a><span class="fu">saveRDS</span>(encuesta_sta, <span class="at">file =</span> <span class="st">&quot;../input/2020/enigh/encuesta_sta.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="actualización-de-la-tabla-censal" class="section level4 unnumbered hasAnchor">
<h4>Actualización de la Tabla Censal<a href="armonizar_encuesta.html#actualización-de-la-tabla-censal" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se actualiza la tabla censal mediante calibración de pesos, y se guarda el conjunto de datos calibrado.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="armonizar_encuesta.html#cb28-1" tabindex="-1"></a><span class="co"># Actualización de tabla censal- IPFP -------------------------------------</span></span>
<span id="cb28-2"><a href="armonizar_encuesta.html#cb28-2" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ent&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>, <span class="st">&quot;area&quot;</span>, <span class="st">&quot;sexo&quot;</span>, <span class="st">&quot;edad&quot;</span>, <span class="st">&quot;discapacidad&quot;</span>, <span class="st">&quot;hlengua&quot;</span>)</span>
<span id="cb28-3"><a href="armonizar_encuesta.html#cb28-3" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> names_cov[names_cov <span class="sc">%in%</span> <span class="fu">names</span>(encuesta_sta)]</span>
<span id="cb28-4"><a href="armonizar_encuesta.html#cb28-4" tabindex="-1"></a></span>
<span id="cb28-5"><a href="armonizar_encuesta.html#cb28-5" tabindex="-1"></a>num_cat_censo <span class="ot">&lt;-</span> <span class="fu">apply</span>(encuesta_ampliada[names_cov], <span class="at">MARGIN  =</span> <span class="dv">2</span>, <span class="cf">function</span>(x)</span>
<span id="cb28-6"><a href="armonizar_encuesta.html#cb28-6" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb28-7"><a href="armonizar_encuesta.html#cb28-7" tabindex="-1"></a></span>
<span id="cb28-8"><a href="armonizar_encuesta.html#cb28-8" tabindex="-1"></a>num_cat_sample <span class="ot">&lt;-</span> <span class="fu">apply</span>(encuesta_sta[names_cov], <span class="at">MARGIN  =</span> <span class="dv">2</span>, <span class="cf">function</span>(x)</span>
<span id="cb28-9"><a href="armonizar_encuesta.html#cb28-9" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">unique</span>(x)))</span>
<span id="cb28-10"><a href="armonizar_encuesta.html#cb28-10" tabindex="-1"></a></span>
<span id="cb28-11"><a href="armonizar_encuesta.html#cb28-11" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> names_cov[num_cat_censo <span class="sc">==</span> num_cat_sample]</span>
<span id="cb28-12"><a href="armonizar_encuesta.html#cb28-12" tabindex="-1"></a></span>
<span id="cb28-13"><a href="armonizar_encuesta.html#cb28-13" tabindex="-1"></a><span class="co"># MatrizCalibrada creada únicamente para los niveles completos </span></span>
<span id="cb28-14"><a href="armonizar_encuesta.html#cb28-14" tabindex="-1"></a><span class="co"># IMPORTANTE: Excluir las covariables que tengan niveles incompletos</span></span>
<span id="cb28-15"><a href="armonizar_encuesta.html#cb28-15" tabindex="-1"></a></span>
<span id="cb28-16"><a href="armonizar_encuesta.html#cb28-16" tabindex="-1"></a>auxSuma <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, col, ni) {</span>
<span id="cb28-17"><a href="armonizar_encuesta.html#cb28-17" tabindex="-1"></a>  dat <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(col))  <span class="sc">%&gt;%</span></span>
<span id="cb28-18"><a href="armonizar_encuesta.html#cb28-18" tabindex="-1"></a>    fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">remove_selected_columns =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-19"><a href="armonizar_encuesta.html#cb28-19" tabindex="-1"></a>    <span class="fu">mutate_all</span>(<span class="sc">~</span>.<span class="sc">*</span>ni) <span class="sc">%&gt;%</span> <span class="fu">colSums</span>()  </span>
<span id="cb28-20"><a href="armonizar_encuesta.html#cb28-20" tabindex="-1"></a>}</span>
<span id="cb28-21"><a href="armonizar_encuesta.html#cb28-21" tabindex="-1"></a></span>
<span id="cb28-22"><a href="armonizar_encuesta.html#cb28-22" tabindex="-1"></a>N.g <span class="ot">&lt;-</span> <span class="fu">map</span>(names_cov,</span>
<span id="cb28-23"><a href="armonizar_encuesta.html#cb28-23" tabindex="-1"></a>           <span class="sc">~</span> <span class="fu">auxSuma</span>(encuesta_sta, <span class="at">col =</span> .x, <span class="at">ni =</span> encuesta_sta<span class="sc">$</span>fep)) <span class="sc">%&gt;%</span></span>
<span id="cb28-24"><a href="armonizar_encuesta.html#cb28-24" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb28-25"><a href="armonizar_encuesta.html#cb28-25" tabindex="-1"></a></span>
<span id="cb28-26"><a href="armonizar_encuesta.html#cb28-26" tabindex="-1"></a>N_censo.g <span class="ot">&lt;-</span> <span class="fu">map</span>(names_cov,</span>
<span id="cb28-27"><a href="armonizar_encuesta.html#cb28-27" tabindex="-1"></a>                 <span class="sc">~</span> <span class="fu">auxSuma</span>(encuesta_ampliada, <span class="at">col =</span> .x, <span class="at">ni =</span> encuesta_ampliada<span class="sc">$</span>n)) <span class="sc">%&gt;%</span></span>
<span id="cb28-28"><a href="armonizar_encuesta.html#cb28-28" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb28-29"><a href="armonizar_encuesta.html#cb28-29" tabindex="-1"></a></span>
<span id="cb28-30"><a href="armonizar_encuesta.html#cb28-30" tabindex="-1"></a>names_xk <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(N.g), <span class="fu">names</span>(N_censo.g))</span>
<span id="cb28-31"><a href="armonizar_encuesta.html#cb28-31" tabindex="-1"></a></span>
<span id="cb28-32"><a href="armonizar_encuesta.html#cb28-32" tabindex="-1"></a>N.g <span class="ot">&lt;-</span> N.g[names_xk]</span>
<span id="cb28-33"><a href="armonizar_encuesta.html#cb28-33" tabindex="-1"></a>N_censo.g <span class="ot">&lt;-</span> N_censo.g[names_xk]</span>
<span id="cb28-34"><a href="armonizar_encuesta.html#cb28-34" tabindex="-1"></a></span>
<span id="cb28-35"><a href="armonizar_encuesta.html#cb28-35" tabindex="-1"></a>Xk <span class="ot">&lt;-</span> encuesta_ampliada <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(names_cov)) <span class="sc">%&gt;%</span></span>
<span id="cb28-36"><a href="armonizar_encuesta.html#cb28-36" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">remove_selected_columns =</span> <span class="cn">TRUE</span>) %</span>
<span id="cb28-37"><a href="armonizar_encuesta.html#cb28-37" tabindex="-1"></a></span>
<span id="cb28-38"><a href="armonizar_encuesta.html#cb28-38" tabindex="-1"></a><span class="sc">&gt;</span>% </span>
<span id="cb28-39"><a href="armonizar_encuesta.html#cb28-39" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(names_xk))</span>
<span id="cb28-40"><a href="armonizar_encuesta.html#cb28-40" tabindex="-1"></a></span>
<span id="cb28-41"><a href="armonizar_encuesta.html#cb28-41" tabindex="-1"></a>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(<span class="at">Xs =</span> Xk, </span>
<span id="cb28-42"><a href="armonizar_encuesta.html#cb28-42" tabindex="-1"></a>            <span class="at">d =</span> encuesta_ampliada<span class="sc">$</span>n,</span>
<span id="cb28-43"><a href="armonizar_encuesta.html#cb28-43" tabindex="-1"></a>            <span class="at">total =</span> N.g,</span>
<span id="cb28-44"><a href="armonizar_encuesta.html#cb28-44" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">&quot;linear&quot;</span>) <span class="co"># linear primera opcion  </span></span>
<span id="cb28-45"><a href="armonizar_encuesta.html#cb28-45" tabindex="-1"></a></span>
<span id="cb28-46"><a href="armonizar_encuesta.html#cb28-46" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> Xk, </span>
<span id="cb28-47"><a href="armonizar_encuesta.html#cb28-47" tabindex="-1"></a>                 <span class="at">d =</span> encuesta_ampliada<span class="sc">$</span>n,</span>
<span id="cb28-48"><a href="armonizar_encuesta.html#cb28-48" tabindex="-1"></a>                 <span class="at">total =</span> N.g,</span>
<span id="cb28-49"><a href="armonizar_encuesta.html#cb28-49" tabindex="-1"></a>                 <span class="at">g =</span> gk)</span>
<span id="cb28-50"><a href="armonizar_encuesta.html#cb28-50" tabindex="-1"></a></span>
<span id="cb28-51"><a href="armonizar_encuesta.html#cb28-51" tabindex="-1"></a><span class="fu">hist</span>(gk)</span>
<span id="cb28-52"><a href="armonizar_encuesta.html#cb28-52" tabindex="-1"></a><span class="fu">summary</span>(gk)</span>
<span id="cb28-53"><a href="armonizar_encuesta.html#cb28-53" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> gk), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb28-54"><a href="armonizar_encuesta.html#cb28-54" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fu">diff</span>(<span class="fu">range</span>(gk)) <span class="sc">/</span> <span class="dv">20</span>,</span>
<span id="cb28-55"><a href="armonizar_encuesta.html#cb28-55" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb28-56"><a href="armonizar_encuesta.html#cb28-56" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-57"><a href="armonizar_encuesta.html#cb28-57" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-58"><a href="armonizar_encuesta.html#cb28-58" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-59"><a href="armonizar_encuesta.html#cb28-59" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb28-60"><a href="armonizar_encuesta.html#cb28-60" tabindex="-1"></a></span>
<span id="cb28-61"><a href="armonizar_encuesta.html#cb28-61" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> encuesta_ampliada<span class="sc">$</span>n <span class="sc">*</span> gk</span>
<span id="cb28-62"><a href="armonizar_encuesta.html#cb28-62" tabindex="-1"></a></span>
<span id="cb28-63"><a href="armonizar_encuesta.html#cb28-63" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> encuesta_ampliada<span class="sc">$</span>n, <span class="at">y =</span> n1), <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb28-64"><a href="armonizar_encuesta.html#cb28-64" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co"># Agregar puntos</span></span>
<span id="cb28-65"><a href="armonizar_encuesta.html#cb28-65" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb28-66"><a href="armonizar_encuesta.html#cb28-66" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Conteo censales antes&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Conteos censales después&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-67"><a href="armonizar_encuesta.html#cb28-67" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="dv">20</span>)</span>
<span id="cb28-68"><a href="armonizar_encuesta.html#cb28-68" tabindex="-1"></a></span>
<span id="cb28-69"><a href="armonizar_encuesta.html#cb28-69" tabindex="-1"></a>encuesta_ampliada<span class="sc">$</span>n <span class="ot">&lt;-</span> encuesta_ampliada<span class="sc">$</span>n <span class="sc">*</span> gk</span>
<span id="cb28-70"><a href="armonizar_encuesta.html#cb28-70" tabindex="-1"></a></span>
<span id="cb28-71"><a href="armonizar_encuesta.html#cb28-71" tabindex="-1"></a><span class="co"># Se guarda el conjunto de datos ampliado:</span></span>
<span id="cb28-72"><a href="armonizar_encuesta.html#cb28-72" tabindex="-1"></a><span class="fu">saveRDS</span>(encuesta_ampliada, <span class="st">&quot;../output/2020/encuesta_ampliada.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estandarizar_muestra_cuestionario_ampliado.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="validacion_encuestas.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2023MEXsae/04_Armonizar_encuesta.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.pdf", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.epub", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

</body>

</html>
