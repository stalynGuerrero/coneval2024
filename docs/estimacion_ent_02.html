<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 14 13_Estimacion_ent_02.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024</title>
  <meta name="description" content="Manual de procesamiento." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 14 13_Estimacion_ent_02.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Manual de procesamiento." />
  <meta name="github-repo" content="psirusteam/coneval" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 14 13_Estimacion_ent_02.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024" />
  
  <meta name="twitter:description" content="Manual de procesamiento." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero" />


<meta name="date" content="2024-07-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="imputacion_censal.html"/>
<link rel="next" href="estimacion_municipios_ipm_pobreza.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Taller de instalación de capacidades en SAE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="respositodio-de-códigos.html"><a href="respositodio-de-códigos.html"><i class="fa fa-check"></i>Respositodio de códigos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="librerias-de-r-y-otros-insumos.html"><a href="librerias-de-r-y-otros-insumos.html"><i class="fa fa-check"></i>Librerias de <em>R</em> y otros insumos</a>
<ul>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html"><i class="fa fa-check"></i>Librerías Utilizadas</a>
<ul>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#manipulación-y-transformación-de-datos"><i class="fa fa-check"></i>Manipulación y Transformación de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#lectura-y-escritura-de-datos"><i class="fa fa-check"></i>Lectura y Escritura de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#análisis-de-datos-de-encuestas"><i class="fa fa-check"></i>Análisis de Datos de Encuestas</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#modelado-y-análisis-estadístico"><i class="fa fa-check"></i>Modelado y Análisis Estadístico</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#visualización-de-datos"><i class="fa fa-check"></i>Visualización de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#informes-y-reproducibilidad"><i class="fa fa-check"></i>Informes y Reproducibilidad</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#integración-con-otros-lenguajes"><i class="fa fa-check"></i>Integración con Otros Lenguajes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bases-de-datos-utilizadas.html"><a href="bases-de-datos-utilizadas.html"><i class="fa fa-check"></i>Bases de Datos Utilizadas</a></li>
<li class="chapter" data-level="" data-path="estructura-del-proyecto.html"><a href="estructura-del-proyecto.html"><i class="fa fa-check"></i>Estructura del Proyecto</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="union_bases.html"><a href="union_bases.html"><i class="fa fa-check"></i><b>1</b> 00_union_bases.R</a></li>
<li class="chapter" data-level="2" data-path="descarga_satelitales.html"><a href="descarga_satelitales.html"><i class="fa fa-check"></i><b>2</b> 01_Descarga_satelitales.R</a></li>
<li class="chapter" data-level="3" data-path="union_predictores.html"><a href="union_predictores.html"><i class="fa fa-check"></i><b>3</b> 02_Union_predictores.R</a></li>
<li class="chapter" data-level="4" data-path="estandarizar_muestra_cuestionario_ampliado.html"><a href="estandarizar_muestra_cuestionario_ampliado.html"><i class="fa fa-check"></i><b>4</b> 03_Estandarizar_muestra_cuestionario_ampliado.R</a></li>
<li class="chapter" data-level="5" data-path="armonizar_encuesta.html"><a href="armonizar_encuesta.html"><i class="fa fa-check"></i><b>5</b> 04_Armonizar_encuesta.R</a></li>
<li class="chapter" data-level="6" data-path="validacion_encuestas.html"><a href="validacion_encuestas.html"><i class="fa fa-check"></i><b>6</b> 05_Validacion_encuestas.R</a></li>
<li class="chapter" data-level="7" data-path="modelo_unidad_ictpc.html"><a href="modelo_unidad_ictpc.html"><i class="fa fa-check"></i><b>7</b> 06_Modelo_unidad_ictpc.R</a></li>
<li class="chapter" data-level="8" data-path="modelo_unidad_py_ic_ali_nc.html"><a href="modelo_unidad_py_ic_ali_nc.html"><i class="fa fa-check"></i><b>8</b> 07_Modelo_unidad_py_ic_ali_nc.R</a></li>
<li class="chapter" data-level="9" data-path="modelo_unidad_py_ic_segsoc.html"><a href="modelo_unidad_py_ic_segsoc.html"><i class="fa fa-check"></i><b>9</b> 08_Modelo_unidad_py_ic_segsoc</a></li>
<li class="chapter" data-level="10" data-path="postbenchmarking_ictpc.html"><a href="postbenchmarking_ictpc.html"><i class="fa fa-check"></i><b>10</b> 09_PostBenchmarking_ictpc.R</a></li>
<li class="chapter" data-level="11" data-path="postbenchmarking_ic_ali_nc.html"><a href="postbenchmarking_ic_ali_nc.html"><i class="fa fa-check"></i><b>11</b> 10_PostBenchmarking_ic_ali_nc.R</a></li>
<li class="chapter" data-level="12" data-path="postbenchmarking_ic_segsoc.html"><a href="postbenchmarking_ic_segsoc.html"><i class="fa fa-check"></i><b>12</b> 11_PostBenchmarking_ic_segsoc.r</a></li>
<li class="chapter" data-level="13" data-path="imputacion_censal.html"><a href="imputacion_censal.html"><i class="fa fa-check"></i><b>13</b> 12_Imputacion_censal.R</a></li>
<li class="chapter" data-level="14" data-path="estimacion_ent_02.html"><a href="estimacion_ent_02.html"><i class="fa fa-check"></i><b>14</b> 13_Estimacion_ent_02.R</a></li>
<li class="chapter" data-level="15" data-path="estimacion_municipios_ipm_pobreza.html"><a href="estimacion_municipios_ipm_pobreza.html"><i class="fa fa-check"></i><b>15</b> 14_estimacion_municipios_ipm_pobreza.R</a></li>
<li class="chapter" data-level="16" data-path="estimacion_municipios_ipm_pobreza_error.html"><a href="estimacion_municipios_ipm_pobreza_error.html"><i class="fa fa-check"></i><b>16</b> 15_estimacion_municipios_ipm_pobreza_error.R</a></li>
<li class="chapter" data-level="17" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i><b>17</b> 16_Mapas.R</a></li>
<li class="chapter" data-level="18" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html"><i class="fa fa-check"></i><b>18</b> 17_estimacion_municipios_carencias.R</a></li>
<li class="chapter" data-level="19" data-path="estimacion_municipios_carencias_error.html"><a href="estimacion_municipios_carencias_error.html"><i class="fa fa-check"></i><b>19</b> 18_estimacion_municipios_carencias_error.R</a></li>
<li class="chapter" data-level="20" data-path="mapas_carencias.html"><a href="mapas_carencias.html"><i class="fa fa-check"></i><b>20</b> 19_Mapas_carencias.R</a></li>
<li class="divider"></li>
<li><a Taller de instalación de capacidades en SAE </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="estimacion_ent_02.r" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">Capítulo 14</span> 13_Estimacion_ent_02.R<a href="estimacion_ent_02.html#estimacion_ent_02.r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Para la ejecución del presente archivo, debe abrir el archivo <strong>13_Estimacion_ent_02.R</strong> disponible en la ruta <em>Rcodes/2020/13_Estimacion_ent_02.R</em>.</p>
<div id="inicialización-y-carga-de-librerías" class="section level4 unnumbered hasAnchor">
<h4>Inicialización y Carga de Librerías<a href="estimacion_ent_02.html#inicialización-y-carga-de-librerías" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta primera sección, se limpia el entorno de trabajo eliminando todas las variables y objetos existentes mediante <code>rm(list = ls())</code>. A continuación, se cargan diversas librerías necesarias para el análisis de datos y modelado, como <code>patchwork</code> para la visualización, <code>lme4</code> para modelos lineales mixtos, <code>tidyverse</code> para manipulación de datos, y otras librerías específicas para análisis de encuestas y predicción. También se incluye un archivo externo de funciones llamado <code>modelos_freq.R</code>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="estimacion_ent_02.html#cb78-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb78-2"><a href="estimacion_ent_02.html#cb78-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb78-3"><a href="estimacion_ent_02.html#cb78-3" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb78-4"><a href="estimacion_ent_02.html#cb78-4" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb78-5"><a href="estimacion_ent_02.html#cb78-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb78-6"><a href="estimacion_ent_02.html#cb78-6" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb78-7"><a href="estimacion_ent_02.html#cb78-7" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb78-8"><a href="estimacion_ent_02.html#cb78-8" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb78-9"><a href="estimacion_ent_02.html#cb78-9" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb78-10"><a href="estimacion_ent_02.html#cb78-10" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb78-11"><a href="estimacion_ent_02.html#cb78-11" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../source/modelos_freq.R&quot;</span>)</span></code></pre></div>
</div>
<div id="configuración-del-nivel-de-agregación-y-carga-de-datos" class="section level4 unnumbered hasAnchor">
<h4>Configuración del Nivel de Agregación y Carga de Datos<a href="estimacion_ent_02.html#configuración-del-nivel-de-agregación-y-carga-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Aquí se define un vector <code>byAgrega</code> que especifica los niveles de agregación para el análisis, como entidad, municipio, área, y variables demográficas.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="estimacion_ent_02.html#cb79-1" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span></span>
<span id="cb79-2"><a href="estimacion_ent_02.html#cb79-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;ent&quot;</span>,</span>
<span id="cb79-3"><a href="estimacion_ent_02.html#cb79-3" tabindex="-1"></a>    <span class="st">&quot;cve_mun&quot;</span>,</span>
<span id="cb79-4"><a href="estimacion_ent_02.html#cb79-4" tabindex="-1"></a>    <span class="st">&quot;area&quot;</span>,</span>
<span id="cb79-5"><a href="estimacion_ent_02.html#cb79-5" tabindex="-1"></a>    <span class="st">&quot;sexo&quot;</span>,</span>
<span id="cb79-6"><a href="estimacion_ent_02.html#cb79-6" tabindex="-1"></a>    <span class="st">&quot;edad&quot;</span>,</span>
<span id="cb79-7"><a href="estimacion_ent_02.html#cb79-7" tabindex="-1"></a>    <span class="st">&quot;discapacidad&quot;</span>,</span>
<span id="cb79-8"><a href="estimacion_ent_02.html#cb79-8" tabindex="-1"></a>    <span class="st">&quot;hlengua&quot;</span>,</span>
<span id="cb79-9"><a href="estimacion_ent_02.html#cb79-9" tabindex="-1"></a>    <span class="st">&quot;nivel_edu&quot;</span> )</span>
<span id="cb79-10"><a href="estimacion_ent_02.html#cb79-10" tabindex="-1"></a></span>
<span id="cb79-11"><a href="estimacion_ent_02.html#cb79-11" tabindex="-1"></a><span class="fu">memory.limit</span>(<span class="dv">10000000</span>)</span></code></pre></div>
<p>Esta sección carga y filtra los datos necesarios desde archivos RDS y CSV. Se establece un límite de memoria y se cargan varios conjuntos de datos relevantes para el análisis, como la encuesta <code>enigh</code>, datos del censo, y predictores a nivel estatal. También se carga un archivo de líneas de bienestar y se actualizan los nombres de las variables para el análisis.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="estimacion_ent_02.html#cb80-1" tabindex="-1"></a>encuesta_enigh <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/enigh/encuesta_sta.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="estimacion_ent_02.html#cb80-2" tabindex="-1"></a>  <span class="fu">filter</span>(ent <span class="sc">==</span> <span class="st">&quot;02&quot;</span>, ictpc <span class="sc">&lt;=</span> <span class="dv">10000</span>)</span>
<span id="cb80-3"><a href="estimacion_ent_02.html#cb80-3" tabindex="-1"></a>censo_sta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/muestra_ampliada/muestra_cuestionario_ampliado.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-4"><a href="estimacion_ent_02.html#cb80-4" tabindex="-1"></a>  <span class="fu">filter</span>(ent <span class="sc">==</span> <span class="st">&quot;02&quot;</span>)</span>
<span id="cb80-5"><a href="estimacion_ent_02.html#cb80-5" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/predictores/statelevel_predictors_df.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-6"><a href="estimacion_ent_02.html#cb80-6" tabindex="-1"></a>  <span class="fu">filter</span>(ent <span class="sc">==</span> <span class="st">&quot;02&quot;</span>)</span>
<span id="cb80-7"><a href="estimacion_ent_02.html#cb80-7" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;output/2020/encuesta_ampliada.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-8"><a href="estimacion_ent_02.html#cb80-8" tabindex="-1"></a>  <span class="fu">filter</span>(ent <span class="sc">==</span> <span class="st">&quot;02&quot;</span>)</span>
<span id="cb80-9"><a href="estimacion_ent_02.html#cb80-9" tabindex="-1"></a>LB <span class="ot">&lt;-</span></span>
<span id="cb80-10"><a href="estimacion_ent_02.html#cb80-10" tabindex="-1"></a>  <span class="fu">read.delim</span>(</span>
<span id="cb80-11"><a href="estimacion_ent_02.html#cb80-11" tabindex="-1"></a>    <span class="st">&quot;../input/2020/Lineas_Bienestar.csv&quot;</span>,</span>
<span id="cb80-12"><a href="estimacion_ent_02.html#cb80-12" tabindex="-1"></a>    <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-13"><a href="estimacion_ent_02.html#cb80-13" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb80-14"><a href="estimacion_ent_02.html#cb80-14" tabindex="-1"></a>    <span class="at">dec =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb80-15"><a href="estimacion_ent_02.html#cb80-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">as.character</span>(area))</span>
<span id="cb80-16"><a href="estimacion_ent_02.html#cb80-16" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">names</span>(statelevel_predictors_df)</span>
<span id="cb80-17"><a href="estimacion_ent_02.html#cb80-17" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> cov_names[<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">x =</span> cov_names, <span class="at">pattern =</span> <span class="st">&quot;^hog_|cve_mun&quot;</span>)]</span></code></pre></div>
</div>
<div id="preparación-de-datos-y-modelado" class="section level4 unnumbered hasAnchor">
<h4>Preparación de Datos y Modelado<a href="estimacion_ent_02.html#preparación-de-datos-y-modelado" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Aquí se preparan los datos combinando diferentes conjuntos mediante <code>inner_join</code> para integrar información de predictores estatales y líneas de bienestar con la muestra ampliada.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="estimacion_ent_02.html#cb81-1" tabindex="-1"></a>col_names_muestra <span class="ot">&lt;-</span> <span class="fu">names</span>(muestra_ampliada)</span>
<span id="cb81-2"><a href="estimacion_ent_02.html#cb81-2" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span>  <span class="fu">inner_join</span>(muestra_ampliada, statelevel_predictors_df)</span>
<span id="cb81-3"><a href="estimacion_ent_02.html#cb81-3" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span> muestra_ampliada <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(LB)</span></code></pre></div>
</div>
<div id="modelado-del-ingreso" class="section level4 unnumbered hasAnchor">
<h4>Modelado del Ingreso<a href="estimacion_ent_02.html#modelado-del-ingreso" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se seleccionan y preparan las variables para modelar el ingreso. Se define la fórmula del modelo que incluye efectos aleatorios y fijos, y se ajusta un modelo usando la función <code>modelo_ingreso</code>. Los resultados del modelo se guardan en <code>fit_ingreso</code>.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="estimacion_ent_02.html#cb82-1" tabindex="-1"></a>variables_seleccionadas <span class="ot">&lt;-</span></span>
<span id="cb82-2"><a href="estimacion_ent_02.html#cb82-2" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb82-3"><a href="estimacion_ent_02.html#cb82-3" tabindex="-1"></a>    <span class="st">&quot;prom_esc_rel_urb&quot;</span>,</span>
<span id="cb82-4"><a href="estimacion_ent_02.html#cb82-4" tabindex="-1"></a>    <span class="st">&quot;smg1&quot;</span>,</span>
<span id="cb82-5"><a href="estimacion_ent_02.html#cb82-5" tabindex="-1"></a>    <span class="st">&quot;gini15m&quot;</span>,</span>
<span id="cb82-6"><a href="estimacion_ent_02.html#cb82-6" tabindex="-1"></a>    <span class="st">&quot;ictpc15&quot;</span>,</span>
<span id="cb82-7"><a href="estimacion_ent_02.html#cb82-7" tabindex="-1"></a>    <span class="st">&quot;altitud1000&quot;</span>,</span>
<span id="cb82-8"><a href="estimacion_ent_02.html#cb82-8" tabindex="-1"></a>    <span class="st">&quot;prom_esc_rel_rur&quot;</span>,</span>
<span id="cb82-9"><a href="estimacion_ent_02.html#cb82-9" tabindex="-1"></a>    <span class="st">&quot;porc_patnoagrnocal_urb&quot;</span>,</span>
<span id="cb82-10"><a href="estimacion_ent_02.html#cb82-10" tabindex="-1"></a>    <span class="st">&quot;acc_medio&quot;</span>,</span>
<span id="cb82-11"><a href="estimacion_ent_02.html#cb82-11" tabindex="-1"></a>    <span class="st">&quot;derhab_pea_15_20&quot;</span>,</span>
<span id="cb82-12"><a href="estimacion_ent_02.html#cb82-12" tabindex="-1"></a>    <span class="st">&quot;porc_norep_ing_urb&quot;</span></span>
<span id="cb82-13"><a href="estimacion_ent_02.html#cb82-13" tabindex="-1"></a>  )</span>
<span id="cb82-14"><a href="estimacion_ent_02.html#cb82-14" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb82-15"><a href="estimacion_ent_02.html#cb82-15" tabindex="-1"></a>  <span class="st">&quot;modifica_humana&quot;</span>, <span class="st">&quot;acceso_hosp&quot;</span>,</span>
<span id="cb82-16"><a href="estimacion_ent_02.html#cb82-16" tabindex="-1"></a>  <span class="st">&quot;acceso_hosp_caminando&quot;</span>, <span class="st">&quot;cubrimiento_cultivo&quot;</span>,</span>
<span id="cb82-17"><a href="estimacion_ent_02.html#cb82-17" tabindex="-1"></a>  <span class="st">&quot;cubrimiento_urbano&quot;</span>, <span class="st">&quot;luces_nocturnas&quot;</span>,</span>
<span id="cb82-18"><a href="estimacion_ent_02.html#cb82-18" tabindex="-1"></a>  variables_seleccionadas</span>
<span id="cb82-19"><a href="estimacion_ent_02.html#cb82-19" tabindex="-1"></a>)</span>
<span id="cb82-20"><a href="estimacion_ent_02.html#cb82-20" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(</span>
<span id="cb82-21"><a href="estimacion_ent_02.html#cb82-21" tabindex="-1"></a>  cov_names,</span>
<span id="cb82-22"><a href="estimacion_ent_02.html#cb82-22" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb82-23"><a href="estimacion_ent_02.html#cb82-23" tabindex="-1"></a>    <span class="st">&quot;elec_mun20&quot;</span>,</span>
<span id="cb82-24"><a href="estimacion_ent_02.html#cb82-24" tabindex="-1"></a>    <span class="st">&quot;elec_mun19&quot;</span>,</span>
<span id="cb82-25"><a href="estimacion_ent_02.html#cb82-25" tabindex="-1"></a>    <span class="st">&quot;transf_gobpc_15_20&quot;</span>,</span>
<span id="cb82-26"><a href="estimacion_ent_02.html#cb82-26" tabindex="-1"></a>    <span class="st">&quot;derhab_pea_15_20&quot;</span>,</span>
<span id="cb82-27"><a href="estimacion_ent_02.html#cb82-27" tabindex="-1"></a>    <span class="st">&quot;vabpc_15_19&quot;</span>,</span>
<span id="cb82-28"><a href="estimacion_ent_02.html#cb82-28" tabindex="-1"></a>    <span class="st">&quot;itlpis_15_20&quot;</span>,</span>
<span id="cb82-29"><a href="estimacion_ent_02.html#cb82-29" tabindex="-1"></a>    <span class="st">&quot;remespc_15_20&quot;</span>,</span>
<span id="cb82-30"><a href="estimacion_ent_02.html#cb82-30" tabindex="-1"></a>    <span class="st">&quot;desem_15_20&quot;</span>,</span>
<span id="cb82-31"><a href="estimacion_ent_02.html#cb82-31" tabindex="-1"></a>    <span class="st">&quot;smg1&quot;</span>,</span>
<span id="cb82-32"><a href="estimacion_ent_02.html#cb82-32" tabindex="-1"></a>    <span class="st">&quot;ql_porc_cpa_urb&quot;</span>,</span>
<span id="cb82-33"><a href="estimacion_ent_02.html#cb82-33" tabindex="-1"></a>    <span class="st">&quot;ql_porc_cpa_rur&quot;</span></span>
<span id="cb82-34"><a href="estimacion_ent_02.html#cb82-34" tabindex="-1"></a>  )</span>
<span id="cb82-35"><a href="estimacion_ent_02.html#cb82-35" tabindex="-1"></a>)</span>
<span id="cb82-36"><a href="estimacion_ent_02.html#cb82-36" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cov_registros, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)</span>
<span id="cb82-37"><a href="estimacion_ent_02.html#cb82-37" tabindex="-1"></a>formula_model <span class="ot">&lt;-</span> </span>
<span id="cb82-38"><a href="estimacion_ent_02.html#cb82-38" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;ingreso ~ (1 | cve_mun) + (1 | hlengua) + (1 | discapacidad)  + nivel_edu +  edad + area + sexo +&quot;</span>, </span>
<span id="cb82-39"><a href="estimacion_ent_02.html#cb82-39" tabindex="-1"></a>      <span class="st">&quot; + &quot;</span>, cov_registros)</span>
<span id="cb82-40"><a href="estimacion_ent_02.html#cb82-40" tabindex="-1"></a>encuesta_enigh<span class="sc">$</span>ingreso <span class="ot">&lt;-</span> (<span class="fu">as.numeric</span>(encuesta_enigh<span class="sc">$</span>ictpc))</span>
<span id="cb82-41"><a href="estimacion_ent_02.html#cb82-41" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">modelo_ingreso</span>(</span>
<span id="cb82-42"><a href="estimacion_ent_02.html#cb82-42" tabindex="-1"></a>  <span class="at">encuesta_sta =</span> encuesta_enigh,</span>
<span id="cb82-43"><a href="estimacion_ent_02.html#cb82-43" tabindex="-1"></a>  <span class="at">predictors =</span> statelevel_predictors_df,</span>
<span id="cb82-44"><a href="estimacion_ent_02.html#cb82-44" tabindex="-1"></a>  <span class="at">censo_sta =</span> censo_sta,</span>
<span id="cb82-45"><a href="estimacion_ent_02.html#cb82-45" tabindex="-1"></a>  <span class="at">formula_mod =</span> formula_model,</span>
<span id="cb82-46"><a href="estimacion_ent_02.html#cb82-46" tabindex="-1"></a>  <span class="at">byAgrega =</span> byAgrega</span>
<span id="cb82-47"><a href="estimacion_ent_02.html#cb82-47" tabindex="-1"></a>)</span>
<span id="cb82-48"><a href="estimacion_ent_02.html#cb82-48" tabindex="-1"></a>fit_ingreso <span class="ot">&lt;-</span> fit<span class="sc">$</span>fit_mrp</span></code></pre></div>
</div>
<div id="modelado-de-alimentos-de-calidad-y-seguridad-social" class="section level4 unnumbered hasAnchor">
<h4>Modelado de Alimentos de Calidad y Seguridad Social<a href="estimacion_ent_02.html#modelado-de-alimentos-de-calidad-y-seguridad-social" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Esta sección es similar a la anterior, pero se enfoca en modelar la calidad de alimentos y seguridad social. Se ajustan modelos para alimentos de calidad y seguridad social, con fórmulas adecuadas y utilizando la función <code>modelo_dummy</code>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="estimacion_ent_02.html#cb83-1" tabindex="-1"></a>variables_seleccionadas <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb83-2"><a href="estimacion_ent_02.html#cb83-2" tabindex="-1"></a>  <span class="st">&quot;porc_ing_ilpi_urb&quot;</span>,</span>
<span id="cb83-3"><a href="estimacion_ent_02.html#cb83-3" tabindex="-1"></a>  <span class="st">&quot;pob_ind_rur&quot;</span>,</span>
<span id="cb83-4"><a href="estimacion_ent_02.html#cb83-4" tabindex="-1"></a>  <span class="st">&quot;pob_ind_urb&quot;</span>,</span>
<span id="cb83-5"><a href="estimacion_ent_02.html#cb83-5" tabindex="-1"></a>  <span class="st">&quot;porc_hogremesas_rur&quot;</span>,</span>
<span id="cb83-6"><a href="estimacion_ent_02.html#cb83-6" tabindex="-1"></a>  <span class="st">&quot;porc_segsoc15&quot;</span>,</span>
<span id="cb83-7"><a href="estimacion_ent_02.html#cb83-7" tabindex="-1"></a>  <span class="st">&quot;porc_ali15&quot;</span>,</span>
<span id="cb83-8"><a href="estimacion_ent_02.html#cb83-8" tabindex="-1"></a>  <span class="st">&quot;plp15&quot;</span>,</span>
<span id="cb83-9"><a href="estimacion_ent_02.html#cb83-9" tabindex="-1"></a>  <span class="st">&quot;pob_rur&quot;</span>,</span>
<span id="cb83-10"><a href="estimacion_ent_02.html#cb83-10" tabindex="-1"></a>  <span class="st">&quot;altitud1000&quot;</span></span>
<span id="cb83-11"><a href="estimacion_ent_02.html#cb83-11" tabindex="-1"></a>)</span>
<span id="cb83-12"><a href="estimacion_ent_02.html#cb83-12" tabindex="-1"></a></span>
<span id="cb83-13"><a href="estimacion_ent_02.html#cb83-13" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb83-14"><a href="estimacion_ent_02.html#cb83-14" tabindex="-1"></a>  <span class="st">&quot;modifica_humana&quot;</span>, <span class="st">&quot;acceso_hosp&quot;</span>,</span>
<span id="cb83-15"><a href="estimacion_ent_02.html#cb83-15" tabindex="-1"></a>  <span class="st">&quot;acceso_hosp_caminando&quot;</span>, <span class="st">&quot;cubrimiento_cultivo&quot;</span>,</span>
<span id="cb83-16"><a href="estimacion_ent_02.html#cb83-16" tabindex="-1"></a>  <span class="st">&quot;cubrimiento_urbano&quot;</span>, <span class="st">&quot;luces_nocturnas&quot;</span>,</span>
<span id="cb83-17"><a href="estimacion_ent_02.html#cb83-17" tabindex="-1"></a>  variables_seleccionadas</span>
<span id="cb83-18"><a href="estimacion_ent_02.html#cb83-18" tabindex="-1"></a>)</span>
<span id="cb83-19"><a href="estimacion_ent_02.html#cb83-19" tabindex="-1"></a></span>
<span id="cb83-20"><a href="estimacion_ent_02.html#cb83-20" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(</span>
<span id="cb83-21"><a href="estimacion_ent_02.html#cb83-21" tabindex="-1"></a>  cov_names,</span>
<span id="cb83-22"><a href="estimacion_ent_02.html#cb83-22" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb83-23"><a href="estimacion_ent_02.html#cb83-23" tabindex="-1"></a>    <span class="st">&quot;elec_mun20&quot;</span>,</span>
<span id="cb83-24"><a href="estimacion_ent_02.html#cb83-24" tabindex="-1"></a>    <span class="st">&quot;elec_mun19&quot;</span>,</span>
<span id="cb83-25"><a href="estimacion_ent_02.html#cb83-25" tabindex="-1"></a>    <span class="st">&quot;transf_gobpc_15_20&quot;</span>,</span>
<span id="cb83-26"><a href="estimacion_ent_02.html#cb83-26" tabindex="-1"></a>    <span class="st">&quot;derhab_pea_15_20&quot;</span>,</span>
<span id="cb83-27"><a href="estimacion_ent_02.html#cb83-27" tabindex="-1"></a>    <span class="st">&quot;vabpc_15_19&quot;</span>,</span>
<span id="cb83-28"><a href="estimacion_ent_02.html#cb83-28" tabindex="-1"></a>    <span class="st">&quot;itlpis_15_20&quot;</span>,</span>
<span id="cb83-29"><a href="estimacion_ent_02.html#cb83-29" tabindex="-1"></a>    <span class="st">&quot;remespc_15_20&quot;</span>,</span>
<span id="cb83-30"><a href="estimacion_ent_02.html#cb83-30" tabindex="-1"></a>    <span class="st">&quot;desem_15_20&quot;</span>,</span>
<span id="cb83-31"><a href="estimacion_ent_02.html#cb83-31" tabindex="-1"></a>    <span class="st">&quot;porc_urb&quot;</span>,</span>
<span id="cb83-32"><a href="estimacion_ent_02.html#cb83-32" tabindex="-1"></a>    <span class="st">&quot;edad65mas_urb&quot;</span>,</span>
<span id="cb83-33"><a href="estimacion_ent_02.html#cb83-33" tabindex="-1"></a>    <span class="st">&quot;pob_tot&quot;</span>,</span>
<span id="cb83-34"><a href="estimacion_ent_02.html#cb83-34" tabindex="-1"></a>    <span class="st">&quot;acc_muyalto&quot;</span>,</span>
<span id="cb83-35"><a href="estimacion_ent_02.html#cb83-35" tabindex="-1"></a>    <span class="st">&quot;smg1&quot;</span>,</span>
<span id="cb83-36"><a href="estimacion_ent_02.html#cb83-36" tabindex="-1"></a>    <span class="st">&quot;ql_porc_cpa_rur&quot;</span>,</span>
<span id="cb83-37"><a href="estimacion_ent_02.html#cb83-37" tabindex="-1"></a>    <span class="st">&quot;ql_porc_cpa_urb&quot;</span></span>
<span id="cb83-38"><a href="estimacion_ent_02.html#cb83-38" tabindex="-1"></a>  )</span>
<span id="cb83-39"><a href="estimacion_ent_02.html#cb83-39" tabindex="-1"></a>)</span>
<span id="cb83-40"><a href="estimacion_ent_02.html#cb83-40" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cov_registros, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)</span>
<span id="cb83-41"><a href="estimacion_ent_02.html#cb83-41" tabindex="-1"></a>formula_model <span class="ot">&lt;-</span> </span>
<span id="cb83-42"><a href="estimacion_ent_02.html#cb83-42" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb83-43"><a href="estimacion_ent_02.html#cb83-43" tabindex="-1"></a>    <span class="st">&quot;cbind(si, no) ~ (1 | cve_mun) + (1 | hlengua) + (1 | discapacidad) + nivel_edu + edad + area + sexo &quot;</span>,</span>
<span id="cb83-44"><a href="estimacion_ent_02.html#cb83-44" tabindex="-1"></a>    <span class="st">&quot; + &quot;</span>,</span>
<span id="cb83-45"><a href="estimacion_ent_02.html#cb83-45" tabindex="-1"></a>    cov_registros</span>
<span id="cb83-46"><a href="estimacion_ent_02.html#cb83-46" tabindex="-1"></a>  )</span>
<span id="cb83-47"><a href="estimacion_ent_02.html#cb83-47" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">modelo_dummy</span>(</span>
<span id="cb83-48"><a href="estimacion_ent_02.html#cb83-48" tabindex="-1"></a>  <span class="at">encuesta_sta =</span> encuesta_enigh <span class="sc">%&gt;%</span>  </span>
<span id="cb83-49"><a href="estimacion_ent_02.html#cb83-49" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yk =</span> <span class="fu">ifelse</span>(ic_ali_nc <span class="sc">==</span> <span class="dv">1</span> , <span class="dv">1</span>, <span class="dv">0</span>)),</span>
<span id="cb83-50"><a href="estimacion_ent_02.html#cb83-50" tabindex="-1"></a>  <span class="at">predictors =</span> statelevel_predictors_df,</span>
<span id="cb83-51"><a href="estimacion_ent_02.html#cb83-51" tabindex="-1"></a>  <span class="at">censo_sta =</span> censo_sta,</span>
<span id="cb83-52"><a href="estimacion_ent_02.html#cb83-52" tabindex="-1"></a>  <span class="at">formula_mod =</span> formula_model,</span>
<span id="cb83-53"><a href="estimacion_ent_02.html#cb83-53" tabindex="-1"></a>  <span class="at">byAgrega =</span> byAgrega</span>
<span id="cb83-54"><a href="estimacion_ent_02.html#cb83-54" tabindex="-1"></a>)</span>
<span id="cb83-55"><a href="estimacion_ent_02.html#cb83-55" tabindex="-1"></a>fit_alimento <span class="ot">&lt;-</span> fit<span class="sc">$</span>fit_mrp</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="estimacion_ent_02.html#cb84-1" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb84-2"><a href="estimacion_ent_02.html#cb84-2" tabindex="-1"></a><span class="co"># modelo para seguridad social  #</span></span>
<span id="cb84-3"><a href="estimacion_ent_02.html#cb84-3" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb84-4"><a href="estimacion_ent_02.html#cb84-4" tabindex="-1"></a></span>
<span id="cb84-5"><a href="estimacion_ent_02.html#cb84-5" tabindex="-1"></a>variables_seleccionadas <span class="ot">&lt;-</span></span>
<span id="cb84-6"><a href="estimacion_ent_02.html#cb84-6" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb84-7"><a href="estimacion_ent_02.html#cb84-7" tabindex="-1"></a>    <span class="st">&quot;porc_rur&quot;</span>,</span>
<span id="cb84-8"><a href="estimacion_ent_02.html#cb84-8" tabindex="-1"></a>    <span class="st">&quot;porc_urb&quot;</span>,</span>
<span id="cb84-9"><a href="estimacion_ent_02.html#cb84-9" tabindex="-1"></a>    <span class="st">&quot;porc_ing_ilpi_rur&quot;</span>,</span>
<span id="cb84-10"><a href="estimacion_ent_02.html#cb84-10" tabindex="-1"></a>    <span class="st">&quot;porc_ing_ilpi_urb&quot;</span>,</span>
<span id="cb84-11"><a href="estimacion_ent_02.html#cb84-11" tabindex="-1"></a>    <span class="st">&quot;porc_jub_urb&quot;</span>,</span>
<span id="cb84-12"><a href="estimacion_ent_02.html#cb84-12" tabindex="-1"></a>    <span class="st">&quot;porc_segsoc15&quot;</span>,</span>
<span id="cb84-13"><a href="estimacion_ent_02.html#cb84-13" tabindex="-1"></a>    <span class="st">&quot;plp15&quot;</span>,</span>
<span id="cb84-14"><a href="estimacion_ent_02.html#cb84-14" tabindex="-1"></a>    <span class="st">&quot;ictpc15&quot;</span>,</span>
<span id="cb84-15"><a href="estimacion_ent_02.html#cb84-15" tabindex="-1"></a>    <span class="st">&quot;pob_urb&quot;</span>,</span>
<span id="cb84-16"><a href="estimacion_ent_02.html#cb84-16" tabindex="-1"></a>    <span class="st">&quot;pob_tot&quot;</span></span>
<span id="cb84-17"><a href="estimacion_ent_02.html#cb84-17" tabindex="-1"></a>  )</span>
<span id="cb84-18"><a href="estimacion_ent_02.html#cb84-18" tabindex="-1"></a>cov_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb84-19"><a href="estimacion_ent_02.html#cb84-19" tabindex="-1"></a>  <span class="st">&quot;modifica_humana&quot;</span>,</span>
<span id="cb84-20"><a href="estimacion_ent_02.html#cb84-20" tabindex="-1"></a>  <span class="st">&quot;acceso_hosp&quot;</span>,</span>
<span id="cb84-21"><a href="estimacion_ent_02.html#cb84-21" tabindex="-1"></a>  <span class="st">&quot;acceso_hosp_caminando&quot;</span>,</span>
<span id="cb84-22"><a href="estimacion_ent_02.html#cb84-22" tabindex="-1"></a>  <span class="st">&quot;cubrimiento_cultivo&quot;</span>,</span>
<span id="cb84-23"><a href="estimacion_ent_02.html#cb84-23" tabindex="-1"></a>  <span class="st">&quot;cubrimiento_urbano&quot;</span>,</span>
<span id="cb84-24"><a href="estimacion_ent_02.html#cb84-24" tabindex="-1"></a>  <span class="st">&quot;luces_nocturnas&quot;</span> ,</span>
<span id="cb84-25"><a href="estimacion_ent_02.html#cb84-25" tabindex="-1"></a>  variables_seleccionadas</span>
<span id="cb84-26"><a href="estimacion_ent_02.html#cb84-26" tabindex="-1"></a>)</span>
<span id="cb84-27"><a href="estimacion_ent_02.html#cb84-27" tabindex="-1"></a></span>
<span id="cb84-28"><a href="estimacion_ent_02.html#cb84-28" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span></span>
<span id="cb84-29"><a href="estimacion_ent_02.html#cb84-29" tabindex="-1"></a>  <span class="fu">setdiff</span>(</span>
<span id="cb84-30"><a href="estimacion_ent_02.html#cb84-30" tabindex="-1"></a>    cov_names,</span>
<span id="cb84-31"><a href="estimacion_ent_02.html#cb84-31" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb84-32"><a href="estimacion_ent_02.html#cb84-32" tabindex="-1"></a>      <span class="st">&quot;elec_mun20&quot;</span>,</span>
<span id="cb84-33"><a href="estimacion_ent_02.html#cb84-33" tabindex="-1"></a>      <span class="st">&quot;elec_mun19&quot;</span>,</span>
<span id="cb84-34"><a href="estimacion_ent_02.html#cb84-34" tabindex="-1"></a>      <span class="st">&quot;transf_gobpc_15_20&quot;</span>,</span>
<span id="cb84-35"><a href="estimacion_ent_02.html#cb84-35" tabindex="-1"></a>      <span class="st">&quot;derhab_pea_15_20&quot;</span>,</span>
<span id="cb84-36"><a href="estimacion_ent_02.html#cb84-36" tabindex="-1"></a>      <span class="st">&quot;vabpc_15_19&quot;</span> ,</span>
<span id="cb84-37"><a href="estimacion_ent_02.html#cb84-37" tabindex="-1"></a>      <span class="st">&quot;itlpis_15_20&quot;</span>  ,</span>
<span id="cb84-38"><a href="estimacion_ent_02.html#cb84-38" tabindex="-1"></a>      <span class="st">&quot;remespc_15_20&quot;</span>,</span>
<span id="cb84-39"><a href="estimacion_ent_02.html#cb84-39" tabindex="-1"></a>      <span class="st">&quot;desem_15_20&quot;</span>,</span>
<span id="cb84-40"><a href="estimacion_ent_02.html#cb84-40" tabindex="-1"></a>      <span class="st">&quot;porc_urb&quot;</span> ,  </span>
<span id="cb84-41"><a href="estimacion_ent_02.html#cb84-41" tabindex="-1"></a>      <span class="st">&quot;edad65mas_urb&quot;</span>, </span>
<span id="cb84-42"><a href="estimacion_ent_02.html#cb84-42" tabindex="-1"></a>      <span class="st">&quot;pob_tot&quot;</span> ,</span>
<span id="cb84-43"><a href="estimacion_ent_02.html#cb84-43" tabindex="-1"></a>      <span class="st">&quot;acc_muyalto&quot;</span> ,</span>
<span id="cb84-44"><a href="estimacion_ent_02.html#cb84-44" tabindex="-1"></a>      <span class="st">&quot;smg1&quot;</span>,</span>
<span id="cb84-45"><a href="estimacion_ent_02.html#cb84-45" tabindex="-1"></a>      <span class="st">&quot;ql_porc_cpa_rur&quot;</span>,</span>
<span id="cb84-46"><a href="estimacion_ent_02.html#cb84-46" tabindex="-1"></a>      <span class="st">&quot;ql_porc_cpa_urb&quot;</span></span>
<span id="cb84-47"><a href="estimacion_ent_02.html#cb84-47" tabindex="-1"></a>    )</span>
<span id="cb84-48"><a href="estimacion_ent_02.html#cb84-48" tabindex="-1"></a>  )</span>
<span id="cb84-49"><a href="estimacion_ent_02.html#cb84-49" tabindex="-1"></a></span>
<span id="cb84-50"><a href="estimacion_ent_02.html#cb84-50" tabindex="-1"></a></span>
<span id="cb84-51"><a href="estimacion_ent_02.html#cb84-51" tabindex="-1"></a>cov_registros <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cov_registros, <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)</span>
<span id="cb84-52"><a href="estimacion_ent_02.html#cb84-52" tabindex="-1"></a></span>
<span id="cb84-53"><a href="estimacion_ent_02.html#cb84-53" tabindex="-1"></a>formula_model <span class="ot">&lt;-</span></span>
<span id="cb84-54"><a href="estimacion_ent_02.html#cb84-54" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb84-55"><a href="estimacion_ent_02.html#cb84-55" tabindex="-1"></a>    <span class="st">&quot;cbind(si, no) ~ (1 | cve_mun) + (1 | hlengua) + (1 | discapacidad) +  nivel_edu + edad   + area + sexo &quot;</span></span>
<span id="cb84-56"><a href="estimacion_ent_02.html#cb84-56" tabindex="-1"></a>    ,</span>
<span id="cb84-57"><a href="estimacion_ent_02.html#cb84-57" tabindex="-1"></a>    <span class="st">&quot; + &quot;</span>,</span>
<span id="cb84-58"><a href="estimacion_ent_02.html#cb84-58" tabindex="-1"></a>    cov_registros</span>
<span id="cb84-59"><a href="estimacion_ent_02.html#cb84-59" tabindex="-1"></a>  )</span>
<span id="cb84-60"><a href="estimacion_ent_02.html#cb84-60" tabindex="-1"></a></span>
<span id="cb84-61"><a href="estimacion_ent_02.html#cb84-61" tabindex="-1"></a></span>
<span id="cb84-62"><a href="estimacion_ent_02.html#cb84-62" tabindex="-1"></a></span>
<span id="cb84-63"><a href="estimacion_ent_02.html#cb84-63" tabindex="-1"></a></span>
<span id="cb84-64"><a href="estimacion_ent_02.html#cb84-64" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">modelo_dummy</span>(</span>
<span id="cb84-65"><a href="estimacion_ent_02.html#cb84-65" tabindex="-1"></a>  <span class="at">encuesta_sta =</span> encuesta_enigh  <span class="sc">%&gt;%</span> </span>
<span id="cb84-66"><a href="estimacion_ent_02.html#cb84-66" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yk =</span> <span class="fu">ifelse</span>(ic_segsoc <span class="sc">==</span> <span class="dv">1</span> ,<span class="dv">1</span>,<span class="dv">0</span>))  ,</span>
<span id="cb84-67"><a href="estimacion_ent_02.html#cb84-67" tabindex="-1"></a>  <span class="at">predictors =</span> statelevel_predictors_df,</span>
<span id="cb84-68"><a href="estimacion_ent_02.html#cb84-68" tabindex="-1"></a>  <span class="at">censo_sta =</span> censo_sta ,</span>
<span id="cb84-69"><a href="estimacion_ent_02.html#cb84-69" tabindex="-1"></a>  <span class="at">formula_mod =</span> formula_model,</span>
<span id="cb84-70"><a href="estimacion_ent_02.html#cb84-70" tabindex="-1"></a>  <span class="at">byAgrega =</span> byAgrega</span>
<span id="cb84-71"><a href="estimacion_ent_02.html#cb84-71" tabindex="-1"></a>)</span>
<span id="cb84-72"><a href="estimacion_ent_02.html#cb84-72" tabindex="-1"></a></span>
<span id="cb84-73"><a href="estimacion_ent_02.html#cb84-73" tabindex="-1"></a>fit_segsoc <span class="ot">&lt;-</span> fit<span class="sc">$</span>fit_mrp</span></code></pre></div>
</div>
<div id="predicción-y-validación" class="section level4 unnumbered hasAnchor">
<h4>Predicción y Validación<a href="estimacion_ent_02.html#predicción-y-validación" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta parte, se realiza la predicción del ingreso utilizando el modelo ajustado y se evalúa la precisión de las predicciones. Se calcula el error estándar residual y se ajustan los valores en función de las predicciones realizadas.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="estimacion_ent_02.html#cb85-1" tabindex="-1"></a>encuesta_sta <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(encuesta_enigh, statelevel_predictors_df)</span>
<span id="cb85-2"><a href="estimacion_ent_02.html#cb85-2" tabindex="-1"></a>pred_ingreso <span class="ot">&lt;-</span> (<span class="fu">predict</span>(fit_ingreso, <span class="at">newdata =</span> encuesta_sta))</span>
<span id="cb85-3"><a href="estimacion_ent_02.html#cb85-3" tabindex="-1"></a><span class="fu">sum</span>(pred_ingreso <span class="sc">&lt;</span> <span class="dv">3560</span>)</span>
<span id="cb85-4"><a href="estimacion_ent_02.html#cb85-4" tabindex="-1"></a><span class="fu">rm</span>(encuesta_sta)</span>
<span id="cb85-5"><a href="estimacion_ent_02.html#cb85-5" tabindex="-1"></a>paso <span class="ot">&lt;-</span> encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pred_ingreso =</span> pred_ingreso) <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="estimacion_ent_02.html#cb85-6" tabindex="-1"></a>  survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">id =</span><span class="sc">~</span> upm , <span class="at">strata =</span> <span class="sc">~</span> estrato , <span class="at">data =</span> ., <span class="at">weights =</span> <span class="sc">~</span> fep) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="estimacion_ent_02.html#cb85-7" tabindex="-1"></a>  <span class="fu">as_survey_design</span>()</span>
<span id="cb85-8"><a href="estimacion_ent_02.html#cb85-8" tabindex="-1"></a>sd_1 <span class="ot">&lt;-</span> paso <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb85-9"><a href="estimacion_ent_02.html#cb85-9" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_obs =</span> <span class="fu">survey_mean</span>(ingreso), </span>
<span id="cb85-10"><a href="estimacion_ent_02.html#cb85-10" tabindex="-1"></a>            <span class="at">media_pred =</span> <span class="fu">survey_mean</span>(pred_ingreso)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-11"><a href="estimacion_ent_02.html#cb85-11" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_sd =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">c</span>(media_obs <span class="sc">-</span> media_pred)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb85-12"><a href="estimacion_ent_02.html#cb85-12" tabindex="-1"></a>desv_estandar_residual <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">c</span>(<span class="fu">as.numeric</span>(sd_1), <span class="fu">sigma</span>(fit_ingreso)))</span></code></pre></div>
</div>
<div id="cálculo-del-índice-de-pobreza-multidimensional-ipm" class="section level4 unnumbered hasAnchor">
<h4>Cálculo del Índice de Pobreza Multidimensional (IPM)<a href="estimacion_ent_02.html#cálculo-del-índice-de-pobreza-multidimensional-ipm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Finalmente, se calcula el índice de pobreza multidimensional (IPM) basado en varias dimensiones, se ajusta la encuesta con estos datos, y se calcula la media del IPM.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="estimacion_ent_02.html#cb86-1" tabindex="-1"></a>encuesta_enigh <span class="ot">&lt;-</span></span>
<span id="cb86-2"><a href="estimacion_ent_02.html#cb86-2" tabindex="-1"></a>  encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(LB)  <span class="sc">%&gt;%</span> </span>
<span id="cb86-3"><a href="estimacion_ent_02.html#cb86-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb86-4"><a href="estimacion_ent_02.html#cb86-4" tabindex="-1"></a>    <span class="at">tol_ic =</span> ic_segsoc <span class="sc">+</span> ic_ali_nc <span class="sc">+</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span>  ic_sbv <span class="sc">+</span> ic_rezedu,</span>
<span id="cb86-5"><a href="estimacion_ent_02.html#cb86-5" tabindex="-1"></a>    <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb86-6"><a href="estimacion_ent_02.html#cb86-6" tabindex="-1"></a>      <span class="co"># Población en situación de pobreza.</span></span>
<span id="cb86-7"><a href="estimacion_ent_02.html#cb86-7" tabindex="-1"></a>      ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb86-8"><a href="estimacion_ent_02.html#cb86-8" tabindex="-1"></a>      <span class="co"># Población vulnerable por carencias sociales.</span></span>
<span id="cb86-9"><a href="estimacion_ent_02.html#cb86-9" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb86-10"><a href="estimacion_ent_02.html#cb86-10" tabindex="-1"></a>      <span class="co"># Poblacion vulnerable por ingresos.</span></span>
<span id="cb86-11"><a href="estimacion_ent_02.html#cb86-11" tabindex="-1"></a>      ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb86-12"><a href="estimacion_ent_02.html#cb86-12" tabindex="-1"></a>      <span class="co"># Población no pobre multidimensional y no vulnerable.</span></span>
<span id="cb86-13"><a href="estimacion_ent_02.html#cb86-13" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb86-14"><a href="estimacion_ent_02.html#cb86-14" tabindex="-1"></a>    ),</span>
<span id="cb86-15"><a href="estimacion_ent_02.html#cb86-15" tabindex="-1"></a>    <span class="co"># Población en situación de pobreza moderada.</span></span>
<span id="cb86-16"><a href="estimacion_ent_02.html#cb86-16" tabindex="-1"></a>    <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb86-17"><a href="estimacion_ent_02.html#cb86-17" tabindex="-1"></a>                              tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb86-18"><a href="estimacion_ent_02.html#cb86-18" tabindex="-1"></a>    <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb86-19"><a href="estimacion_ent_02.html#cb86-19" tabindex="-1"></a>    </span>
<span id="cb86-20"><a href="estimacion_ent_02.html#cb86-20" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="predicción-con-los-modelos-ajustados" class="section level4 unnumbered hasAnchor">
<h4>Predicción con los Modelos Ajustados<a href="estimacion_ent_02.html#predicción-con-los-modelos-ajustados" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se generan predicciones para las variables de interés (<code>ingreso</code>, <code>ic_ali_nc</code>, <code>ic_segsoc</code>) usando los modelos ajustados (<code>fit_ingreso</code>, <code>fit_alimento</code>, <code>fit_segsoc</code>) y el conjunto de datos <code>muestra_ampliada</code>. Se permite el uso de nuevos niveles en las predicciones.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="estimacion_ent_02.html#cb87-1" tabindex="-1"></a>pred_ingreso <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_ingreso, </span>
<span id="cb87-2"><a href="estimacion_ent_02.html#cb87-2" tabindex="-1"></a>                        <span class="at">newdata =</span> muestra_ampliada ,</span>
<span id="cb87-3"><a href="estimacion_ent_02.html#cb87-3" tabindex="-1"></a>                        <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-4"><a href="estimacion_ent_02.html#cb87-4" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb87-5"><a href="estimacion_ent_02.html#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="estimacion_ent_02.html#cb87-6" tabindex="-1"></a>pred_ic_ali_nc <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_alimento, </span>
<span id="cb87-7"><a href="estimacion_ent_02.html#cb87-7" tabindex="-1"></a>                          <span class="at">newdata =</span> muestra_ampliada ,</span>
<span id="cb87-8"><a href="estimacion_ent_02.html#cb87-8" tabindex="-1"></a>                          <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-9"><a href="estimacion_ent_02.html#cb87-9" tabindex="-1"></a>                          <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb87-10"><a href="estimacion_ent_02.html#cb87-10" tabindex="-1"></a></span>
<span id="cb87-11"><a href="estimacion_ent_02.html#cb87-11" tabindex="-1"></a>pred_segsoc <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_segsoc, </span>
<span id="cb87-12"><a href="estimacion_ent_02.html#cb87-12" tabindex="-1"></a>                       <span class="at">newdata =</span> muestra_ampliada ,</span>
<span id="cb87-13"><a href="estimacion_ent_02.html#cb87-13" tabindex="-1"></a>                       <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-14"><a href="estimacion_ent_02.html#cb87-14" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
</div>
<div id="creación-de-variables-dummy-y-preparación-de-datos" class="section level4 unnumbered hasAnchor">
<h4>Creación de Variables Dummy y Preparación de Datos<a href="estimacion_ent_02.html#creación-de-variables-dummy-y-preparación-de-datos" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Aquí, se crean variables dummy para indicadores de salud, seguridad social, y otras características. Luego, se preparan datos adicionales para <code>muestra_ampliada_pred</code>, generando variables simuladas (<code>ic_segsoc</code>, <code>ic_ali_nc</code>) y ajustando el ingreso con ruido aleatorio. Se calcula el total del índice de carencias (<code>tol_ic</code>).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="estimacion_ent_02.html#cb88-1" tabindex="-1"></a>muestra_ampliada <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb88-2"><a href="estimacion_ent_02.html#cb88-2" tabindex="-1"></a>  <span class="at">ic_asalud =</span> <span class="fu">ifelse</span>(ic_asalud <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb88-3"><a href="estimacion_ent_02.html#cb88-3" tabindex="-1"></a>  <span class="at">ic_cv =</span> <span class="fu">ifelse</span>(ic_cv <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb88-4"><a href="estimacion_ent_02.html#cb88-4" tabindex="-1"></a>  <span class="at">ic_sbv =</span> <span class="fu">ifelse</span>(ic_sbv <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb88-5"><a href="estimacion_ent_02.html#cb88-5" tabindex="-1"></a>  <span class="at">ic_rezedu =</span> <span class="fu">ifelse</span>(ic_rezedu <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>)) </span>
<span id="cb88-6"><a href="estimacion_ent_02.html#cb88-6" tabindex="-1"></a></span>
<span id="cb88-7"><a href="estimacion_ent_02.html#cb88-7" tabindex="-1"></a>muestra_ampliada_pred <span class="ot">&lt;-</span></span>
<span id="cb88-8"><a href="estimacion_ent_02.html#cb88-8" tabindex="-1"></a>  muestra_ampliada <span class="sc">%&gt;%</span></span>
<span id="cb88-9"><a href="estimacion_ent_02.html#cb88-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(col_names_muestra), li, lp) <span class="sc">%&gt;%</span></span>
<span id="cb88-10"><a href="estimacion_ent_02.html#cb88-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-11"><a href="estimacion_ent_02.html#cb88-11" tabindex="-1"></a>    <span class="at">ic_segsoc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_segsoc),</span>
<span id="cb88-12"><a href="estimacion_ent_02.html#cb88-12" tabindex="-1"></a>    <span class="at">ic_ali_nc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_ic_ali_nc),</span>
<span id="cb88-13"><a href="estimacion_ent_02.html#cb88-13" tabindex="-1"></a>    <span class="at">ingreso =</span> pred_ingreso <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, desv_estandar_residual),</span>
<span id="cb88-14"><a href="estimacion_ent_02.html#cb88-14" tabindex="-1"></a>    <span class="at">tol_ic =</span> ic_segsoc <span class="sc">+</span> ic_ali_nc <span class="sc">+</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span></span>
<span id="cb88-15"><a href="estimacion_ent_02.html#cb88-15" tabindex="-1"></a>      ic_sbv <span class="sc">+</span> ic_rezedu)</span></code></pre></div>
</div>
<div id="validación-de-las-predicciones" class="section level4 unnumbered hasAnchor">
<h4>Validación de las Predicciones<a href="estimacion_ent_02.html#validación-de-las-predicciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se validan las predicciones comparando las medias de las variables simuladas con las predicciones generadas por los modelos. Se calcula la diferencia entre estas medias para verificar la precisión de las predicciones.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="estimacion_ent_02.html#cb89-1" tabindex="-1"></a><span class="fu">mean</span>(muestra_ampliada_pred<span class="sc">$</span>ic_ali_nc) <span class="sc">-</span></span>
<span id="cb89-2"><a href="estimacion_ent_02.html#cb89-2" tabindex="-1"></a>  <span class="fu">mean</span>(pred_ic_ali_nc)</span>
<span id="cb89-3"><a href="estimacion_ent_02.html#cb89-3" tabindex="-1"></a></span>
<span id="cb89-4"><a href="estimacion_ent_02.html#cb89-4" tabindex="-1"></a><span class="fu">mean</span>(muestra_ampliada_pred<span class="sc">$</span>ic_segsoc) <span class="sc">-</span></span>
<span id="cb89-5"><a href="estimacion_ent_02.html#cb89-5" tabindex="-1"></a>  <span class="fu">mean</span>(pred_segsoc)</span>
<span id="cb89-6"><a href="estimacion_ent_02.html#cb89-6" tabindex="-1"></a></span>
<span id="cb89-7"><a href="estimacion_ent_02.html#cb89-7" tabindex="-1"></a><span class="fu">mean</span>(muestra_ampliada_pred<span class="sc">$</span>ingreso) <span class="sc">-</span></span>
<span id="cb89-8"><a href="estimacion_ent_02.html#cb89-8" tabindex="-1"></a>  <span class="fu">mean</span>(pred_ingreso)</span></code></pre></div>
</div>
<div id="cálculo-del-índice-de-pobreza-multidimensional-ipm-con-predicciones" class="section level4 unnumbered hasAnchor">
<h4>Cálculo del Índice de Pobreza Multidimensional (IPM) con Predicciones<a href="estimacion_ent_02.html#cálculo-del-índice-de-pobreza-multidimensional-ipm-con-predicciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se clasifica la población en diferentes categorías de pobreza multidimensional (<code>ipm</code>) y se identifican las personas en pobreza moderada y extrema. Se calcula la proporción de cada categoría en <code>muestra_ampliada_pred</code>.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="estimacion_ent_02.html#cb90-1" tabindex="-1"></a>muestra_ampliada_pred <span class="ot">&lt;-</span> muestra_ampliada_pred <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb90-2"><a href="estimacion_ent_02.html#cb90-2" tabindex="-1"></a>  <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb90-3"><a href="estimacion_ent_02.html#cb90-3" tabindex="-1"></a>    ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb90-4"><a href="estimacion_ent_02.html#cb90-4" tabindex="-1"></a>    ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb90-5"><a href="estimacion_ent_02.html#cb90-5" tabindex="-1"></a>    ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb90-6"><a href="estimacion_ent_02.html#cb90-6" tabindex="-1"></a>    ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb90-7"><a href="estimacion_ent_02.html#cb90-7" tabindex="-1"></a>  ),</span>
<span id="cb90-8"><a href="estimacion_ent_02.html#cb90-8" tabindex="-1"></a>  <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb90-9"><a href="estimacion_ent_02.html#cb90-9" tabindex="-1"></a>                            tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb90-10"><a href="estimacion_ent_02.html#cb90-10" tabindex="-1"></a>  <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>) )</span>
<span id="cb90-11"><a href="estimacion_ent_02.html#cb90-11" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(muestra_ampliada_pred<span class="sc">$</span>ipm))</span></code></pre></div>
</div>
<div id="estimación-y-comparación-del-ipm-con-predicciones" class="section level4 unnumbered hasAnchor">
<h4>Estimación y Comparación del IPM con Predicciones<a href="estimacion_ent_02.html#estimación-y-comparación-del-ipm-con-predicciones" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se estima el IPM para las predicciones y se compara con la estimación real basada en <code>encuesta_enigh</code>. Se calculan las proporciones de cada categoría IPM para ambas estimaciones.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="estimacion_ent_02.html#cb91-1" tabindex="-1"></a>muestra_ampliada_pred <span class="sc">%&gt;%</span> <span class="fu">filter</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="estimacion_ent_02.html#cb91-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_ipm =</span><span class="fu">sum</span>(factor)) <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="estimacion_ent_02.html#cb91-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">est_ipm =</span> num_ipm<span class="sc">/</span><span class="fu">sum</span>(num_ipm))</span>
<span id="cb91-4"><a href="estimacion_ent_02.html#cb91-4" tabindex="-1"></a></span>
<span id="cb91-5"><a href="estimacion_ent_02.html#cb91-5" tabindex="-1"></a>encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb91-6"><a href="estimacion_ent_02.html#cb91-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_ipm =</span><span class="fu">sum</span>(fep)) <span class="sc">%&gt;%</span> </span>
<span id="cb91-7"><a href="estimacion_ent_02.html#cb91-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">est_ipm =</span> num_ipm<span class="sc">/</span><span class="fu">sum</span>(num_ipm))</span></code></pre></div>
</div>
<div id="ajuste-de-las-predicciones-y-calibración" class="section level4 unnumbered hasAnchor">
<h4>Ajuste de las Predicciones y Calibración<a href="estimacion_ent_02.html#ajuste-de-las-predicciones-y-calibración" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se actualizan las variables de <code>muestra_ampliada_pred</code> con información adicional y se elimina cualquier dato faltante en <code>encuesta_enigh</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="estimacion_ent_02.html#cb92-1" tabindex="-1"></a>muestra_ampliada_pred   <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb92-2"><a href="estimacion_ent_02.html#cb92-2" tabindex="-1"></a>  <span class="at">tol_ic4 =</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span>  ic_sbv <span class="sc">+</span> ic_rezedu,</span>
<span id="cb92-3"><a href="estimacion_ent_02.html#cb92-3" tabindex="-1"></a>  <span class="at">pred_segsoc =</span> pred_segsoc,</span>
<span id="cb92-4"><a href="estimacion_ent_02.html#cb92-4" tabindex="-1"></a>  <span class="at">pred_ingreso =</span> pred_ingreso,</span>
<span id="cb92-5"><a href="estimacion_ent_02.html#cb92-5" tabindex="-1"></a>  <span class="at">desv_estandar_residual =</span> desv_estandar_residual,</span>
<span id="cb92-6"><a href="estimacion_ent_02.html#cb92-6" tabindex="-1"></a>  <span class="at">pred_ic_ali_nc =</span> pred_ic_ali_nc</span>
<span id="cb92-7"><a href="estimacion_ent_02.html#cb92-7" tabindex="-1"></a>) </span>
<span id="cb92-8"><a href="estimacion_ent_02.html#cb92-8" tabindex="-1"></a></span>
<span id="cb92-9"><a href="estimacion_ent_02.html#cb92-9" tabindex="-1"></a>ii_ent <span class="ot">=</span> <span class="st">&quot;02&quot;</span></span>
<span id="cb92-10"><a href="estimacion_ent_02.html#cb92-10" tabindex="-1"></a>encuesta_enigh <span class="sc">%&lt;&gt;%</span> <span class="fu">na.omit</span>()</span></code></pre></div>
</div>
<div id="cálculo-de-la-población-y-pobreza-por-municipio" class="section level4 unnumbered hasAnchor">
<h4>Cálculo de la Población y Pobreza por Municipio<a href="estimacion_ent_02.html#cálculo-de-la-población-y-pobreza-por-municipio" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se calcula la densidad de población por municipio y se determina el porcentaje de población en cada categoría de IPM. Se estima la pobreza moderada y extrema en función de las encuestas y la población total.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="estimacion_ent_02.html#cb93-1" tabindex="-1"></a>total_mpio  <span class="ot">&lt;-</span> muestra_ampliada_pred <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="estimacion_ent_02.html#cb93-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">den_mpio =</span> <span class="fu">sum</span>(factor),<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="estimacion_ent_02.html#cb93-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_ent =</span> <span class="fu">sum</span>(den_mpio))</span>
<span id="cb93-4"><a href="estimacion_ent_02.html#cb93-4" tabindex="-1"></a></span>
<span id="cb93-5"><a href="estimacion_ent_02.html#cb93-5" tabindex="-1"></a>tot_pob <span class="ot">&lt;-</span> encuesta_enigh <span class="sc">%&gt;%</span> </span>
<span id="cb93-6"><a href="estimacion_ent_02.html#cb93-6" tabindex="-1"></a>  <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb93-7"><a href="estimacion_ent_02.html#cb93-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_ent =</span> <span class="fu">sum</span>(fep),<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-8"><a href="estimacion_ent_02.html#cb93-8" tabindex="-1"></a>  <span class="fu">transmute</span>(ipm,   <span class="at">prop_ipm =</span> num_ent<span class="sc">/</span><span class="fu">sum</span>(num_ent),</span>
<span id="cb93-9"><a href="estimacion_ent_02.html#cb93-9" tabindex="-1"></a>            <span class="at">tx_ipm =</span>  <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>prop_ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb93-10"><a href="estimacion_ent_02.html#cb93-10" tabindex="-1"></a>  <span class="fu">filter</span>(ipm <span class="sc">!=</span> <span class="st">&quot;I&quot;</span>)</span>
<span id="cb93-11"><a href="estimacion_ent_02.html#cb93-11" tabindex="-1"></a></span>
<span id="cb93-12"><a href="estimacion_ent_02.html#cb93-12" tabindex="-1"></a>pobreza <span class="ot">&lt;-</span>  encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb93-13"><a href="estimacion_ent_02.html#cb93-13" tabindex="-1"></a>  <span class="at">pobre_ext =</span> <span class="fu">weighted.mean</span>(pobre_extrema, fep),</span>
<span id="cb93-14"><a href="estimacion_ent_02.html#cb93-14" tabindex="-1"></a>  <span class="at">pob_mod =</span> <span class="fu">weighted.mean</span>(pobre_moderada, fep),</span>
<span id="cb93-15"><a href="estimacion_ent_02.html#cb93-15" tabindex="-1"></a>  <span class="at">pobre_moderada =</span> <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>pob_mod,</span>
<span id="cb93-16"><a href="estimacion_ent_02.html#cb93-16" tabindex="-1"></a>  <span class="at">pobre_extrema =</span> <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>pobre_ext)</span></code></pre></div>
</div>
<div id="iteraciones-de-calibración" class="section level4 unnumbered hasAnchor">
<h4>Iteraciones de Calibración<a href="estimacion_ent_02.html#iteraciones-de-calibración" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Este bloque realiza iteraciones para ajustar y calibrar los datos, actualizando las predicciones en cada iteración y comparando los resultados con la población real. Se calculan y guardan los resultados en archivos <code>.rds</code> para cada iteración.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="estimacion_ent_02.html#cb94-1" tabindex="-1"></a><span class="cf">for</span>( iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>){</span>
<span id="cb94-2"><a href="estimacion_ent_02.html#cb94-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> iteracion = &quot;</span>, iter,<span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)    </span>
<span id="cb94-3"><a href="estimacion_ent_02.html#cb94-3" tabindex="-1"></a>  </span>
<span id="cb94-4"><a href="estimacion_ent_02.html#cb94-4" tabindex="-1"></a>  muestra_ampliada_pred <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb94-5"><a href="estimacion_ent_02.html#cb94-5" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb94-6"><a href="estimacion_ent_02.html#cb94-6" tabindex="-1"></a>      <span class="at">ic_segsoc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_segsoc),</span>
<span id="cb94-7"><a href="estimacion_ent_02.html#cb94-7" tabindex="-1"></a>      <span class="at">ic_ali_nc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_ic_ali_nc),</span>
<span id="cb94-8"><a href="estimacion_ent_02.html#cb94-8" tabindex="-1"></a>      <span class="at">ingreso =</span> pred_ingreso <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(),<span class="at">mean =</span> <span class="dv">0</span>,</span>
<span id="cb94-9"><a href="estimacion_ent_02.html#cb94-9" tabindex="-1"></a>                                     desv_estandar_residual),</span>
<span id="cb94-10"><a href="estimacion_ent_02.html#cb94-10" tabindex="-1"></a>      <span class="at">tol_ic =</span> tol_ic4 <span class="sc">+</span> ic_segsoc <span class="sc">+</span> ic_ali_nc</span>
<span id="cb94-11"><a href="estimacion_ent_02.html#cb94-11" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb94-12"><a href="estimacion_ent_02.html#cb94-12" tabindex="-1"></a>      <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb94-13"><a href="estimacion_ent_02.html#cb94-13" tabindex="-1"></a>        ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb94-14"><a href="estimacion_ent_02.html#cb94-14" tabindex="-1"></a>        ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb94-15"><a href="estimacion_ent_02.html#cb94-15" tabindex="-1"></a>        ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb94-16"><a href="estimacion_ent_02.html#cb94-16" tabindex="-1"></a>        ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb94-17"><a href="estimacion_ent_02.html#cb94-17" tabindex="-1"></a>      ),</span>
<span id="cb94-18"><a href="estimacion_ent_02.html#cb94-18" tabindex="-1"></a>      <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb94-19"><a href="estimacion_ent_02.html#cb94-19" tabindex="-1"></a>                                tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb94-20"><a href="estimacion_ent_02.html#cb94-20" tabindex="-1"></a>      <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb94-21"><a href="estimacion_ent_02.html#cb94-21" tabindex="-1"></a>    )  </span>
<span id="cb94-22"><a href="estimacion_ent_02.html#cb94-22" tabindex="-1"></a></span>
<span id="cb94-23"><a href="estimacion_ent_02.html#cb94-23" tabindex="-1"></a>  Xk <span class="ot">&lt;-</span> muestra_ampliada_pred <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;ipm&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb94-24"><a href="estimacion_ent_02.html#cb94-24" tabindex="-1"></a>    fastDummies<span class="sc">::</span><span class="fu">dummy_columns</span>(<span class="at">select_columns =</span> <span class="fu">c</span>(<span class="st">&quot;ipm&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-25"><a href="estimacion_ent_02.html#cb94-25" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">names</span>(Tx_hat[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]))</span>
<span id="cb94-26"><a href="estimacion_ent_02.html#cb94-26" tabindex="-1"></a></span>
<span id="cb94-27"><a href="estimacion_ent_02.html#cb94-27" tabindex="-1"></a>  diseno_post <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(muestra_ampliada_pred,Xk) <span class="sc">%&gt;%</span> </span>
<span id="cb94-28"><a href="estimacion_ent_02.html#cb94-28" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fep =</span> factor) <span class="sc">%&gt;%</span></span>
<span id="cb94-29"><a href="estimacion_ent_02.html#cb94-29" tabindex="-1"></a>    <span class="fu">as_survey_design</span>(</span>
<span id="cb94-30"><a href="estimacion_ent_02.html#cb94-30" tabindex="-1"></a>      <span class="at">ids =</span> upm,</span>
<span id="cb94-31"><a href="estimacion_ent_02.html#cb94-31" tabindex="-1"></a>      <span class="at">weights =</span> fep,</span>
<span id="cb94-32"><a href="estimacion_ent_02.html#cb94-32" tabindex="-1"></a>      <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb94-33"><a href="estimacion_ent_02.html#cb94-33" tabindex="-1"></a>      <span class="co"># strata = estrato</span></span>
<span id="cb94-34"><a href="estimacion_ent_02.html#cb94-34" tabindex="-1"></a>    )</span>
<span id="cb94-35"><a href="estimacion_ent_02.html#cb94-35" tabindex="-1"></a></span>
<span id="cb94-36"><a href="estimacion_ent_02.html#cb94-36" tabindex="-1"></a>  mod_calib <span class="ot">&lt;-</span>  <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~ -1+&quot;</span>,<span class="fu">paste0</span>(<span class="fu">names</span>(Tx_hat), <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb94-37"><a href="estimacion_ent_02.html#cb94-37" tabindex="-1"></a></span>
<span id="cb94-38"><a href="estimacion_ent_02.html#cb94-38" tabindex="-1"></a>  diseno_calib <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(diseno_post, <span class="at">formula =</span> mod_calib, </span>
<span id="cb94-39"><a href="estimacion_ent_02.html#cb94-39" tabindex="-1"></a>                            <span class="at">population =</span> Tx_hat,<span class="at">calfun =</span> <span class="st">&quot;raking&quot;</span>)</span>
<span id="cb94-40"><a href="estimacion_ent_02.html#cb94-40" tabindex="-1"></a></span>
<span id="cb94-41"><a href="estimacion_ent_02.html#cb94-41" tabindex="-1"></a>  estima_calib_ipm  <span class="ot">&lt;-</span> diseno_calib <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun,ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb94-42"><a href="estimacion_ent_02.html#cb94-42" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">est_ipm =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span><span class="st">&quot;var&quot;</span>))</span>
<span id="cb94-43"><a href="estimacion_ent_02.html#cb94-43" tabindex="-1"></a></span>
<span id="cb94-44"><a href="estimacion_ent_02.html#cb94-44" tabindex="-1"></a>  estima_calib_pob  <span class="ot">&lt;-</span> diseno_calib <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb94-45"><a href="estimacion_ent_02.html#cb94-45" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">est_pob_ext =</span> <span class="fu">survey_mean</span>(pobre_extrema , <span class="at">vartype =</span><span class="st">&quot;var&quot;</span>),</span>
<span id="cb94-46"><a href="estimacion_ent_02.html#cb94-46" tabindex="-1"></a>              <span class="at">est_pob_mod =</span> <span class="fu">survey_mean</span>(pobre_moderada  , <span class="at">vartype =</span><span class="st">&quot;var&quot;</span> ))</span>
<span id="cb94-47"><a href="estimacion_ent_02.html#cb94-47" tabindex="-1"></a></span>
<span id="cb94-48"><a href="estimacion_ent_02.html#cb94-48" tabindex="-1"></a>  estima_calib</span>
<span id="cb94-49"><a href="estimacion_ent_02.html#cb94-49" tabindex="-1"></a></span>
<span id="cb94-50"><a href="estimacion_ent_02.html#cb94-50" tabindex="-1"></a> <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb94-51"><a href="estimacion_ent_02.html#cb94-51" tabindex="-1"></a>    <span class="at">data =</span> estima_calib_ipm,</span>
<span id="cb94-52"><a href="estimacion_ent_02.html#cb94-52" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="st">&quot;cve_mun&quot;</span>,</span>
<span id="cb94-53"><a href="estimacion_ent_02.html#cb94-53" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">&quot;ipm&quot;</span>,</span>
<span id="cb94-54"><a href="estimacion_ent_02.html#cb94-54" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;est_ipm&quot;</span>, <span class="st">&quot;est_ipm_var&quot;</span>),<span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb94-55"><a href="estimacion_ent_02.html#cb94-55" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(estima_calib_pob)</span>
<span id="cb94-56"><a href="estimacion_ent_02.html#cb94-56" tabindex="-1"></a></span>
<span id="cb94-57"><a href="estimacion_ent_02.html#cb94-57" tabindex="-1"></a>  valida_ipm <span class="ot">&lt;-</span> estima_calib_ipm <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(total_mpio, <span class="at">by =</span> <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb94-58"><a href="estimacion_ent_02.html#cb94-58" tabindex="-1"></a>    <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb94-59"><a href="estimacion_ent_02.html#cb94-59" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">prop_ampliada =</span> <span class="fu">sum</span>(est_ipm<span class="sc">*</span>den_mpio)<span class="sc">/</span><span class="fu">unique</span>(tot_ent)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-60"><a href="estimacion_ent_02.html#cb94-60" tabindex="-1"></a>    <span class="fu">full_join</span>(tot_pob, <span class="at">by =</span> <span class="st">&quot;ipm&quot;</span>)</span>
<span id="cb94-61"><a href="estimacion_ent_02.html#cb94-61" tabindex="-1"></a></span>
<span id="cb94-62"><a href="estimacion_ent_02.html#cb94-62" tabindex="-1"></a>  valida_pob <span class="ot">&lt;-</span> estima_calib_pob <span class="sc">%&gt;%</span> <span class="fu">select</span>(cve_mun, est_pob_ext , est_pob_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb94-63"><a href="estimacion_ent_02.html#cb94-63" tabindex="-1"></a>    <span class="fu">inner_join</span>(total_mpio, <span class="at">by =</span> <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-64"><a href="estimacion_ent_02.html#cb94-64" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">pob_ext_ampliada =</span> <span class="fu">sum</span>(est_pob_ext <span class="sc">*</span> den_mpio) <span class="sc">/</span> <span class="fu">unique</span>(tot_ent),</span>
<span id="cb94-65"><a href="estimacion_ent_02.html#cb94-65" tabindex="-1"></a>              <span class="at">pob_mod_ampliada =</span> <span class="fu">sum</span>(est_pob_mod <span class="sc">*</span> den_mpio) <span class="sc">/</span> <span class="fu">unique</span>(tot_ent),</span>
<span id="cb94-66"><a href="estimacion_ent_02.html#cb94-66" tabindex="-1"></a>              <span class="at">ipm_I =</span> pob_ext_ampliada <span class="sc">+</span> pob_mod_ampliada) <span class="sc">%&gt;%</span> </span>
<span id="cb94-67"><a href="estimacion_ent_02.html#cb94-67" tabindex="-1"></a>    <span class="fu">bind_cols</span>(pobreza[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb94-68"><a href="estimacion_ent_02.html#cb94-68" tabindex="-1"></a></span>
<span id="cb94-69"><a href="estimacion_ent_02.html#cb94-69" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">valida =</span> <span class="fu">list</span>(<span class="at">valida_pob =</span> valida_pob, </span>
<span id="cb94-70"><a href="estimacion_ent_02.html#cb94-70" tabindex="-1"></a>                             <span class="at">valida_ipm =</span> valida_ipm),</span>
<span id="cb94-71"><a href="estimacion_ent_02.html#cb94-71" tabindex="-1"></a>               <span class="at">estima_calib =</span> estima_calib),</span>
<span id="cb94-72"><a href="estimacion_ent_02.html#cb94-72" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">paste0</span>( <span class="st">&quot;../output/2020/iteraciones/mpio_calib/&quot;</span>,</span>
<span id="cb94-73"><a href="estimacion_ent_02.html#cb94-73" tabindex="-1"></a>                         ii_ent,<span class="st">&quot;/iter&quot;</span>,iter,<span class="st">&quot;.rds&quot;</span>))</span>
<span id="cb94-74"><a href="estimacion_ent_02.html#cb94-74" tabindex="-1"></a>}</span>
<span id="cb94-75"><a href="estimacion_ent_02.html#cb94-75" tabindex="-1"></a>fin <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb94-76"><a href="estimacion_ent_02.html#cb94-76" tabindex="-1"></a>tiempo_total <span class="ot">&lt;-</span> <span class="fu">difftime</span>(fin, inicio, <span class="at">units =</span> <span class="st">&quot;mins&quot;</span>)</span>
<span id="cb94-77"><a href="estimacion_ent_02.html#cb94-77" tabindex="-1"></a><span class="fu">print</span>(tiempo_total)</span>
<span id="cb94-78"><a href="estimacion_ent_02.html#cb94-78" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;####################################################################</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="imputacion_censal.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimacion_municipios_ipm_pobreza.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2023MEXsae/13_Estimacion_ent_02.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.pdf", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.epub", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

</body>

</html>
