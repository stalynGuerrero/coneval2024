<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 15 14_estimacion_municipios_ipm_pobreza.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024</title>
  <meta name="description" content="Manual de procesamiento." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 15 14_estimacion_municipios_ipm_pobreza.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Manual de procesamiento." />
  <meta name="github-repo" content="psirusteam/coneval" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 15 14_estimacion_municipios_ipm_pobreza.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024" />
  
  <meta name="twitter:description" content="Manual de procesamiento." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero" />


<meta name="date" content="2024-07-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estimacion_ent_02.html"/>
<link rel="next" href="estimacion_municipios_ipm_pobreza_error.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Taller de instalación de capacidades en SAE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="respositodio-de-códigos.html"><a href="respositodio-de-códigos.html"><i class="fa fa-check"></i>Respositodio de códigos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="librerias-de-r-y-otros-insumos.html"><a href="librerias-de-r-y-otros-insumos.html"><i class="fa fa-check"></i>Librerias de <em>R</em> y otros insumos</a>
<ul>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html"><i class="fa fa-check"></i>Librerías Utilizadas</a>
<ul>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#manipulación-y-transformación-de-datos"><i class="fa fa-check"></i>Manipulación y Transformación de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#lectura-y-escritura-de-datos"><i class="fa fa-check"></i>Lectura y Escritura de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#análisis-de-datos-de-encuestas"><i class="fa fa-check"></i>Análisis de Datos de Encuestas</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#modelado-y-análisis-estadístico"><i class="fa fa-check"></i>Modelado y Análisis Estadístico</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#visualización-de-datos"><i class="fa fa-check"></i>Visualización de Datos</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#informes-y-reproducibilidad"><i class="fa fa-check"></i>Informes y Reproducibilidad</a></li>
<li class="chapter" data-level="" data-path="librerías-utilizadas.html"><a href="librerías-utilizadas.html#integración-con-otros-lenguajes"><i class="fa fa-check"></i>Integración con Otros Lenguajes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bases-de-datos-utilizadas.html"><a href="bases-de-datos-utilizadas.html"><i class="fa fa-check"></i>Bases de Datos Utilizadas</a></li>
<li class="chapter" data-level="" data-path="estructura-del-proyecto.html"><a href="estructura-del-proyecto.html"><i class="fa fa-check"></i>Estructura del Proyecto</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="union_bases.html"><a href="union_bases.html"><i class="fa fa-check"></i><b>1</b> 00_union_bases.R</a></li>
<li class="chapter" data-level="2" data-path="descarga_satelitales.html"><a href="descarga_satelitales.html"><i class="fa fa-check"></i><b>2</b> 01_Descarga_satelitales.R</a></li>
<li class="chapter" data-level="3" data-path="union_predictores.html"><a href="union_predictores.html"><i class="fa fa-check"></i><b>3</b> 02_Union_predictores.R</a></li>
<li class="chapter" data-level="4" data-path="estandarizar_muestra_cuestionario_ampliado.html"><a href="estandarizar_muestra_cuestionario_ampliado.html"><i class="fa fa-check"></i><b>4</b> 03_Estandarizar_muestra_cuestionario_ampliado.R</a></li>
<li class="chapter" data-level="5" data-path="armonizar_encuesta.html"><a href="armonizar_encuesta.html"><i class="fa fa-check"></i><b>5</b> 04_Armonizar_encuesta.R</a></li>
<li class="chapter" data-level="6" data-path="validacion_encuestas.html"><a href="validacion_encuestas.html"><i class="fa fa-check"></i><b>6</b> 05_Validacion_encuestas.R</a></li>
<li class="chapter" data-level="7" data-path="modelo_unidad_ictpc.html"><a href="modelo_unidad_ictpc.html"><i class="fa fa-check"></i><b>7</b> 06_Modelo_unidad_ictpc.R</a></li>
<li class="chapter" data-level="8" data-path="modelo_unidad_py_ic_ali_nc.html"><a href="modelo_unidad_py_ic_ali_nc.html"><i class="fa fa-check"></i><b>8</b> 07_Modelo_unidad_py_ic_ali_nc.R</a></li>
<li class="chapter" data-level="9" data-path="modelo_unidad_py_ic_segsoc.html"><a href="modelo_unidad_py_ic_segsoc.html"><i class="fa fa-check"></i><b>9</b> 08_Modelo_unidad_py_ic_segsoc</a></li>
<li class="chapter" data-level="10" data-path="postbenchmarking_ictpc.html"><a href="postbenchmarking_ictpc.html"><i class="fa fa-check"></i><b>10</b> 09_PostBenchmarking_ictpc.R</a></li>
<li class="chapter" data-level="11" data-path="postbenchmarking_ic_ali_nc.html"><a href="postbenchmarking_ic_ali_nc.html"><i class="fa fa-check"></i><b>11</b> 10_PostBenchmarking_ic_ali_nc.R</a></li>
<li class="chapter" data-level="12" data-path="postbenchmarking_ic_segsoc.html"><a href="postbenchmarking_ic_segsoc.html"><i class="fa fa-check"></i><b>12</b> 11_PostBenchmarking_ic_segsoc.r</a></li>
<li class="chapter" data-level="13" data-path="imputacion_censal.html"><a href="imputacion_censal.html"><i class="fa fa-check"></i><b>13</b> 12_Imputacion_censal.R</a></li>
<li class="chapter" data-level="14" data-path="estimacion_ent_02.html"><a href="estimacion_ent_02.html"><i class="fa fa-check"></i><b>14</b> 13_Estimacion_ent_02.R</a></li>
<li class="chapter" data-level="15" data-path="estimacion_municipios_ipm_pobreza.html"><a href="estimacion_municipios_ipm_pobreza.html"><i class="fa fa-check"></i><b>15</b> 14_estimacion_municipios_ipm_pobreza.R</a></li>
<li class="chapter" data-level="16" data-path="estimacion_municipios_ipm_pobreza_error.html"><a href="estimacion_municipios_ipm_pobreza_error.html"><i class="fa fa-check"></i><b>16</b> 15_estimacion_municipios_ipm_pobreza_error.R</a></li>
<li class="chapter" data-level="17" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i><b>17</b> 16_Mapas.R</a></li>
<li class="chapter" data-level="18" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html"><i class="fa fa-check"></i><b>18</b> 17_estimacion_municipios_carencias.R</a></li>
<li class="chapter" data-level="19" data-path="estimacion_municipios_carencias_error.html"><a href="estimacion_municipios_carencias_error.html"><i class="fa fa-check"></i><b>19</b> 18_estimacion_municipios_carencias_error.R</a></li>
<li class="chapter" data-level="20" data-path="mapas_carencias.html"><a href="mapas_carencias.html"><i class="fa fa-check"></i><b>20</b> 19_Mapas_carencias.R</a></li>
<li class="divider"></li>
<li><a Taller de instalación de capacidades en SAE </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="estimacion_municipios_ipm_pobreza.r" class="section level1 hasAnchor" number="15">
<h1><span class="header-section-number">Capítulo 15</span> 14_estimacion_municipios_ipm_pobreza.R<a href="estimacion_municipios_ipm_pobreza.html#estimacion_municipios_ipm_pobreza.r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Para la ejecución del presente análisis, se debe abrir el archivo <strong>14_estimacion_municipios_ipm_pobreza.R</strong> disponible en la ruta <em>Rcodes/2020/14_estimacion_municipios_ipm_pobreza.R</em>.</p>
<p>Este script en R realiza un análisis exhaustivo para calibrar y validar indicadores de pobreza a nivel municipal, utilizando modelos predictivos y datos de encuestas. Primero, el entorno de trabajo se limpia y se cargan las librerías necesarias para la manipulación de datos (<code>tidyverse</code>, <code>data.table</code>, <code>magrittr</code>, etc.) y para realizar cálculos estadísticos (<code>lme4</code>, <code>survey</code>, <code>srvyr</code>). Luego, se leen datos de predicciones y encuestas ampliadas, junto con información adicional sobre las líneas de bienestar.</p>
<p>En la sección inicial de procesamiento, se unen y mutan los datos de la encuesta ENIGH para calcular indicadores de pobreza y vulnerabilidad multidimensional. Se asignan categorías de pobreza (<code>ipm</code>) y se crean nuevas variables que reflejan la pobreza moderada y extrema, basadas en umbrales de ingreso y carencias sociales.</p>
<p>El script luego se centra en la preparación de datos para la calibración de modelos. La muestra ampliada se ajusta para incluir variables adicionales y predicciones de ingreso y carencias sociales. A continuación, se inicia un bucle que itera sobre un conjunto de códigos de entidad territorial. Para cada entidad, se filtran y ajustan los datos de la encuesta ampliada y se simulan nuevas variables (como ingresos y carencias sociales) utilizando distribuciones probabilísticas basadas en las predicciones anteriores.</p>
<p>Dentro de cada iteración, se realiza una calibración de los datos utilizando el método de “raking”, que ajusta las estimaciones de los indicadores a las estimaciones poblacionales conocidas. Los resultados de la calibración se calculan para cada municipio y se comparan con los datos originales para validar la precisión de las estimaciones. Finalmente, los resultados de cada iteración se guardan en archivos RDS separados para su análisis posterior y se reporta el tiempo total de ejecución del proceso.</p>
<p>Este enfoque permite realizar un ajuste fino de los modelos predictivos y asegurar que las estimaciones de pobreza sean lo más precisas posible, utilizando simulaciones y técnicas avanzadas de calibración.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="estimacion_municipios_ipm_pobreza.html#cb31-1" tabindex="-1"></a><span class="do">### Cleaning R environment </span><span class="al">###</span></span>
<span id="cb31-2"><a href="estimacion_municipios_ipm_pobreza.html#cb31-2" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb31-3"><a href="estimacion_municipios_ipm_pobreza.html#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="estimacion_municipios_ipm_pobreza.html#cb31-4" tabindex="-1"></a><span class="do">#################</span></span>
<span id="cb31-5"><a href="estimacion_municipios_ipm_pobreza.html#cb31-5" tabindex="-1"></a><span class="do">### Libraries </span><span class="al">###</span></span>
<span id="cb31-6"><a href="estimacion_municipios_ipm_pobreza.html#cb31-6" tabindex="-1"></a><span class="do">#################</span></span>
<span id="cb31-7"><a href="estimacion_municipios_ipm_pobreza.html#cb31-7" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb31-8"><a href="estimacion_municipios_ipm_pobreza.html#cb31-8" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb31-9"><a href="estimacion_municipios_ipm_pobreza.html#cb31-9" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb31-10"><a href="estimacion_municipios_ipm_pobreza.html#cb31-10" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb31-11"><a href="estimacion_municipios_ipm_pobreza.html#cb31-11" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb31-12"><a href="estimacion_municipios_ipm_pobreza.html#cb31-12" tabindex="-1"></a><span class="fu">library</span>(labelled)</span>
<span id="cb31-13"><a href="estimacion_municipios_ipm_pobreza.html#cb31-13" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb31-14"><a href="estimacion_municipios_ipm_pobreza.html#cb31-14" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb31-15"><a href="estimacion_municipios_ipm_pobreza.html#cb31-15" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb31-16"><a href="estimacion_municipios_ipm_pobreza.html#cb31-16" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb31-17"><a href="estimacion_municipios_ipm_pobreza.html#cb31-17" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../source/benchmarking_indicador.R&quot;</span>)</span>
<span id="cb31-18"><a href="estimacion_municipios_ipm_pobreza.html#cb31-18" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb31-19"><a href="estimacion_municipios_ipm_pobreza.html#cb31-19" tabindex="-1"></a><span class="co"># Lectura de datos </span></span>
<span id="cb31-20"><a href="estimacion_municipios_ipm_pobreza.html#cb31-20" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb31-21"><a href="estimacion_municipios_ipm_pobreza.html#cb31-21" tabindex="-1"></a></span>
<span id="cb31-22"><a href="estimacion_municipios_ipm_pobreza.html#cb31-22" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">&quot;../output/2020/modelos/predicciones.rds&quot;</span>)</span>
<span id="cb31-23"><a href="estimacion_municipios_ipm_pobreza.html#cb31-23" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../output/2020/encuesta_ampliada.rds&quot;</span>)</span>
<span id="cb31-24"><a href="estimacion_municipios_ipm_pobreza.html#cb31-24" tabindex="-1"></a>encuesta_enigh <span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/enigh/encuesta_sta.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-25"><a href="estimacion_municipios_ipm_pobreza.html#cb31-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ingreso =</span> ictpc)</span>
<span id="cb31-26"><a href="estimacion_municipios_ipm_pobreza.html#cb31-26" tabindex="-1"></a></span>
<span id="cb31-27"><a href="estimacion_municipios_ipm_pobreza.html#cb31-27" tabindex="-1"></a>LB <span class="ot">&lt;-</span></span>
<span id="cb31-28"><a href="estimacion_municipios_ipm_pobreza.html#cb31-28" tabindex="-1"></a>  <span class="fu">read.delim</span>(</span>
<span id="cb31-29"><a href="estimacion_municipios_ipm_pobreza.html#cb31-29" tabindex="-1"></a>    <span class="st">&quot;../input/2020/Lineas_Bienestar.csv&quot;</span>,</span>
<span id="cb31-30"><a href="estimacion_municipios_ipm_pobreza.html#cb31-30" tabindex="-1"></a>    <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-31"><a href="estimacion_municipios_ipm_pobreza.html#cb31-31" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb31-32"><a href="estimacion_municipios_ipm_pobreza.html#cb31-32" tabindex="-1"></a>    <span class="at">dec =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb31-33"><a href="estimacion_municipios_ipm_pobreza.html#cb31-33" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">as.character</span>(area))</span>
<span id="cb31-34"><a href="estimacion_municipios_ipm_pobreza.html#cb31-34" tabindex="-1"></a></span>
<span id="cb31-35"><a href="estimacion_municipios_ipm_pobreza.html#cb31-35" tabindex="-1"></a></span>
<span id="cb31-36"><a href="estimacion_municipios_ipm_pobreza.html#cb31-36" tabindex="-1"></a></span>
<span id="cb31-37"><a href="estimacion_municipios_ipm_pobreza.html#cb31-37" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb31-38"><a href="estimacion_municipios_ipm_pobreza.html#cb31-38" tabindex="-1"></a><span class="co"># IPM en la enigh</span></span>
<span id="cb31-39"><a href="estimacion_municipios_ipm_pobreza.html#cb31-39" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb31-40"><a href="estimacion_municipios_ipm_pobreza.html#cb31-40" tabindex="-1"></a>encuesta_enigh <span class="ot">&lt;-</span></span>
<span id="cb31-41"><a href="estimacion_municipios_ipm_pobreza.html#cb31-41" tabindex="-1"></a>  encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(LB)  <span class="sc">%&gt;%</span> </span>
<span id="cb31-42"><a href="estimacion_municipios_ipm_pobreza.html#cb31-42" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-43"><a href="estimacion_municipios_ipm_pobreza.html#cb31-43" tabindex="-1"></a>    <span class="at">tol_ic =</span> ic_segsoc <span class="sc">+</span> ic_ali_nc <span class="sc">+</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span>  ic_sbv <span class="sc">+</span> ic_rezedu,</span>
<span id="cb31-44"><a href="estimacion_municipios_ipm_pobreza.html#cb31-44" tabindex="-1"></a>    <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-45"><a href="estimacion_municipios_ipm_pobreza.html#cb31-45" tabindex="-1"></a>      <span class="co"># Población en situación de pobreza.</span></span>
<span id="cb31-46"><a href="estimacion_municipios_ipm_pobreza.html#cb31-46" tabindex="-1"></a>      ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb31-47"><a href="estimacion_municipios_ipm_pobreza.html#cb31-47" tabindex="-1"></a>      <span class="co"># Población vulnerable por carencias sociales.</span></span>
<span id="cb31-48"><a href="estimacion_municipios_ipm_pobreza.html#cb31-48" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb31-49"><a href="estimacion_municipios_ipm_pobreza.html#cb31-49" tabindex="-1"></a>      <span class="co"># Poblacion vulnerable por ingresos.</span></span>
<span id="cb31-50"><a href="estimacion_municipios_ipm_pobreza.html#cb31-50" tabindex="-1"></a>      ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb31-51"><a href="estimacion_municipios_ipm_pobreza.html#cb31-51" tabindex="-1"></a>      <span class="co"># Población no pobre multidimensional y no vulnerable.</span></span>
<span id="cb31-52"><a href="estimacion_municipios_ipm_pobreza.html#cb31-52" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb31-53"><a href="estimacion_municipios_ipm_pobreza.html#cb31-53" tabindex="-1"></a>    ),</span>
<span id="cb31-54"><a href="estimacion_municipios_ipm_pobreza.html#cb31-54" tabindex="-1"></a>    <span class="co"># Población en situación de pobreza moderada.</span></span>
<span id="cb31-55"><a href="estimacion_municipios_ipm_pobreza.html#cb31-55" tabindex="-1"></a>    <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb31-56"><a href="estimacion_municipios_ipm_pobreza.html#cb31-56" tabindex="-1"></a>                              tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-57"><a href="estimacion_municipios_ipm_pobreza.html#cb31-57" tabindex="-1"></a>    <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb31-58"><a href="estimacion_municipios_ipm_pobreza.html#cb31-58" tabindex="-1"></a>    </span>
<span id="cb31-59"><a href="estimacion_municipios_ipm_pobreza.html#cb31-59" tabindex="-1"></a>  )</span>
<span id="cb31-60"><a href="estimacion_municipios_ipm_pobreza.html#cb31-60" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb31-61"><a href="estimacion_municipios_ipm_pobreza.html#cb31-61" tabindex="-1"></a><span class="co"># preparando  encuesta intercensal</span></span>
<span id="cb31-62"><a href="estimacion_municipios_ipm_pobreza.html#cb31-62" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb31-63"><a href="estimacion_municipios_ipm_pobreza.html#cb31-63" tabindex="-1"></a></span>
<span id="cb31-64"><a href="estimacion_municipios_ipm_pobreza.html#cb31-64" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span> muestra_ampliada <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(LB) </span>
<span id="cb31-65"><a href="estimacion_municipios_ipm_pobreza.html#cb31-65" tabindex="-1"></a>muestra_ampliada   <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb31-66"><a href="estimacion_municipios_ipm_pobreza.html#cb31-66" tabindex="-1"></a>  <span class="at">ic_asalud =</span> <span class="fu">ifelse</span>(ic_asalud <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb31-67"><a href="estimacion_municipios_ipm_pobreza.html#cb31-67" tabindex="-1"></a>  <span class="at">ic_cv =</span> <span class="fu">ifelse</span>(ic_cv <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb31-68"><a href="estimacion_municipios_ipm_pobreza.html#cb31-68" tabindex="-1"></a>  <span class="at">ic_sbv =</span> <span class="fu">ifelse</span>(ic_sbv <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb31-69"><a href="estimacion_municipios_ipm_pobreza.html#cb31-69" tabindex="-1"></a>  <span class="at">ic_rezedu =</span> <span class="fu">ifelse</span>(ic_rezedu <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb31-70"><a href="estimacion_municipios_ipm_pobreza.html#cb31-70" tabindex="-1"></a>  <span class="at">tol_ic4 =</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span>  ic_sbv <span class="sc">+</span> ic_rezedu,</span>
<span id="cb31-71"><a href="estimacion_municipios_ipm_pobreza.html#cb31-71" tabindex="-1"></a>  <span class="at">pred_segsoc =</span> predicciones<span class="sc">$</span>pred_segsoc,</span>
<span id="cb31-72"><a href="estimacion_municipios_ipm_pobreza.html#cb31-72" tabindex="-1"></a>  <span class="at">pred_ingreso =</span> predicciones<span class="sc">$</span>pred_ingreso,</span>
<span id="cb31-73"><a href="estimacion_municipios_ipm_pobreza.html#cb31-73" tabindex="-1"></a>  <span class="at">desv_estandar_residual =</span> predicciones<span class="sc">$</span>desv_estandar_residual,</span>
<span id="cb31-74"><a href="estimacion_municipios_ipm_pobreza.html#cb31-74" tabindex="-1"></a>  <span class="at">pred_ic_ali_nc =</span> predicciones<span class="sc">$</span>pred_ic_ali_nc</span>
<span id="cb31-75"><a href="estimacion_municipios_ipm_pobreza.html#cb31-75" tabindex="-1"></a>) </span>
<span id="cb31-76"><a href="estimacion_municipios_ipm_pobreza.html#cb31-76" tabindex="-1"></a></span>
<span id="cb31-77"><a href="estimacion_municipios_ipm_pobreza.html#cb31-77" tabindex="-1"></a><span class="co"># dir.create(&quot;../output/2020/iteraciones/mpio_calib&quot;)</span></span>
<span id="cb31-78"><a href="estimacion_municipios_ipm_pobreza.html#cb31-78" tabindex="-1"></a><span class="co"># map(</span></span>
<span id="cb31-79"><a href="estimacion_municipios_ipm_pobreza.html#cb31-79" tabindex="-1"></a><span class="co">#   paste0(</span></span>
<span id="cb31-80"><a href="estimacion_municipios_ipm_pobreza.html#cb31-80" tabindex="-1"></a><span class="co">#     &quot;../output/2020/iteraciones/mpio_calib/&quot;,</span></span>
<span id="cb31-81"><a href="estimacion_municipios_ipm_pobreza.html#cb31-81" tabindex="-1"></a><span class="co">#     unique(encuesta_enigh$ent)</span></span>
<span id="cb31-82"><a href="estimacion_municipios_ipm_pobreza.html#cb31-82" tabindex="-1"></a><span class="co">#   ),</span></span>
<span id="cb31-83"><a href="estimacion_municipios_ipm_pobreza.html#cb31-83" tabindex="-1"></a><span class="co">#   ~ dir.create(path = .x)</span></span>
<span id="cb31-84"><a href="estimacion_municipios_ipm_pobreza.html#cb31-84" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb31-85"><a href="estimacion_municipios_ipm_pobreza.html#cb31-85" tabindex="-1"></a></span>
<span id="cb31-86"><a href="estimacion_municipios_ipm_pobreza.html#cb31-86" tabindex="-1"></a><span class="fu">rm</span>(predicciones)</span>
<span id="cb31-87"><a href="estimacion_municipios_ipm_pobreza.html#cb31-87" tabindex="-1"></a></span>
<span id="cb31-88"><a href="estimacion_municipios_ipm_pobreza.html#cb31-88" tabindex="-1"></a>ii_ent <span class="ot">&lt;-</span> <span class="st">&quot;02&quot;</span></span>
<span id="cb31-89"><a href="estimacion_municipios_ipm_pobreza.html#cb31-89" tabindex="-1"></a>iter <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb31-90"><a href="estimacion_municipios_ipm_pobreza.html#cb31-90" tabindex="-1"></a></span>
<span id="cb31-91"><a href="estimacion_municipios_ipm_pobreza.html#cb31-91" tabindex="-1"></a><span class="cf">for</span>(ii_ent <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;03&quot;</span>, <span class="st">&quot;06&quot;</span>, <span class="st">&quot;23&quot;</span>, <span class="st">&quot;04&quot;</span>, <span class="st">&quot;01&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;27&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;18&quot;</span>,</span>
<span id="cb31-92"><a href="estimacion_municipios_ipm_pobreza.html#cb31-92" tabindex="-1"></a>                <span class="st">&quot;05&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;28&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;26&quot;</span>, <span class="st">&quot;09&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;08&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;29&quot;</span>, </span>
<span id="cb31-93"><a href="estimacion_municipios_ipm_pobreza.html#cb31-93" tabindex="-1"></a>                <span class="st">&quot;24&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;07&quot;</span>, <span class="st">&quot;21&quot;</span>, </span>
<span id="cb31-94"><a href="estimacion_municipios_ipm_pobreza.html#cb31-94" tabindex="-1"></a>                <span class="st">&quot;30&quot;</span>,  <span class="st">&quot;20&quot;</span> ,<span class="st">&quot;02&quot;</span></span>
<span id="cb31-95"><a href="estimacion_municipios_ipm_pobreza.html#cb31-95" tabindex="-1"></a>)){</span>
<span id="cb31-96"><a href="estimacion_municipios_ipm_pobreza.html#cb31-96" tabindex="-1"></a>  </span>
<span id="cb31-97"><a href="estimacion_municipios_ipm_pobreza.html#cb31-97" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;####################################################################</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-98"><a href="estimacion_municipios_ipm_pobreza.html#cb31-98" tabindex="-1"></a>inicio <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-99"><a href="estimacion_municipios_ipm_pobreza.html#cb31-99" tabindex="-1"></a><span class="fu">print</span>(inicio)</span>
<span id="cb31-100"><a href="estimacion_municipios_ipm_pobreza.html#cb31-100" tabindex="-1"></a></span>
<span id="cb31-101"><a href="estimacion_municipios_ipm_pobreza.html#cb31-101" tabindex="-1"></a>muestra_post <span class="ot">=</span> muestra_ampliada <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ent <span class="sc">==</span> ii_ent)</span>
<span id="cb31-102"><a href="estimacion_municipios_ipm_pobreza.html#cb31-102" tabindex="-1"></a></span>
<span id="cb31-103"><a href="estimacion_municipios_ipm_pobreza.html#cb31-103" tabindex="-1"></a>total_mpio  <span class="ot">&lt;-</span> muestra_post <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb31-104"><a href="estimacion_municipios_ipm_pobreza.html#cb31-104" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">den_mpio =</span> <span class="fu">sum</span>(factor),<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-105"><a href="estimacion_municipios_ipm_pobreza.html#cb31-105" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_ent =</span> <span class="fu">sum</span>(den_mpio))</span>
<span id="cb31-106"><a href="estimacion_municipios_ipm_pobreza.html#cb31-106" tabindex="-1"></a></span>
<span id="cb31-107"><a href="estimacion_municipios_ipm_pobreza.html#cb31-107" tabindex="-1"></a></span>
<span id="cb31-108"><a href="estimacion_municipios_ipm_pobreza.html#cb31-108" tabindex="-1"></a>encuesta_sta <span class="ot">=</span> encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ent <span class="sc">==</span> ii_ent)</span>
<span id="cb31-109"><a href="estimacion_municipios_ipm_pobreza.html#cb31-109" tabindex="-1"></a></span>
<span id="cb31-110"><a href="estimacion_municipios_ipm_pobreza.html#cb31-110" tabindex="-1"></a>encuesta_sta <span class="sc">%&lt;&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb31-111"><a href="estimacion_municipios_ipm_pobreza.html#cb31-111" tabindex="-1"></a></span>
<span id="cb31-112"><a href="estimacion_municipios_ipm_pobreza.html#cb31-112" tabindex="-1"></a>tot_pob <span class="ot">&lt;-</span> encuesta_sta <span class="sc">%&gt;%</span> </span>
<span id="cb31-113"><a href="estimacion_municipios_ipm_pobreza.html#cb31-113" tabindex="-1"></a>  <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb31-114"><a href="estimacion_municipios_ipm_pobreza.html#cb31-114" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">num_ent =</span> <span class="fu">sum</span>(fep),<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-115"><a href="estimacion_municipios_ipm_pobreza.html#cb31-115" tabindex="-1"></a>  <span class="fu">transmute</span>(ipm,   <span class="at">prop_ipm =</span> num_ent<span class="sc">/</span><span class="fu">sum</span>(num_ent),</span>
<span id="cb31-116"><a href="estimacion_municipios_ipm_pobreza.html#cb31-116" tabindex="-1"></a>            <span class="at">tx_ipm =</span>  <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>prop_ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb31-117"><a href="estimacion_municipios_ipm_pobreza.html#cb31-117" tabindex="-1"></a>  <span class="fu">filter</span>(ipm <span class="sc">!=</span> <span class="st">&quot;I&quot;</span>)</span>
<span id="cb31-118"><a href="estimacion_municipios_ipm_pobreza.html#cb31-118" tabindex="-1"></a></span>
<span id="cb31-119"><a href="estimacion_municipios_ipm_pobreza.html#cb31-119" tabindex="-1"></a>pobreza <span class="ot">&lt;-</span>  encuesta_sta <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb31-120"><a href="estimacion_municipios_ipm_pobreza.html#cb31-120" tabindex="-1"></a>  <span class="at">pobre_ext =</span> <span class="fu">weighted.mean</span>(pobre_extrema, fep),</span>
<span id="cb31-121"><a href="estimacion_municipios_ipm_pobreza.html#cb31-121" tabindex="-1"></a>  <span class="at">pob_mod =</span> <span class="fu">weighted.mean</span>(pobre_moderada, fep),</span>
<span id="cb31-122"><a href="estimacion_municipios_ipm_pobreza.html#cb31-122" tabindex="-1"></a>  <span class="at">pobre_moderada =</span> <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>pob_mod,</span>
<span id="cb31-123"><a href="estimacion_municipios_ipm_pobreza.html#cb31-123" tabindex="-1"></a>  <span class="at">pobre_extrema =</span> <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>pobre_ext)</span>
<span id="cb31-124"><a href="estimacion_municipios_ipm_pobreza.html#cb31-124" tabindex="-1"></a></span>
<span id="cb31-125"><a href="estimacion_municipios_ipm_pobreza.html#cb31-125" tabindex="-1"></a>Tx_ipm <span class="ot">&lt;-</span> <span class="fu">setNames</span>(tot_pob<span class="sc">$</span>tx_ipm,<span class="fu">paste0</span>(<span class="st">&quot;ipm_&quot;</span>,tot_pob<span class="sc">$</span>ipm))</span>
<span id="cb31-126"><a href="estimacion_municipios_ipm_pobreza.html#cb31-126" tabindex="-1"></a>Tx_pob <span class="ot">&lt;-</span> pobreza[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>() <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span>
<span id="cb31-127"><a href="estimacion_municipios_ipm_pobreza.html#cb31-127" tabindex="-1"></a></span>
<span id="cb31-128"><a href="estimacion_municipios_ipm_pobreza.html#cb31-128" tabindex="-1"></a>tx_mun <span class="ot">&lt;-</span> <span class="fu">setNames</span>(total_mpio<span class="sc">$</span>den_mpio,</span>
<span id="cb31-129"><a href="estimacion_municipios_ipm_pobreza.html#cb31-129" tabindex="-1"></a>                   <span class="fu">paste0</span>(<span class="st">&quot;cve_mun_&quot;</span>,total_mpio<span class="sc">$</span>cve_mun))</span>
<span id="cb31-130"><a href="estimacion_municipios_ipm_pobreza.html#cb31-130" tabindex="-1"></a></span>
<span id="cb31-131"><a href="estimacion_municipios_ipm_pobreza.html#cb31-131" tabindex="-1"></a>Tx_hat <span class="ot">&lt;-</span> <span class="fu">c</span>(Tx_pob, Tx_ipm,   tx_mun)</span>
<span id="cb31-132"><a href="estimacion_municipios_ipm_pobreza.html#cb31-132" tabindex="-1"></a></span>
<span id="cb31-133"><a href="estimacion_municipios_ipm_pobreza.html#cb31-133" tabindex="-1"></a></span>
<span id="cb31-134"><a href="estimacion_municipios_ipm_pobreza.html#cb31-134" tabindex="-1"></a><span class="cf">for</span>( iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>){</span>
<span id="cb31-135"><a href="estimacion_municipios_ipm_pobreza.html#cb31-135" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> municipio = &quot;</span>, ii_ent,<span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-136"><a href="estimacion_municipios_ipm_pobreza.html#cb31-136" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> iteracion = &quot;</span>, iter,<span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-137"><a href="estimacion_municipios_ipm_pobreza.html#cb31-137" tabindex="-1"></a> </span>
<span id="cb31-138"><a href="estimacion_municipios_ipm_pobreza.html#cb31-138" tabindex="-1"></a></span>
<span id="cb31-139"><a href="estimacion_municipios_ipm_pobreza.html#cb31-139" tabindex="-1"></a></span>
<span id="cb31-140"><a href="estimacion_municipios_ipm_pobreza.html#cb31-140" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb31-141"><a href="estimacion_municipios_ipm_pobreza.html#cb31-141" tabindex="-1"></a>muestra_post <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb31-142"><a href="estimacion_municipios_ipm_pobreza.html#cb31-142" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-143"><a href="estimacion_municipios_ipm_pobreza.html#cb31-143" tabindex="-1"></a>    <span class="at">ic_segsoc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_segsoc),</span>
<span id="cb31-144"><a href="estimacion_municipios_ipm_pobreza.html#cb31-144" tabindex="-1"></a>    <span class="at">ic_ali_nc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_ic_ali_nc),</span>
<span id="cb31-145"><a href="estimacion_municipios_ipm_pobreza.html#cb31-145" tabindex="-1"></a>    <span class="at">ingreso =</span> pred_ingreso <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(),<span class="at">mean =</span> <span class="dv">0</span>,</span>
<span id="cb31-146"><a href="estimacion_municipios_ipm_pobreza.html#cb31-146" tabindex="-1"></a>                                   desv_estandar_residual),</span>
<span id="cb31-147"><a href="estimacion_municipios_ipm_pobreza.html#cb31-147" tabindex="-1"></a>    <span class="at">tol_ic =</span> tol_ic4 <span class="sc">+</span> ic_segsoc <span class="sc">+</span> ic_ali_nc</span>
<span id="cb31-148"><a href="estimacion_municipios_ipm_pobreza.html#cb31-148" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb31-149"><a href="estimacion_municipios_ipm_pobreza.html#cb31-149" tabindex="-1"></a>    <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-150"><a href="estimacion_municipios_ipm_pobreza.html#cb31-150" tabindex="-1"></a>      <span class="co"># Población en situación de pobreza.</span></span>
<span id="cb31-151"><a href="estimacion_municipios_ipm_pobreza.html#cb31-151" tabindex="-1"></a>      ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb31-152"><a href="estimacion_municipios_ipm_pobreza.html#cb31-152" tabindex="-1"></a>      <span class="co"># Población vulnerable por carencias sociales.</span></span>
<span id="cb31-153"><a href="estimacion_municipios_ipm_pobreza.html#cb31-153" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb31-154"><a href="estimacion_municipios_ipm_pobreza.html#cb31-154" tabindex="-1"></a>      <span class="co"># Poblacion vulnerable por ingresos.</span></span>
<span id="cb31-155"><a href="estimacion_municipios_ipm_pobreza.html#cb31-155" tabindex="-1"></a>      ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb31-156"><a href="estimacion_municipios_ipm_pobreza.html#cb31-156" tabindex="-1"></a>      <span class="co"># Población no pobre multidimensional y no vulnerable.</span></span>
<span id="cb31-157"><a href="estimacion_municipios_ipm_pobreza.html#cb31-157" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb31-158"><a href="estimacion_municipios_ipm_pobreza.html#cb31-158" tabindex="-1"></a>    ),</span>
<span id="cb31-159"><a href="estimacion_municipios_ipm_pobreza.html#cb31-159" tabindex="-1"></a>    <span class="co"># Población en situación de pobreza moderada.</span></span>
<span id="cb31-160"><a href="estimacion_municipios_ipm_pobreza.html#cb31-160" tabindex="-1"></a>    <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb31-161"><a href="estimacion_municipios_ipm_pobreza.html#cb31-161" tabindex="-1"></a>                              tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-162"><a href="estimacion_municipios_ipm_pobreza.html#cb31-162" tabindex="-1"></a>    <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))  </span>
<span id="cb31-163"><a href="estimacion_municipios_ipm_pobreza.html#cb31-163" tabindex="-1"></a></span>
<span id="cb31-164"><a href="estimacion_municipios_ipm_pobreza.html#cb31-164" tabindex="-1"></a></span>
<span id="cb31-165"><a href="estimacion_municipios_ipm_pobreza.html#cb31-165" tabindex="-1"></a></span>
<span id="cb31-166"><a href="estimacion_municipios_ipm_pobreza.html#cb31-166" tabindex="-1"></a>Xk <span class="ot">&lt;-</span> muestra_post <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;ipm&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-167"><a href="estimacion_municipios_ipm_pobreza.html#cb31-167" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_columns</span>(<span class="at">select_columns =</span> <span class="fu">c</span>(<span class="st">&quot;ipm&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-168"><a href="estimacion_municipios_ipm_pobreza.html#cb31-168" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">names</span>(Tx_hat[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]))</span>
<span id="cb31-169"><a href="estimacion_municipios_ipm_pobreza.html#cb31-169" tabindex="-1"></a></span>
<span id="cb31-170"><a href="estimacion_municipios_ipm_pobreza.html#cb31-170" tabindex="-1"></a>diseno_post <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(muestra_post,Xk) <span class="sc">%&gt;%</span> </span>
<span id="cb31-171"><a href="estimacion_municipios_ipm_pobreza.html#cb31-171" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fep =</span> factor) <span class="sc">%&gt;%</span></span>
<span id="cb31-172"><a href="estimacion_municipios_ipm_pobreza.html#cb31-172" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(</span>
<span id="cb31-173"><a href="estimacion_municipios_ipm_pobreza.html#cb31-173" tabindex="-1"></a>    <span class="at">ids =</span> upm,</span>
<span id="cb31-174"><a href="estimacion_municipios_ipm_pobreza.html#cb31-174" tabindex="-1"></a>    <span class="at">weights =</span> fep,</span>
<span id="cb31-175"><a href="estimacion_municipios_ipm_pobreza.html#cb31-175" tabindex="-1"></a>    <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-176"><a href="estimacion_municipios_ipm_pobreza.html#cb31-176" tabindex="-1"></a>    <span class="co"># strata = estrato</span></span>
<span id="cb31-177"><a href="estimacion_municipios_ipm_pobreza.html#cb31-177" tabindex="-1"></a>  )</span>
<span id="cb31-178"><a href="estimacion_municipios_ipm_pobreza.html#cb31-178" tabindex="-1"></a></span>
<span id="cb31-179"><a href="estimacion_municipios_ipm_pobreza.html#cb31-179" tabindex="-1"></a>mod_calib <span class="ot">&lt;-</span>  <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~ -1+&quot;</span>,<span class="fu">paste0</span>(<span class="fu">names</span>(Tx_hat), <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb31-180"><a href="estimacion_municipios_ipm_pobreza.html#cb31-180" tabindex="-1"></a></span>
<span id="cb31-181"><a href="estimacion_municipios_ipm_pobreza.html#cb31-181" tabindex="-1"></a>diseno_calib <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(diseno_post, <span class="at">formula =</span> mod_calib, </span>
<span id="cb31-182"><a href="estimacion_municipios_ipm_pobreza.html#cb31-182" tabindex="-1"></a>                          <span class="at">population =</span> Tx_hat,<span class="at">calfun =</span> <span class="st">&quot;raking&quot;</span>)</span>
<span id="cb31-183"><a href="estimacion_municipios_ipm_pobreza.html#cb31-183" tabindex="-1"></a></span>
<span id="cb31-184"><a href="estimacion_municipios_ipm_pobreza.html#cb31-184" tabindex="-1"></a>estima_calib_ipm  <span class="ot">&lt;-</span> diseno_calib <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun,ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb31-185"><a href="estimacion_municipios_ipm_pobreza.html#cb31-185" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">est_ipm =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span><span class="st">&quot;var&quot;</span>))</span>
<span id="cb31-186"><a href="estimacion_municipios_ipm_pobreza.html#cb31-186" tabindex="-1"></a></span>
<span id="cb31-187"><a href="estimacion_municipios_ipm_pobreza.html#cb31-187" tabindex="-1"></a>estima_calib_pob  <span class="ot">&lt;-</span> diseno_calib <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb31-188"><a href="estimacion_municipios_ipm_pobreza.html#cb31-188" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">est_pob_ext =</span> <span class="fu">survey_mean</span>(pobre_extrema , <span class="at">vartype =</span><span class="st">&quot;var&quot;</span>),</span>
<span id="cb31-189"><a href="estimacion_municipios_ipm_pobreza.html#cb31-189" tabindex="-1"></a>            <span class="at">est_pob_mod =</span> <span class="fu">survey_mean</span>(pobre_moderada  , <span class="at">vartype =</span><span class="st">&quot;var&quot;</span> ))</span>
<span id="cb31-190"><a href="estimacion_municipios_ipm_pobreza.html#cb31-190" tabindex="-1"></a></span>
<span id="cb31-191"><a href="estimacion_municipios_ipm_pobreza.html#cb31-191" tabindex="-1"></a>estima_calib <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb31-192"><a href="estimacion_municipios_ipm_pobreza.html#cb31-192" tabindex="-1"></a>  <span class="at">data =</span> estima_calib_ipm,</span>
<span id="cb31-193"><a href="estimacion_municipios_ipm_pobreza.html#cb31-193" tabindex="-1"></a>  <span class="at">id_cols =</span> <span class="st">&quot;cve_mun&quot;</span>,</span>
<span id="cb31-194"><a href="estimacion_municipios_ipm_pobreza.html#cb31-194" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="st">&quot;ipm&quot;</span>,</span>
<span id="cb31-195"><a href="estimacion_municipios_ipm_pobreza.html#cb31-195" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;est_ipm&quot;</span>, <span class="st">&quot;est_ipm_var&quot;</span>),<span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb31-196"><a href="estimacion_municipios_ipm_pobreza.html#cb31-196" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(estima_calib_pob)</span>
<span id="cb31-197"><a href="estimacion_municipios_ipm_pobreza.html#cb31-197" tabindex="-1"></a></span>
<span id="cb31-198"><a href="estimacion_municipios_ipm_pobreza.html#cb31-198" tabindex="-1"></a></span>
<span id="cb31-199"><a href="estimacion_municipios_ipm_pobreza.html#cb31-199" tabindex="-1"></a>valida_ipm <span class="ot">&lt;-</span> estima_calib_ipm <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(total_mpio, <span class="at">by =</span> <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-200"><a href="estimacion_municipios_ipm_pobreza.html#cb31-200" tabindex="-1"></a>  <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb31-201"><a href="estimacion_municipios_ipm_pobreza.html#cb31-201" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop_ampliada =</span> <span class="fu">sum</span>(est_ipm<span class="sc">*</span>den_mpio)<span class="sc">/</span><span class="fu">unique</span>(tot_ent)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-202"><a href="estimacion_municipios_ipm_pobreza.html#cb31-202" tabindex="-1"></a>  <span class="fu">full_join</span>(tot_pob, <span class="at">by =</span> <span class="st">&quot;ipm&quot;</span>)</span>
<span id="cb31-203"><a href="estimacion_municipios_ipm_pobreza.html#cb31-203" tabindex="-1"></a></span>
<span id="cb31-204"><a href="estimacion_municipios_ipm_pobreza.html#cb31-204" tabindex="-1"></a>valida_pob <span class="ot">&lt;-</span> estima_calib_pob <span class="sc">%&gt;%</span> <span class="fu">select</span>(cve_mun, est_pob_ext , est_pob_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb31-205"><a href="estimacion_municipios_ipm_pobreza.html#cb31-205" tabindex="-1"></a>  <span class="fu">inner_join</span>(total_mpio, <span class="at">by =</span> <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-206"><a href="estimacion_municipios_ipm_pobreza.html#cb31-206" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pob_ext_ampliada =</span> <span class="fu">sum</span>(est_pob_ext <span class="sc">*</span> den_mpio) <span class="sc">/</span> <span class="fu">unique</span>(tot_ent),</span>
<span id="cb31-207"><a href="estimacion_municipios_ipm_pobreza.html#cb31-207" tabindex="-1"></a>            <span class="at">pob_mod_ampliada =</span> <span class="fu">sum</span>(est_pob_mod <span class="sc">*</span> den_mpio) <span class="sc">/</span> <span class="fu">unique</span>(tot_ent),</span>
<span id="cb31-208"><a href="estimacion_municipios_ipm_pobreza.html#cb31-208" tabindex="-1"></a>            <span class="at">ipm_I =</span> pob_ext_ampliada <span class="sc">+</span> pob_mod_ampliada) <span class="sc">%&gt;%</span> </span>
<span id="cb31-209"><a href="estimacion_municipios_ipm_pobreza.html#cb31-209" tabindex="-1"></a>  <span class="fu">bind_cols</span>(pobreza[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb31-210"><a href="estimacion_municipios_ipm_pobreza.html#cb31-210" tabindex="-1"></a></span>
<span id="cb31-211"><a href="estimacion_municipios_ipm_pobreza.html#cb31-211" tabindex="-1"></a></span>
<span id="cb31-212"><a href="estimacion_municipios_ipm_pobreza.html#cb31-212" tabindex="-1"></a></span>
<span id="cb31-213"><a href="estimacion_municipios_ipm_pobreza.html#cb31-213" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">valida =</span> <span class="fu">list</span>(<span class="at">valida_pob =</span> valida_pob, </span>
<span id="cb31-214"><a href="estimacion_municipios_ipm_pobreza.html#cb31-214" tabindex="-1"></a>                           <span class="at">valida_ipm =</span> valida_ipm),</span>
<span id="cb31-215"><a href="estimacion_municipios_ipm_pobreza.html#cb31-215" tabindex="-1"></a>             <span class="at">estima_calib =</span> estima_calib),</span>
<span id="cb31-216"><a href="estimacion_municipios_ipm_pobreza.html#cb31-216" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste0</span>( <span class="st">&quot;../output/2020/iteraciones/mpio_calib/&quot;</span>,</span>
<span id="cb31-217"><a href="estimacion_municipios_ipm_pobreza.html#cb31-217" tabindex="-1"></a>                       ii_ent,<span class="st">&quot;/iter&quot;</span>,iter,<span class="st">&quot;.rds&quot;</span>))</span>
<span id="cb31-218"><a href="estimacion_municipios_ipm_pobreza.html#cb31-218" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb31-219"><a href="estimacion_municipios_ipm_pobreza.html#cb31-219" tabindex="-1"></a>}</span>
<span id="cb31-220"><a href="estimacion_municipios_ipm_pobreza.html#cb31-220" tabindex="-1"></a>  fin <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-221"><a href="estimacion_municipios_ipm_pobreza.html#cb31-221" tabindex="-1"></a>  tiempo_total <span class="ot">&lt;-</span> <span class="fu">difftime</span>(fin, inicio, <span class="at">units =</span> <span class="st">&quot;mins&quot;</span>)</span>
<span id="cb31-222"><a href="estimacion_municipios_ipm_pobreza.html#cb31-222" tabindex="-1"></a>  <span class="fu">print</span>(tiempo_total)</span>
<span id="cb31-223"><a href="estimacion_municipios_ipm_pobreza.html#cb31-223" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;####################################################################</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-224"><a href="estimacion_municipios_ipm_pobreza.html#cb31-224" tabindex="-1"></a>  </span>
<span id="cb31-225"><a href="estimacion_municipios_ipm_pobreza.html#cb31-225" tabindex="-1"></a>  }</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="estimacion_ent_02.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimacion_municipios_ipm_pobreza_error.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2023MEXsae/14_estimacion_municipios_ipm_pobreza.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.pdf", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.epub", "Fortalecimiento de capacidades en Técnicas de Estimación en Áreas Pequeñas con enfoque Bayesiano para la desagregación de datos.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

</body>

</html>
