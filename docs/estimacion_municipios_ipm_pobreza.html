<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14_estimacion_municipios_ipm_pobreza.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020</title>
  <meta name="description" content="Manual de procesamiento." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="14_estimacion_municipios_ipm_pobreza.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Manual de procesamiento." />
  <meta name="github-repo" content="psirusteam/coneval" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14_estimacion_municipios_ipm_pobreza.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020" />
  
  <meta name="twitter:description" content="Manual de procesamiento." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero" />


<meta name="date" content="2024-07-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estimacion_ent_02.html"/>
<link rel="next" href="estimacion_municipios_ipm_pobreza_error.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Manual de procesamiento.</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#respositodio-de-códigos"><i class="fa fa-check"></i>Respositodio de códigos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-proyecto"><i class="fa fa-check"></i>Estructura del Proyecto</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#librerias-de-r-y-otros-insumos"><i class="fa fa-check"></i>Librerias de <em>R</em> y otros insumos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#bases-de-datos-utilizadas"><i class="fa fa-check"></i>Bases de Datos Utilizadas</a></li>
<li class="chapter" data-level="" data-path="indicadores-estimados.html"><a href="indicadores-estimados.html"><i class="fa fa-check"></i>Indicadores estimados</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="union_bases.html"><a href="union_bases.html"><i class="fa fa-check"></i>00_union_bases.R</a></li>
<li class="chapter" data-level="" data-path="descarga_satelitales.html"><a href="descarga_satelitales.html"><i class="fa fa-check"></i>01_Descarga_satelitales.R</a></li>
<li class="chapter" data-level="" data-path="union_predictores.html"><a href="union_predictores.html"><i class="fa fa-check"></i>02_Union_predictores.R</a></li>
<li class="chapter" data-level="" data-path="estandarizar_muestra_cuestionario_ampliado.html"><a href="estandarizar_muestra_cuestionario_ampliado.html"><i class="fa fa-check"></i>03_Estandarizar_muestra_cuestionario_ampliado.R</a></li>
<li class="chapter" data-level="" data-path="armonizar_encuesta.html"><a href="armonizar_encuesta.html"><i class="fa fa-check"></i>04_Armonizar_encuesta.R</a></li>
<li class="chapter" data-level="" data-path="validacion_encuestas.html"><a href="validacion_encuestas.html"><i class="fa fa-check"></i>05_Validacion_encuestas.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_ictpc.html"><a href="modelo_unidad_ictpc.html"><i class="fa fa-check"></i>06_Modelo_unidad_ictpc.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_py_ic_ali_nc.html"><a href="modelo_unidad_py_ic_ali_nc.html"><i class="fa fa-check"></i>07_Modelo_unidad_py_ic_ali_nc.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_py_ic_segsoc.html"><a href="modelo_unidad_py_ic_segsoc.html"><i class="fa fa-check"></i>08_Modelo_unidad_py_ic_segsoc</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ictpc.html"><a href="postbenchmarking_ictpc.html"><i class="fa fa-check"></i>09_PostBenchmarking_ictpc.R</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ic_ali_nc.html"><a href="postbenchmarking_ic_ali_nc.html"><i class="fa fa-check"></i>10_PostBenchmarking_ic_ali_nc.R</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ic_segsoc.html"><a href="postbenchmarking_ic_segsoc.html"><i class="fa fa-check"></i>11_PostBenchmarking_ic_segsoc.r</a></li>
<li class="chapter" data-level="" data-path="imputacion_censal.html"><a href="imputacion_censal.html"><i class="fa fa-check"></i>12_Imputacion_censal.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_ent_02.html"><a href="estimacion_ent_02.html"><i class="fa fa-check"></i>13_Estimacion_ent_02.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_ipm_pobreza.html"><a href="estimacion_municipios_ipm_pobreza.html"><i class="fa fa-check"></i>14_estimacion_municipios_ipm_pobreza.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_ipm_pobreza_error.html"><a href="estimacion_municipios_ipm_pobreza_error.html"><i class="fa fa-check"></i>15_estimacion_municipios_ipm_pobreza_error.R</a></li>
<li class="chapter" data-level="" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i>16_Mapas.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html"><i class="fa fa-check"></i>17_estimacion_municipios_carencias.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_carencias_error.html"><a href="estimacion_municipios_carencias_error.html"><i class="fa fa-check"></i>18_estimacion_municipios_carencias_error.R</a></li>
<li class="chapter" data-level="" data-path="mapas_carencias.html"><a href="mapas_carencias.html"><i class="fa fa-check"></i>19_Mapas_carencias.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_directa_carencias.html"><a href="estimacion_directa_carencias.html"><i class="fa fa-check"></i>20_estimacion_directa_carencias.R</a></li>
<li class="divider"></li>
<li><a Manual de procesamiento. </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="estimacion_municipios_ipm_pobreza.r" class="section level1 unnumbered hasAnchor">
<h1>14_estimacion_municipios_ipm_pobreza.R<a href="estimacion_municipios_ipm_pobreza.html#estimacion_municipios_ipm_pobreza.r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Para la ejecución del presente análisis, se debe abrir el archivo <strong>14_estimacion_municipios_ipm_pobreza.R</strong> disponible en la ruta <em>Rcodes/2020/14_estimacion_municipios_ipm_pobreza.R</em>.</p>
<p>Este script en R realiza un análisis exhaustivo para calibrar y validar indicadores de pobreza a nivel municipal, utilizando modelos predictivos y datos de encuestas. Primero, el entorno de trabajo se limpia y se cargan las librerías necesarias para la manipulación de datos (<code>tidyverse</code>, <code>data.table</code>, <code>magrittr</code>, etc.) y para realizar cálculos estadísticos (<code>lme4</code>, <code>survey</code>, <code>srvyr</code>). Luego, se leen datos de predicciones y encuestas ampliadas, junto con información adicional sobre las líneas de bienestar.</p>
<p>En la sección inicial de procesamiento, se unen y mutan los datos de la encuesta ENIGH para calcular indicadores de pobreza y vulnerabilidad multidimensional. Se asignan categorías de pobreza (<code>ipm</code>) y se crean nuevas variables que reflejan la pobreza moderada y extrema, basadas en umbrales de ingreso y carencias sociales.</p>
<p>El script luego se centra en la preparación de datos para la calibración de modelos. La muestra ampliada se ajusta para incluir variables adicionales y predicciones de ingreso y carencias sociales. A continuación, se inicia un bucle que itera sobre un conjunto de códigos de entidad territorial. Para cada entidad, se filtran y ajustan los datos de la encuesta ampliada y se simulan nuevas variables (como ingresos y carencias sociales) utilizando distribuciones probabilísticas basadas en las predicciones anteriores.</p>
<p>Dentro de cada iteración, se realiza una calibración de los datos utilizando el método de “raking”, que ajusta las estimaciones de los indicadores a las estimaciones poblacionales conocidas. Los resultados de la calibración se calculan para cada municipio y se comparan con los datos originales para validar la precisión de las estimaciones. Finalmente, los resultados de cada iteración se guardan en archivos RDS separados para su análisis posterior y se reporta el tiempo total de ejecución del proceso.</p>
<p>Este enfoque permite realizar un ajuste fino de los modelos predictivos y asegurar que las estimaciones de pobreza sean lo más precisas posible, utilizando simulaciones y técnicas avanzadas de calibración.</p>
<div id="limpieza-del-entorno-y-carga-de-bibliotecas-7" class="section level4 unnumbered hasAnchor">
<h4>Limpieza del Entorno y Carga de Bibliotecas<a href="estimacion_municipios_ipm_pobreza.html#limpieza-del-entorno-y-carga-de-bibliotecas-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="estimacion_municipios_ipm_pobreza.html#cb97-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb97-2"><a href="estimacion_municipios_ipm_pobreza.html#cb97-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb97-3"><a href="estimacion_municipios_ipm_pobreza.html#cb97-3" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb97-4"><a href="estimacion_municipios_ipm_pobreza.html#cb97-4" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb97-5"><a href="estimacion_municipios_ipm_pobreza.html#cb97-5" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb97-6"><a href="estimacion_municipios_ipm_pobreza.html#cb97-6" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb97-7"><a href="estimacion_municipios_ipm_pobreza.html#cb97-7" tabindex="-1"></a><span class="fu">library</span>(labelled)</span>
<span id="cb97-8"><a href="estimacion_municipios_ipm_pobreza.html#cb97-8" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb97-9"><a href="estimacion_municipios_ipm_pobreza.html#cb97-9" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb97-10"><a href="estimacion_municipios_ipm_pobreza.html#cb97-10" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb97-11"><a href="estimacion_municipios_ipm_pobreza.html#cb97-11" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb97-12"><a href="estimacion_municipios_ipm_pobreza.html#cb97-12" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../source/benchmarking_indicador.R&quot;</span>)</span></code></pre></div>
</div>
<div id="lectura-de-datos-2" class="section level4 unnumbered hasAnchor">
<h4>Lectura de Datos<a href="estimacion_municipios_ipm_pobreza.html#lectura-de-datos-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se cargan los datos necesarios y las predicciones de los modelos previamente ajustados.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="estimacion_municipios_ipm_pobreza.html#cb98-1" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">&quot;../output/2020/modelos/predicciones.rds&quot;</span>)</span>
<span id="cb98-2"><a href="estimacion_municipios_ipm_pobreza.html#cb98-2" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../output/2020/encuesta_ampliada.rds&quot;</span>)</span>
<span id="cb98-3"><a href="estimacion_municipios_ipm_pobreza.html#cb98-3" tabindex="-1"></a>encuesta_enigh <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../input/2020/enigh/encuesta_sta.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="estimacion_municipios_ipm_pobreza.html#cb98-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ingreso =</span> ictpc)</span>
<span id="cb98-5"><a href="estimacion_municipios_ipm_pobreza.html#cb98-5" tabindex="-1"></a></span>
<span id="cb98-6"><a href="estimacion_municipios_ipm_pobreza.html#cb98-6" tabindex="-1"></a>LB <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(</span>
<span id="cb98-7"><a href="estimacion_municipios_ipm_pobreza.html#cb98-7" tabindex="-1"></a>    <span class="st">&quot;../input/2020/Lineas_Bienestar.csv&quot;</span>,</span>
<span id="cb98-8"><a href="estimacion_municipios_ipm_pobreza.html#cb98-8" tabindex="-1"></a>    <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-9"><a href="estimacion_municipios_ipm_pobreza.html#cb98-9" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb98-10"><a href="estimacion_municipios_ipm_pobreza.html#cb98-10" tabindex="-1"></a>    <span class="at">dec =</span> <span class="st">&quot;,&quot;</span></span>
<span id="cb98-11"><a href="estimacion_municipios_ipm_pobreza.html#cb98-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">as.character</span>(area))</span></code></pre></div>
</div>
<div id="cálculo-del-ipm-en-la-encuesta" class="section level4 unnumbered hasAnchor">
<h4>Cálculo del IPM en la Encuesta<a href="estimacion_municipios_ipm_pobreza.html#cálculo-del-ipm-en-la-encuesta" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Aquí se calcula el IPM y las nuevas variables de pobreza moderada y extrema en la encuesta <code>encuesta_enigh</code>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="estimacion_municipios_ipm_pobreza.html#cb99-1" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb99-2"><a href="estimacion_municipios_ipm_pobreza.html#cb99-2" tabindex="-1"></a><span class="co"># IPM en la enigh</span></span>
<span id="cb99-3"><a href="estimacion_municipios_ipm_pobreza.html#cb99-3" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb99-4"><a href="estimacion_municipios_ipm_pobreza.html#cb99-4" tabindex="-1"></a>encuesta_enigh <span class="ot">&lt;-</span></span>
<span id="cb99-5"><a href="estimacion_municipios_ipm_pobreza.html#cb99-5" tabindex="-1"></a>  encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(LB)  <span class="sc">%&gt;%</span> </span>
<span id="cb99-6"><a href="estimacion_municipios_ipm_pobreza.html#cb99-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb99-7"><a href="estimacion_municipios_ipm_pobreza.html#cb99-7" tabindex="-1"></a>    <span class="at">tol_ic =</span> ic_segsoc <span class="sc">+</span> ic_ali_nc <span class="sc">+</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span>  ic_sbv <span class="sc">+</span> ic_rezedu,</span>
<span id="cb99-8"><a href="estimacion_municipios_ipm_pobreza.html#cb99-8" tabindex="-1"></a>    <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb99-9"><a href="estimacion_municipios_ipm_pobreza.html#cb99-9" tabindex="-1"></a>      <span class="co"># Población en situación de pobreza.</span></span>
<span id="cb99-10"><a href="estimacion_municipios_ipm_pobreza.html#cb99-10" tabindex="-1"></a>      ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb99-11"><a href="estimacion_municipios_ipm_pobreza.html#cb99-11" tabindex="-1"></a>      <span class="co"># Población vulnerable por carencias sociales.</span></span>
<span id="cb99-12"><a href="estimacion_municipios_ipm_pobreza.html#cb99-12" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb99-13"><a href="estimacion_municipios_ipm_pobreza.html#cb99-13" tabindex="-1"></a>      <span class="co"># Poblacion vulnerable por ingresos.</span></span>
<span id="cb99-14"><a href="estimacion_municipios_ipm_pobreza.html#cb99-14" tabindex="-1"></a>      ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb99-15"><a href="estimacion_municipios_ipm_pobreza.html#cb99-15" tabindex="-1"></a>      <span class="co"># Población no pobre multidimensional y no vulnerable.</span></span>
<span id="cb99-16"><a href="estimacion_municipios_ipm_pobreza.html#cb99-16" tabindex="-1"></a>      ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb99-17"><a href="estimacion_municipios_ipm_pobreza.html#cb99-17" tabindex="-1"></a>    ),</span>
<span id="cb99-18"><a href="estimacion_municipios_ipm_pobreza.html#cb99-18" tabindex="-1"></a>    <span class="co"># Población en situación de pobreza moderada.</span></span>
<span id="cb99-19"><a href="estimacion_municipios_ipm_pobreza.html#cb99-19" tabindex="-1"></a>    <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb99-20"><a href="estimacion_municipios_ipm_pobreza.html#cb99-20" tabindex="-1"></a>                              tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb99-21"><a href="estimacion_municipios_ipm_pobreza.html#cb99-21" tabindex="-1"></a>    <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb99-22"><a href="estimacion_municipios_ipm_pobreza.html#cb99-22" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="preparación-de-la-muestra-intercensal" class="section level4 unnumbered hasAnchor">
<h4>Preparación de la Muestra Intercensal<a href="estimacion_municipios_ipm_pobreza.html#preparación-de-la-muestra-intercensal" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se ajusta la muestra ampliada y se añaden las predicciones y variables necesarias.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="estimacion_municipios_ipm_pobreza.html#cb100-1" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb100-2"><a href="estimacion_municipios_ipm_pobreza.html#cb100-2" tabindex="-1"></a><span class="co"># preparando encuesta intercensal</span></span>
<span id="cb100-3"><a href="estimacion_municipios_ipm_pobreza.html#cb100-3" tabindex="-1"></a><span class="do">################################################################################</span></span>
<span id="cb100-4"><a href="estimacion_municipios_ipm_pobreza.html#cb100-4" tabindex="-1"></a></span>
<span id="cb100-5"><a href="estimacion_municipios_ipm_pobreza.html#cb100-5" tabindex="-1"></a>muestra_ampliada <span class="ot">&lt;-</span> muestra_ampliada <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(LB) </span>
<span id="cb100-6"><a href="estimacion_municipios_ipm_pobreza.html#cb100-6" tabindex="-1"></a>muestra_ampliada   <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb100-7"><a href="estimacion_municipios_ipm_pobreza.html#cb100-7" tabindex="-1"></a>  <span class="at">ic_asalud =</span> <span class="fu">ifelse</span>(ic_asalud <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb100-8"><a href="estimacion_municipios_ipm_pobreza.html#cb100-8" tabindex="-1"></a>  <span class="at">ic_cv =</span> <span class="fu">ifelse</span>(ic_cv <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb100-9"><a href="estimacion_municipios_ipm_pobreza.html#cb100-9" tabindex="-1"></a>  <span class="at">ic_sbv =</span> <span class="fu">ifelse</span>(ic_sbv <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb100-10"><a href="estimacion_municipios_ipm_pobreza.html#cb100-10" tabindex="-1"></a>  <span class="at">ic_rezedu =</span> <span class="fu">ifelse</span>(ic_rezedu <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb100-11"><a href="estimacion_municipios_ipm_pobreza.html#cb100-11" tabindex="-1"></a>  <span class="at">tol_ic4 =</span> ic_asalud <span class="sc">+</span> ic_cv <span class="sc">+</span>  ic_sbv <span class="sc">+</span> ic_rezedu,</span>
<span id="cb100-12"><a href="estimacion_municipios_ipm_pobreza.html#cb100-12" tabindex="-1"></a>  <span class="at">pred_segsoc =</span> predicciones<span class="sc">$</span>pred_segsoc,</span>
<span id="cb100-13"><a href="estimacion_municipios_ipm_pobreza.html#cb100-13" tabindex="-1"></a>  <span class="at">pred_ingreso =</span> predicciones<span class="sc">$</span>pred_ingreso,</span>
<span id="cb100-14"><a href="estimacion_municipios_ipm_pobreza.html#cb100-14" tabindex="-1"></a>  <span class="at">desv_estandar_residual =</span> predicciones<span class="sc">$</span>desv_estandar_residual,</span>
<span id="cb100-15"><a href="estimacion_municipios_ipm_pobreza.html#cb100-15" tabindex="-1"></a>  <span class="at">pred_ic_ali_nc =</span> predicciones<span class="sc">$</span>pred_ic_ali_nc</span>
<span id="cb100-16"><a href="estimacion_municipios_ipm_pobreza.html#cb100-16" tabindex="-1"></a>) </span>
<span id="cb100-17"><a href="estimacion_municipios_ipm_pobreza.html#cb100-17" tabindex="-1"></a></span>
<span id="cb100-18"><a href="estimacion_municipios_ipm_pobreza.html#cb100-18" tabindex="-1"></a><span class="fu">rm</span>(predicciones)</span></code></pre></div>
</div>
<div id="iteración-por-entidades-federativas" class="section level4 unnumbered hasAnchor">
<h4>Iteración por Entidades Federativas<a href="estimacion_municipios_ipm_pobreza.html#iteración-por-entidades-federativas" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Para cada entidad federal (<code>ii_ent</code>), se realiza una iteración que ajusta la muestra post-calibración y calcula las estimaciones.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="estimacion_municipios_ipm_pobreza.html#cb101-1" tabindex="-1"></a>ii_ent <span class="ot">&lt;-</span> <span class="st">&quot;02&quot;</span></span>
<span id="cb101-2"><a href="estimacion_municipios_ipm_pobreza.html#cb101-2" tabindex="-1"></a>iter <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb101-3"><a href="estimacion_municipios_ipm_pobreza.html#cb101-3" tabindex="-1"></a></span>
<span id="cb101-4"><a href="estimacion_municipios_ipm_pobreza.html#cb101-4" tabindex="-1"></a><span class="cf">for</span>(ii_ent <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;03&quot;</span>, <span class="st">&quot;06&quot;</span>, <span class="st">&quot;23&quot;</span>, <span class="st">&quot;04&quot;</span>, <span class="st">&quot;01&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;27&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;18&quot;</span>,</span>
<span id="cb101-5"><a href="estimacion_municipios_ipm_pobreza.html#cb101-5" tabindex="-1"></a>                <span class="st">&quot;05&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;28&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;26&quot;</span>, <span class="st">&quot;09&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;08&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;29&quot;</span>, </span>
<span id="cb101-6"><a href="estimacion_municipios_ipm_pobreza.html#cb101-6" tabindex="-1"></a>                <span class="st">&quot;24&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;07&quot;</span>, <span class="st">&quot;21&quot;</span>, </span>
<span id="cb101-7"><a href="estimacion_municipios_ipm_pobreza.html#cb101-7" tabindex="-1"></a>                <span class="st">&quot;30&quot;</span>,  <span class="st">&quot;20&quot;</span> ,<span class="st">&quot;02&quot;</span></span>
<span id="cb101-8"><a href="estimacion_municipios_ipm_pobreza.html#cb101-8" tabindex="-1"></a>)){</span>
<span id="cb101-9"><a href="estimacion_municipios_ipm_pobreza.html#cb101-9" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;####################################################################</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb101-10"><a href="estimacion_municipios_ipm_pobreza.html#cb101-10" tabindex="-1"></a>  inicio <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb101-11"><a href="estimacion_municipios_ipm_pobreza.html#cb101-11" tabindex="-1"></a>  <span class="fu">print</span>(inicio)</span>
<span id="cb101-12"><a href="estimacion_municipios_ipm_pobreza.html#cb101-12" tabindex="-1"></a></span>
<span id="cb101-13"><a href="estimacion_municipios_ipm_pobreza.html#cb101-13" tabindex="-1"></a>  <span class="co"># Filtrar muestra post</span></span>
<span id="cb101-14"><a href="estimacion_municipios_ipm_pobreza.html#cb101-14" tabindex="-1"></a>  muestra_post <span class="ot">=</span> muestra_ampliada <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ent <span class="sc">==</span> ii_ent)</span>
<span id="cb101-15"><a href="estimacion_municipios_ipm_pobreza.html#cb101-15" tabindex="-1"></a></span>
<span id="cb101-16"><a href="estimacion_municipios_ipm_pobreza.html#cb101-16" tabindex="-1"></a>  <span class="co"># Cálculo de totales por municipio y población</span></span>
<span id="cb101-17"><a href="estimacion_municipios_ipm_pobreza.html#cb101-17" tabindex="-1"></a>  total_mpio  <span class="ot">&lt;-</span> muestra_post <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb101-18"><a href="estimacion_municipios_ipm_pobreza.html#cb101-18" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">den_mpio =</span> <span class="fu">sum</span>(factor), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-19"><a href="estimacion_municipios_ipm_pobreza.html#cb101-19" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tot_ent =</span> <span class="fu">sum</span>(den_mpio))</span>
<span id="cb101-20"><a href="estimacion_municipios_ipm_pobreza.html#cb101-20" tabindex="-1"></a></span>
<span id="cb101-21"><a href="estimacion_municipios_ipm_pobreza.html#cb101-21" tabindex="-1"></a>  encuesta_sta <span class="ot">=</span> encuesta_enigh <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ent <span class="sc">==</span> ii_ent)</span>
<span id="cb101-22"><a href="estimacion_municipios_ipm_pobreza.html#cb101-22" tabindex="-1"></a>  encuesta_sta <span class="sc">%&lt;&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb101-23"><a href="estimacion_municipios_ipm_pobreza.html#cb101-23" tabindex="-1"></a></span>
<span id="cb101-24"><a href="estimacion_municipios_ipm_pobreza.html#cb101-24" tabindex="-1"></a>  tot_pob <span class="ot">&lt;-</span> encuesta_sta <span class="sc">%&gt;%</span> </span>
<span id="cb101-25"><a href="estimacion_municipios_ipm_pobreza.html#cb101-25" tabindex="-1"></a>    <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb101-26"><a href="estimacion_municipios_ipm_pobreza.html#cb101-26" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">num_ent =</span> <span class="fu">sum</span>(fep), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-27"><a href="estimacion_municipios_ipm_pobreza.html#cb101-27" tabindex="-1"></a>    <span class="fu">transmute</span>(ipm, <span class="at">prop_ipm =</span> num_ent<span class="sc">/</span><span class="fu">sum</span>(num_ent),</span>
<span id="cb101-28"><a href="estimacion_municipios_ipm_pobreza.html#cb101-28" tabindex="-1"></a>              <span class="at">tx_ipm =</span>  <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>prop_ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb101-29"><a href="estimacion_municipios_ipm_pobreza.html#cb101-29" tabindex="-1"></a>    <span class="fu">filter</span>(ipm <span class="sc">!=</span> <span class="st">&quot;I&quot;</span>)</span>
<span id="cb101-30"><a href="estimacion_municipios_ipm_pobreza.html#cb101-30" tabindex="-1"></a></span>
<span id="cb101-31"><a href="estimacion_municipios_ipm_pobreza.html#cb101-31" tabindex="-1"></a>  pobreza <span class="ot">&lt;-</span> encuesta_sta <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb101-32"><a href="estimacion_municipios_ipm_pobreza.html#cb101-32" tabindex="-1"></a>    <span class="at">pobre_ext =</span> <span class="fu">weighted.mean</span>(pobre_extrema, fep),</span>
<span id="cb101-33"><a href="estimacion_municipios_ipm_pobreza.html#cb101-33" tabindex="-1"></a>    <span class="at">pob_mod =</span> <span class="fu">weighted.mean</span>(pobre_moderada, fep),</span>
<span id="cb101-34"><a href="estimacion_municipios_ipm_pobreza.html#cb101-34" tabindex="-1"></a>    <span class="at">pobre_moderada =</span> <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>pob_mod,</span>
<span id="cb101-35"><a href="estimacion_municipios_ipm_pobreza.html#cb101-35" tabindex="-1"></a>    <span class="at">pobre_extrema =</span> <span class="fu">sum</span>(total_mpio<span class="sc">$</span>den_mpio)<span class="sc">*</span>pobre_ext)</span>
<span id="cb101-36"><a href="estimacion_municipios_ipm_pobreza.html#cb101-36" tabindex="-1"></a></span>
<span id="cb101-37"><a href="estimacion_municipios_ipm_pobreza.html#cb101-37" tabindex="-1"></a>  Tx_ipm <span class="ot">&lt;-</span> <span class="fu">setNames</span>(tot_pob<span class="sc">$</span>tx_ipm,<span class="fu">paste0</span>(<span class="st">&quot;ipm_&quot;</span>,tot_pob<span class="sc">$</span>ipm))</span>
<span id="cb101-38"><a href="estimacion_municipios_ipm_pobreza.html#cb101-38" tabindex="-1"></a>  Tx_pob <span class="ot">&lt;-</span> pobreza[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>() <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()</span>
<span id="cb101-39"><a href="estimacion_municipios_ipm_pobreza.html#cb101-39" tabindex="-1"></a></span>
<span id="cb101-40"><a href="estimacion_municipios_ipm_pobreza.html#cb101-40" tabindex="-1"></a>  tx_mun <span class="ot">&lt;-</span> <span class="fu">setNames</span>(total_mpio<span class="sc">$</span>den_mpio,</span>
<span id="cb101-41"><a href="estimacion_municipios_ipm_pobreza.html#cb101-41" tabindex="-1"></a>                     <span class="fu">paste0</span>(<span class="st">&quot;cve_mun_&quot;</span>,total_mpio<span class="sc">$</span>cve_mun))</span>
<span id="cb101-42"><a href="estimacion_municipios_ipm_pobreza.html#cb101-42" tabindex="-1"></a></span>
<span id="cb101-43"><a href="estimacion_municipios_ipm_pobreza.html#cb101-43" tabindex="-1"></a>  Tx_hat <span class="ot">&lt;-</span> <span class="fu">c</span>(Tx_pob, Tx_ipm, tx_mun)</span>
<span id="cb101-44"><a href="estimacion_municipios_ipm_pobreza.html#cb101-44" tabindex="-1"></a></span>
<span id="cb101-45"><a href="estimacion_municipios_ipm_pobreza.html#cb101-45" tabindex="-1"></a>  <span class="cf">for</span>(iter <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>){</span>
<span id="cb101-46"><a href="estimacion_municipios_ipm_pobreza.html#cb101-46" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> municipio = &quot;</span>, ii_ent,<span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb101-47"><a href="estimacion_municipios_ipm_pobreza.html#cb101-47" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> iteracion = &quot;</span>, iter,<span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb101-48"><a href="estimacion_municipios_ipm_pobreza.html#cb101-48" tabindex="-1"></a></span>
<span id="cb101-49"><a href="estimacion_municipios_ipm_pobreza.html#cb101-49" tabindex="-1"></a>    <span class="co"># Ajuste de la muestra post</span></span>
<span id="cb101-50"><a href="estimacion_municipios_ipm_pobreza.html#cb101-50" tabindex="-1"></a>    muestra_post <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb101-51"><a href="estimacion_municipios_ipm_pobreza.html#cb101-51" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb101-52"><a href="estimacion_municipios_ipm_pobreza.html#cb101-52" tabindex="-1"></a>        <span class="at">ic_segsoc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_segsoc),</span>
<span id="cb101-53"><a href="estimacion_municipios_ipm_pobreza.html#cb101-53" tabindex="-1"></a>        <span class="at">ic_ali_nc =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pred_ic_ali_nc),</span>
<span id="cb101-54"><a href="estimacion_municipios_ipm_pobreza.html#cb101-54" tabindex="-1"></a>        <span class="at">ingreso =</span> pred_ingreso <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, desv_estandar_residual),</span>
<span id="cb101-55"><a href="estimacion_municipios_ipm_pobreza.html#cb101-55" tabindex="-1"></a>        <span class="at">tol_ic =</span> tol_ic4 <span class="sc">+</span> ic_segsoc <span class="sc">+</span> ic_ali_nc</span>
<span id="cb101-56"><a href="estimacion_municipios_ipm_pobreza.html#cb101-56" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb101-57"><a href="estimacion_municipios_ipm_pobreza.html#cb101-57" tabindex="-1"></a>        <span class="at">ipm   =</span> <span class="fu">case_when</span>(</span>
<span id="cb101-58"><a href="estimacion_municipios_ipm_pobreza.html#cb101-58" tabindex="-1"></a>          <span class="co"># Población en situación de pobreza.</span></span>
<span id="cb101-59"><a href="estimacion_municipios_ipm_pobreza.html#cb101-59" tabindex="-1"></a>          ingreso <span class="sc">&lt;</span> lp  <span class="sc">&amp;</span>  tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb101-60"><a href="estimacion_municipios_ipm_pobreza.html#cb101-60" tabindex="-1"></a>          <span class="co"># Población vulnerable por carencias sociales.</span></span>
<span id="cb101-61"><a href="estimacion_municipios_ipm_pobreza.html#cb101-61" tabindex="-1"></a>          ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb101-62"><a href="estimacion_municipios_ipm_pobreza.html#cb101-62" tabindex="-1"></a>          <span class="co"># Poblacion vulnerable por ingresos.</span></span>
<span id="cb101-63"><a href="estimacion_municipios_ipm_pobreza.html#cb101-63" tabindex="-1"></a>          ingreso <span class="sc">&lt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb101-64"><a href="estimacion_municipios_ipm_pobreza.html#cb101-64" tabindex="-1"></a>          <span class="co"># Población no pobre multidimensional y no vulnerable.</span></span>
<span id="cb101-65"><a href="estimacion_municipios_ipm_pobreza.html#cb101-65" tabindex="-1"></a>          ingreso <span class="sc">&gt;=</span> lp <span class="sc">&amp;</span> tol_ic <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;IV&quot;</span></span>
<span id="cb101-66"><a href="estimacion_municipios_ipm_pobreza.html#cb101-66" tabindex="-1"></a>        ),</span>
<span id="cb101-67"><a href="estimacion_municipios_ipm_pobreza.html#cb101-67" tabindex="-1"></a>        <span class="co"># Población en situación de pobreza moderada.</span></span>
<span id="cb101-68"><a href="estimacion_municipios_ipm_pobreza.html#cb101-68" tabindex="-1"></a>        <span class="at">pobre_moderada =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(ingreso <span class="sc">&gt;</span> li <span class="sc">&amp;</span> ingreso <span class="sc">&lt;</span> lp) <span class="sc">&amp;</span></span>
<span id="cb101-69"><a href="estimacion_municipios_ipm_pobreza.html#cb101-69" tabindex="-1"></a>                                  tol_ic <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb101-70"><a href="estimacion_municipios_ipm_pobreza.html#cb101-70" tabindex="-1"></a>        <span class="at">pobre_extrema =</span> <span class="fu">ifelse</span>(ipm <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">&amp;</span> pobre_moderada <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))  </span>
<span id="cb101-71"><a href="estimacion_municipios_ipm_pobreza.html#cb101-71" tabindex="-1"></a></span>
<span id="cb101-72"><a href="estimacion_municipios_ipm_pobreza.html#cb101-72" tabindex="-1"></a>    Xk <span class="ot">&lt;-</span> muestra_post <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;ipm&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-73"><a href="estimacion_municipios_ipm_pobreza.html#cb101-73" tabindex="-1"></a>      fastDummies<span class="sc">::</span><span class="fu">dummy_columns</span>(<span class="at">select_columns =</span> <span class="fu">c</span>(<span class="st">&quot;ipm&quot;</span>, <span class="st">&quot;cve_mun&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb101-74"><a href="estimacion_municipios_ipm_pobreza.html#cb101-74" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">names</span>(Tx_hat[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]))</span>
<span id="cb101-75"><a href="estimacion_municipios_ipm_pobreza.html#cb101-75" tabindex="-1"></a></span>
<span id="cb101-76"><a href="estimacion_municipios_ipm_pobreza.html#cb101-76" tabindex="-1"></a>    diseno_post <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(muestra_post, Xk) <span class="sc">%&gt;%</span> </span>
<span id="cb101-77"><a href="estimacion_municipios_ipm_pobreza.html#cb101-77" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fep =</span> factor) <span class="sc">%&gt;%</span></span>
<span id="cb101-78"><a href="estimacion_municipios_ipm_pobreza.html#cb101-78" tabindex="-1"></a>      <span class="fu">as_survey_design</span>(</span>
<span id="cb101-79"><a href="estimacion_municipios_ipm_pobreza.html#cb101-79" tabindex="-1"></a>        <span class="at">ids =</span> upm,</span>
<span id="cb101-80"><a href="estimacion_municipios_ipm_pobreza.html#cb101-80" tabindex="-1"></a>        <span class="at">weights =</span> fep,</span>
<span id="cb101-81"><a href="estimacion_municipios_ipm_pobreza.html#cb101-81" tabindex="-1"></a>        <span class="at">nest =</span> <span class="cn">TRUE</span></span>
<span id="cb101-82"><a href="estimacion_municipios_ipm_pobreza.html#cb101-82" tabindex="-1"></a>      )</span>
<span id="cb101-83"><a href="estimacion_municipios_ipm_pobreza.html#cb101-83" tabindex="-1"></a></span>
<span id="cb101-84"><a href="estimacion_municipios_ipm_pobreza.html#cb101-84" tabindex="-1"></a>    mod_calib <span class="ot">&lt;-</span>  <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~ -1+&quot;</span>,<span class="fu">paste0</span>(<span class="fu">names</span>(Tx_hat), <span class="at">collapse =</span> <span class="st">&quot; + &quot;</span>)))</span>
<span id="cb101-85"><a href="estimacion_municipios_ipm_pobreza.html#cb101-85" tabindex="-1"></a></span>
<span id="cb101-86"><a href="estimacion_municipios_ipm_pobreza.html#cb101-86" tabindex="-1"></a>    diseno_calib <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(diseno_post, <span class="at">formula =</span> mod_calib, </span>
<span id="cb101-87"><a href="estimacion_municipios_ipm_pobreza.html#cb101-87" tabindex="-1"></a>                              <span class="at">population =</span> Tx_hat, <span class="at">calfun =</span> <span class="st">&quot;raking&quot;</span>)</span>
<span id="cb101-88"><a href="estimacion_municipios_ipm_pobreza.html#cb101-88" tabindex="-1"></a></span>
<span id="cb101-89"><a href="estimacion_municipios_ipm_pobreza.html#cb101-89" tabindex="-1"></a>    estima_calib_ipm  <span class="ot">&lt;-</span> diseno_calib <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun, ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb101-90"><a href="estimacion_municipios_ipm_pobreza.html#cb101-90" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">est_ipm =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span><span class="st">&quot;var&quot;</span>))</span>
<span id="cb101-91"><a href="estimacion_municipios_ipm_pobreza.html#cb101-91" tabindex="-1"></a></span>
<span id="cb101-92"><a href="estimacion_municipios_ipm_pobreza.html#cb101-92" tabindex="-1"></a>    estima_calib_pob  <span class="ot">&lt;-</span> diseno_calib <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cve_mun) <span class="sc">%&gt;%</span> </span>
<span id="cb101-93"><a href="estimacion_municipios_ipm_pobreza.html#cb101-93" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">est_pob_ext =</span> <span class="fu">survey_mean</span>(pobre_extrema , <span class="at">vartype =</span><span class="st">&quot;var&quot;</span>),</span>
<span id="cb101-94"><a href="estimacion_municipios_ipm_pobreza.html#cb101-94" tabindex="-1"></a>                <span class="at">est_pob_mod =</span> <span class="fu">survey_mean</span>(pobre_moderada  , <span class="at">vartype =</span><span class="st">&quot;var&quot;</span> ))</span>
<span id="cb101-95"><a href="estimacion_municipios_ipm_pobreza.html#cb101-95" tabindex="-1"></a></span>
<span id="cb101-96"><a href="estimacion_municipios_ipm_pobreza.html#cb101-96" tabindex="-1"></a>    estima_calib <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb101-97"><a href="estimacion_municipios_ipm_pobreza.html#cb101-97" tabindex="-1"></a>      <span class="at">data =</span> estima_calib_ipm,</span>
<span id="cb101-98"><a href="estimacion_municipios_ipm_pobreza.html#cb101-98" tabindex="-1"></a>      <span class="at">id_cols =</span> <span class="st">&quot;cve_mun&quot;</span>,</span>
<span id="cb101-99"><a href="estimacion_municipios_ipm_pobreza.html#cb101-99" tabindex="-1"></a>      <span class="at">names_from =</span> <span class="st">&quot;ipm&quot;</span>,</span>
<span id="cb101-100"><a href="estimacion_municipios_ipm_pobreza.html#cb101-100" tabindex="-1"></a>      <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;est_ipm&quot;</span>, <span class="st">&quot;est_ipm_var&quot;</span>), <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb101-101"><a href="estimacion_municipios_ipm_pobreza.html#cb101-101" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(estima_calib_pob)</span>
<span id="cb101-102"><a href="estimacion_municipios_ipm_pobreza.html#cb101-102" tabindex="-1"></a></span>
<span id="cb101-103"><a href="estimacion_municipios_ipm_pobreza.html#cb101-103" tabindex="-1"></a>    valida_ipm <span class="ot">&lt;-</span> estima_calib_ipm <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(total_mpio, <span class="at">by =</span> <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-104"><a href="estimacion_municipios_ipm_pobreza.html#cb101-104" tabindex="-1"></a>      <span class="fu">group_by</span>(ipm) <span class="sc">%&gt;%</span> </span>
<span id="cb101-105"><a href="estimacion_municipios_ipm_pobreza.html#cb101-105" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">prop_ampliada =</span> <span class="fu">sum</span>(est_ipm<span class="sc">*</span>den_mpio)<span class="sc">/</span><span class="fu">unique</span>(tot_ent)) <span class="sc">%&gt;%</span> </span>
<span id="cb101-106"><a href="estimacion_municipios_ipm_pobreza.html#cb101-106" tabindex="-1"></a>      <span class="fu">full_join</span>(tot_pob, <span class="at">by =</span> <span class="st">&quot;ipm&quot;</span>)</span>
<span id="cb101-107"><a href="estimacion_municipios_ipm_pobreza.html#cb101-107" tabindex="-1"></a></span>
<span id="cb101-108"><a href="estimacion_municipios_ipm_pobreza.html#cb101-108" tabindex="-1"></a>    valida_pob <span class="ot">&lt;-</span> estima_calib_pob <span class="sc">%&gt;%</span> <span class="fu">select</span>(cve_mun, est_pob_ext, est_pob_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb101-109"><a href="estimacion_municipios_ipm_pobreza.html#cb101-109" tabindex="-1"></a>      <span class="fu">inner_join</span>(total_mpio, <span class="at">by =</span> <span class="st">&quot;cve_mun&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-110"><a href="estimacion_municipios_ipm_pobreza.html#cb101-110" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">pob_ext_ampliada =</span> <span class="fu">sum</span>(est_pob_ext <span class="sc">*</span> den_mpio) <span class="sc">/</span> <span class="fu">unique</span>(tot_ent),</span>
<span id="cb101-111"><a href="estimacion_municipios_ipm_pobreza.html#cb101-111" tabindex="-1"></a>                <span class="at">pob_mod_ampliada =</span> <span class="fu">sum</span>(est_pob_mod <span class="sc">*</span> den_mpio) <span class="sc">/</span> <span class="fu">unique</span>(tot_ent),</span>
<span id="cb101-112"><a href="estimacion_municipios_ipm_pobreza.html#cb101-112" tabindex="-1"></a>                <span class="at">ipm_I =</span> pob_ext_ampliada <span class="sc">+</span> pob_mod_ampliada) <span class="sc">%&gt;%</span> </span>
<span id="cb101-113"><a href="estimacion_municipios_ipm_pobreza.html#cb101-113" tabindex="-1"></a>      <span class="fu">bind_cols</span>(pobreza[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb101-114"><a href="estimacion_municipios_ipm_pobreza.html#cb101-114" tabindex="-1"></a></span>
<span id="cb101-115"><a href="estimacion_municipios_ipm_pobreza.html#cb101-115" tabindex="-1"></a>    <span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">valida =</span> <span class="fu">list</span>(<span class="at">valida_pob =</span> valida_pob, </span>
<span id="cb101-116"><a href="estimacion_municipios_ipm_pobreza.html#cb101-116" tabindex="-1"></a>                               <span class="at">valida_ipm =</span> valida_ipm),</span>
<span id="cb101-117"><a href="estimacion_municipios_ipm_pobreza.html#cb101-117" tabindex="-1"></a>                 <span class="at">estima_calib =</span> estima_calib),</span>
<span id="cb101-118"><a href="estimacion_municipios_ipm_pobreza.html#cb101-118" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">paste0</span>( <span class="st">&quot;../output/2020/iteraciones/mpio_calib/&quot;</span>,</span>
<span id="cb101-119"><a href="estimacion_municipios_ipm_pobreza.html#cb101-119" tabindex="-1"></a>                           ii_ent,<span class="st">&quot;/iter&quot;</span>,iter,<span class="st">&quot;.rds&quot;</span>))</span>
<span id="cb101-120"><a href="estimacion_municipios_ipm_pobreza.html#cb101-120" tabindex="-1"></a>    <span class="fu">gc</span>()</span>
<span id="cb101-121"><a href="estimacion_municipios_ipm_pobreza.html#cb101-121" tabindex="-1"></a>  }</span>
<span id="cb101-122"><a href="estimacion_municipios_ipm_pobreza.html#cb101-122" tabindex="-1"></a>  fin <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb101-123"><a href="estimacion_municipios_ipm_pobreza.html#cb101-123" tabindex="-1"></a>  tiempo_total <span class="ot">&lt;-</span> <span class="fu">difftime</span>(fin, inicio, <span class="at">units =</span> <span class="st">&quot;mins&quot;</span>)</span>
<span id="cb101-124"><a href="estimacion_municipios_ipm_pobreza.html#cb101-124" tabindex="-1"></a>  <span class="fu">print</span>(tiempo_total)</span>
<span id="cb101-125"><a href="estimacion_municipios_ipm_pobreza.html#cb101-125" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;####################################################################</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb101-126"><a href="estimacion_municipios_ipm_pobreza.html#cb101-126" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estimacion_ent_02.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="estimacion_municipios_ipm_pobreza_error.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2023MEXsae/14_estimacion_municipios_ipm_pobreza.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020.pdf", "Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020.epub", "Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

</body>

</html>
