<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10_PostBenchmarking_ic_ali_nc.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020</title>
  <meta name="description" content="Manual de procesamiento." />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="10_PostBenchmarking_ic_ali_nc.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Manual de procesamiento." />
  <meta name="github-repo" content="psirusteam/coneval" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10_PostBenchmarking_ic_ali_nc.R | Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020" />
  
  <meta name="twitter:description" content="Manual de procesamiento." />
  

<meta name="author" content="Andrés Gutiérrez, Stalyn Guerrero" />


<meta name="date" content="2024-07-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="postbenchmarking_ictpc.html"/>
<link rel="next" href="postbenchmarking_ic_segsoc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Manual de procesamiento.</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#respositodio-de-códigos"><i class="fa fa-check"></i>Respositodio de códigos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-proyecto"><i class="fa fa-check"></i>Estructura del Proyecto</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#librerias-de-r-y-otros-insumos"><i class="fa fa-check"></i>Librerias de <em>R</em> y otros insumos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#bases-de-datos-utilizadas"><i class="fa fa-check"></i>Bases de Datos Utilizadas</a></li>
<li class="chapter" data-level="" data-path="indicadores-estimados.html"><a href="indicadores-estimados.html"><i class="fa fa-check"></i>Indicadores estimados</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="union_bases.html"><a href="union_bases.html"><i class="fa fa-check"></i>00_union_bases.R</a></li>
<li class="chapter" data-level="" data-path="descarga_satelitales.html"><a href="descarga_satelitales.html"><i class="fa fa-check"></i>01_Descarga_satelitales.R</a></li>
<li class="chapter" data-level="" data-path="union_predictores.html"><a href="union_predictores.html"><i class="fa fa-check"></i>02_Union_predictores.R</a></li>
<li class="chapter" data-level="" data-path="estandarizar_muestra_cuestionario_ampliado.html"><a href="estandarizar_muestra_cuestionario_ampliado.html"><i class="fa fa-check"></i>03_Estandarizar_muestra_cuestionario_ampliado.R</a></li>
<li class="chapter" data-level="" data-path="armonizar_encuesta.html"><a href="armonizar_encuesta.html"><i class="fa fa-check"></i>04_Armonizar_encuesta.R</a></li>
<li class="chapter" data-level="" data-path="validacion_encuestas.html"><a href="validacion_encuestas.html"><i class="fa fa-check"></i>05_Validacion_encuestas.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_ictpc.html"><a href="modelo_unidad_ictpc.html"><i class="fa fa-check"></i>06_Modelo_unidad_ictpc.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_py_ic_ali_nc.html"><a href="modelo_unidad_py_ic_ali_nc.html"><i class="fa fa-check"></i>07_Modelo_unidad_py_ic_ali_nc.R</a></li>
<li class="chapter" data-level="" data-path="modelo_unidad_py_ic_segsoc.html"><a href="modelo_unidad_py_ic_segsoc.html"><i class="fa fa-check"></i>08_Modelo_unidad_py_ic_segsoc</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ictpc.html"><a href="postbenchmarking_ictpc.html"><i class="fa fa-check"></i>09_PostBenchmarking_ictpc.R</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ic_ali_nc.html"><a href="postbenchmarking_ic_ali_nc.html"><i class="fa fa-check"></i>10_PostBenchmarking_ic_ali_nc.R</a></li>
<li class="chapter" data-level="" data-path="postbenchmarking_ic_segsoc.html"><a href="postbenchmarking_ic_segsoc.html"><i class="fa fa-check"></i>11_PostBenchmarking_ic_segsoc.r</a></li>
<li class="chapter" data-level="" data-path="imputacion_censal.html"><a href="imputacion_censal.html"><i class="fa fa-check"></i>12_Imputacion_censal.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_ent_02.html"><a href="estimacion_ent_02.html"><i class="fa fa-check"></i>13_Estimacion_ent_02.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_ipm_pobreza.html"><a href="estimacion_municipios_ipm_pobreza.html"><i class="fa fa-check"></i>14_estimacion_municipios_ipm_pobreza.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_ipm_pobreza_error.html"><a href="estimacion_municipios_ipm_pobreza_error.html"><i class="fa fa-check"></i>15_estimacion_municipios_ipm_pobreza_error.R</a></li>
<li class="chapter" data-level="" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i>16_Mapas.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html"><i class="fa fa-check"></i>17_estimacion_municipios_carencias.R</a>
<ul>
<li class="chapter" data-level="0.0.1" data-path="estimacion_municipios_carencias.html"><a href="estimacion_municipios_carencias.html#descripción-general"><i class="fa fa-check"></i><b>0.0.1</b> Descripción General</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="estimacion_municipios_carencias_error.html"><a href="estimacion_municipios_carencias_error.html"><i class="fa fa-check"></i>18_estimacion_municipios_carencias_error.R</a></li>
<li class="chapter" data-level="" data-path="mapas_carencias.html"><a href="mapas_carencias.html"><i class="fa fa-check"></i>19_Mapas_carencias.R</a></li>
<li class="chapter" data-level="" data-path="estimacion_directa_carencias.html"><a href="estimacion_directa_carencias.html"><i class="fa fa-check"></i>20_estimacion_directa_carencias.R</a></li>
<li class="divider"></li>
<li><a Manual de procesamiento. </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="postbenchmarking_ic_ali_nc.r" class="section level1 unnumbered hasAnchor">
<h1>10_PostBenchmarking_ic_ali_nc.R<a href="postbenchmarking_ic_ali_nc.html#postbenchmarking_ic_ali_nc.r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Para la ejecución del presente archivo, debe abrir el archivo <strong>10_PostBenchmarking_ic_ali_nc.R</strong> disponible en la ruta <em>Rcodes/2020/10_PostBenchmarking_ic_ali_nc.R</em>.</p>
<p>Este script en R se centra en la validación y benchmarking de un modelo multinivel para predecir la carencia en alimentos nutritivos y de calidad (ic_ali_nc) utilizando datos de encuestas y censos. Comienza limpiando el entorno de trabajo y cargando librerías necesarias. Además, se leen funciones auxiliares desde archivos externos para la validación y el benchmarking. Luego, se carga el modelo preentrenado desde un archivo RDS.</p>
<p>El proceso de benchmarking se realiza con la función <code>benchmarking</code>, utilizando covariables específicas como <code>ent</code>, <code>area</code>, <code>sexo</code>, <code>edad</code>, <code>discapacidad</code> y <code>hlengua</code>, y aplicando el método “logit”. Los resultados se almacenan en <code>list_bench</code>. A continuación, se crea un diseño de encuesta y se realizan validaciones a nivel nacional comparando los resultados del modelo ajustado (<code>yk_stan_lmer</code>) y del modelo ajustado con benchmarking (<code>yk_bench</code>). Estas validaciones se llevan a cabo mediante la comparación de medias ponderadas.</p>
<p>Para validar el modelo a nivel de subgrupos, se definen diversos subgrupos como <code>ent</code>, <code>area</code>, <code>sexo</code>, <code>edad</code>, <code>discapacidad</code>, <code>hlengua</code> y <code>nivel_edu</code>. Se crean gráficos de validación para cada subgrupo utilizando la función <code>plot_uni_validacion</code>. Estos gráficos se combinan y se guardan en un archivo JPG (<code>plot_uni_ic_ali_nc.jpg</code>). Además, se guarda la lista de gráficos y el dataframe postestratificado en archivos RDS (<code>plot_uni_ic_ali_nc.rds</code> y <code>poststrat_df_ic_ali_nc.rds</code> respectivamente), lo que permite una fácil recuperación y análisis posterior.</p>
<div id="limpieza-del-entorno-y-carga-de-bibliotecas-7" class="section level4 unnumbered hasAnchor">
<h4>Limpieza del Entorno y Carga de Bibliotecas<a href="postbenchmarking_ic_ali_nc.html#limpieza-del-entorno-y-carga-de-bibliotecas-7" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El entorno de R se limpia al eliminar todos los objetos actuales y se limpia la consola para asegurar que el análisis comience desde un estado limpio. A continuación, se cargan las bibliotecas necesarias para el análisis, que incluyen <code>scales</code>, <code>patchwork</code>, <code>srvyr</code>, <code>survey</code>, <code>haven</code>, <code>sampling</code>, y <code>tidyverse</code>. Estas bibliotecas proporcionan herramientas para la manipulación de datos, la creación de gráficos, el análisis de encuestas y la realización de muestreos.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="postbenchmarking_ic_ali_nc.html#cb79-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>())</span>
<span id="cb79-2"><a href="postbenchmarking_ic_ali_nc.html#cb79-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\f</span><span class="st">&quot;</span>)</span>
<span id="cb79-3"><a href="postbenchmarking_ic_ali_nc.html#cb79-3" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb79-4"><a href="postbenchmarking_ic_ali_nc.html#cb79-4" tabindex="-1"></a><span class="co"># Loading required libraries ----------------------------------------------</span></span>
<span id="cb79-5"><a href="postbenchmarking_ic_ali_nc.html#cb79-5" tabindex="-1"></a><span class="do">###############################################################</span></span>
<span id="cb79-6"><a href="postbenchmarking_ic_ali_nc.html#cb79-6" tabindex="-1"></a></span>
<span id="cb79-7"><a href="postbenchmarking_ic_ali_nc.html#cb79-7" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb79-8"><a href="postbenchmarking_ic_ali_nc.html#cb79-8" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb79-9"><a href="postbenchmarking_ic_ali_nc.html#cb79-9" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb79-10"><a href="postbenchmarking_ic_ali_nc.html#cb79-10" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb79-11"><a href="postbenchmarking_ic_ali_nc.html#cb79-11" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb79-12"><a href="postbenchmarking_ic_ali_nc.html#cb79-12" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb79-13"><a href="postbenchmarking_ic_ali_nc.html#cb79-13" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="lectura-de-funciones-1" class="section level4 unnumbered hasAnchor">
<h4>Lectura de Funciones<a href="postbenchmarking_ic_ali_nc.html#lectura-de-funciones-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se cargan dos archivos de funciones que serán utilizadas en el análisis: <code>Plot_validacion_bench.R</code> y <code>Benchmarking.R</code>. Estos archivos contienen funciones personalizadas para la validación y el análisis comparativo.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="postbenchmarking_ic_ali_nc.html#cb80-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../source/Plot_validacion_bench.R&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb80-2"><a href="postbenchmarking_ic_ali_nc.html#cb80-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../source/Benchmarking.R&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span></code></pre></div>
</div>
<div id="lectura-del-modelo-1" class="section level4 unnumbered hasAnchor">
<h4>Lectura del Modelo<a href="postbenchmarking_ic_ali_nc.html#lectura-del-modelo-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se lee el modelo ajustado previamente, guardado en un archivo RDS (<code>fit_mrp_ictpc.rds</code>). Este modelo será utilizado para realizar análisis adicionales o generar nuevas predicciones basadas en los datos de entrada.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="postbenchmarking_ic_ali_nc.html#cb81-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../output/2020/modelos/fit_mrp_ic_ali_nc.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="proceso-de-benchmarking-1" class="section level4 unnumbered hasAnchor">
<h4>proceso de benchmarking<a href="postbenchmarking_ic_ali_nc.html#proceso-de-benchmarking-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta sección se realiza el proceso de benchmarking utilizando la función <code>benchmarking</code>, aplicada al modelo previamente ajustado. La función evalúa el rendimiento del modelo y compara los resultados basados en las variables seleccionadas. Se especifican las variables que se consideran en el análisis: <code>ent</code>, <code>area</code>, <code>sexo</code>, <code>edad</code>, <code>discapacidad</code>, y <code>hlengua</code>. El método de benchmarking utilizado es <code>logit</code>, que se emplea para analizar el ajuste del modelo en función de estas variables.</p>
<p>El resultado del proceso de benchmarking se guarda en un archivo RDS (<code>list_bench.rds</code>), que contiene las evaluaciones del modelo. Aunque el código para guardar y cargar este archivo está comentado, se proporciona la estructura para guardar los resultados y posteriormente cargarlos si es necesario.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="postbenchmarking_ic_ali_nc.html#cb82-1" tabindex="-1"></a>list_bench <span class="ot">&lt;-</span> <span class="fu">benchmarking</span>(<span class="at">modelo =</span> fit,</span>
<span id="cb82-2"><a href="postbenchmarking_ic_ali_nc.html#cb82-2" tabindex="-1"></a>             <span class="at">names_cov =</span>   <span class="fu">c</span>(<span class="st">&quot;ent&quot;</span>,</span>
<span id="cb82-3"><a href="postbenchmarking_ic_ali_nc.html#cb82-3" tabindex="-1"></a>                             <span class="st">&quot;area&quot;</span>,</span>
<span id="cb82-4"><a href="postbenchmarking_ic_ali_nc.html#cb82-4" tabindex="-1"></a>                             <span class="st">&quot;sexo&quot;</span>,</span>
<span id="cb82-5"><a href="postbenchmarking_ic_ali_nc.html#cb82-5" tabindex="-1"></a>                             <span class="st">&quot;edad&quot;</span>,</span>
<span id="cb82-6"><a href="postbenchmarking_ic_ali_nc.html#cb82-6" tabindex="-1"></a>                             <span class="st">&quot;discapacidad&quot;</span>,</span>
<span id="cb82-7"><a href="postbenchmarking_ic_ali_nc.html#cb82-7" tabindex="-1"></a>                             <span class="st">&quot;hlengua&quot;</span>),                      </span>
<span id="cb82-8"><a href="postbenchmarking_ic_ali_nc.html#cb82-8" tabindex="-1"></a>             <span class="at">metodo =</span> <span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div id="validaciones-benchmarking-1" class="section level4 unnumbered hasAnchor">
<h4>Validaciones benchmarking<a href="postbenchmarking_ic_ali_nc.html#validaciones-benchmarking-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta sección se llevan a cabo validaciones del modelo y se comparan los resultados con los datos de la encuesta. Primero, se prepara un DataFrame <code>poststrat_df</code> que incluye las predicciones del modelo (<code>yk_lmer</code>) y un ajuste de benchmarking (<code>yk_bench</code>). Esto permite comparar las estimaciones del modelo con los datos observados.</p>
<p>Luego, se crea un objeto de diseño de encuesta <code>diseno_encuesta</code> utilizando la función <code>as_survey_design</code> para aplicar los pesos de encuesta a los datos. Se calculan las medias de las predicciones del modelo y de los datos directos para verificar la consistencia entre ambos.</p>
<p>Para la validación nacional, se comparan las estimaciones nacionales obtenidas de la encuesta y del modelo. Esto se realiza mediante la comparación de las medias estimadas a nivel nacional del diseño de encuesta (<code>Nacional_dir</code>), el modelo ajustado (<code>Nacional_lmer</code>), y el benchmarking (<code>Nacional_bench</code>). Los resultados se resumen en un <code>cbind</code> para facilitar la comparación.</p>
<p>Este proceso de validación permite evaluar la precisión del modelo y asegurar que sus estimaciones sean consistentes con los datos observados y con los ajustes de benchmarking.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="postbenchmarking_ic_ali_nc.html#cb83-1" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> fit<span class="sc">$</span>poststrat_df <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb83-2"><a href="postbenchmarking_ic_ali_nc.html#cb83-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_stan_lmer =</span> yk,</span>
<span id="cb83-3"><a href="postbenchmarking_ic_ali_nc.html#cb83-3" tabindex="-1"></a>         <span class="at">gk_bench =</span> list_bench<span class="sc">$</span>gk_bench,</span>
<span id="cb83-4"><a href="postbenchmarking_ic_ali_nc.html#cb83-4" tabindex="-1"></a>         <span class="at">yk_bench =</span> yk <span class="sc">*</span> gk_bench )</span>
<span id="cb83-5"><a href="postbenchmarking_ic_ali_nc.html#cb83-5" tabindex="-1"></a></span>
<span id="cb83-6"><a href="postbenchmarking_ic_ali_nc.html#cb83-6" tabindex="-1"></a>diseno_encuesta <span class="ot">&lt;-</span> fit<span class="sc">$</span>encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb83-7"><a href="postbenchmarking_ic_ali_nc.html#cb83-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> yk) <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="postbenchmarking_ic_ali_nc.html#cb83-8" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fep)</span>
<span id="cb83-9"><a href="postbenchmarking_ic_ali_nc.html#cb83-9" tabindex="-1"></a></span>
<span id="cb83-10"><a href="postbenchmarking_ic_ali_nc.html#cb83-10" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">predict</span>(fit<span class="sc">$</span>fit_mrp,<span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span>
<span id="cb83-11"><a href="postbenchmarking_ic_ali_nc.html#cb83-11" tabindex="-1"></a><span class="fu">mean</span>(diseno_encuesta<span class="sc">$</span>variables<span class="sc">$</span>yk)</span>
<span id="cb83-12"><a href="postbenchmarking_ic_ali_nc.html#cb83-12" tabindex="-1"></a></span>
<span id="cb83-13"><a href="postbenchmarking_ic_ali_nc.html#cb83-13" tabindex="-1"></a><span class="do">## validación nacional.</span></span>
<span id="cb83-14"><a href="postbenchmarking_ic_ali_nc.html#cb83-14" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb83-15"><a href="postbenchmarking_ic_ali_nc.html#cb83-15" tabindex="-1"></a>  diseno_encuesta <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Nacional_dir =</span> <span class="fu">survey_mean</span>(yk_dir)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-16"><a href="postbenchmarking_ic_ali_nc.html#cb83-16" tabindex="-1"></a>    <span class="fu">select</span>(Nacional_dir),</span>
<span id="cb83-17"><a href="postbenchmarking_ic_ali_nc.html#cb83-17" tabindex="-1"></a>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb83-18"><a href="postbenchmarking_ic_ali_nc.html#cb83-18" tabindex="-1"></a>    <span class="at">Nacional_stan_lmer =</span> <span class="fu">sum</span>(n <span class="sc">*</span> yk_stan_lmer) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb83-19"><a href="postbenchmarking_ic_ali_nc.html#cb83-19" tabindex="-1"></a>    <span class="at">Nacional_bench =</span> <span class="fu">sum</span>(n <span class="sc">*</span> yk_bench) <span class="sc">/</span> <span class="fu">sum</span>(n<span class="sc">*</span>gk_bench),</span>
<span id="cb83-20"><a href="postbenchmarking_ic_ali_nc.html#cb83-20" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code></pre></div>
</div>
<div id="validaciones-por-subgrupo-completo-1" class="section level4 unnumbered hasAnchor">
<h4>Validaciones por subgrupo completo<a href="postbenchmarking_ic_ali_nc.html#validaciones-por-subgrupo-completo-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta sección, se realiza una validación exhaustiva del modelo ajustado, evaluando su desempeño a nivel de diversos subgrupos. Los subgrupos se definen en el vector <code>subgrupo</code>, que incluye variables como <code>ent</code>, <code>area</code>, <code>sexo</code>, <code>edad</code>, <code>discapacidad</code>, <code>hlengua</code>, y <code>nivel_edu</code>.</p>
<p>La función <code>plot_uni_validacion</code> se utiliza para generar gráficos y tablas de validación para cada uno de estos subgrupos. Estos gráficos y tablas permiten comparar las estimaciones obtenidas mediante el modelo (<code>stan_lmer</code>) con los datos directos (<code>directo</code>) para cada subgrupo, calculando también el error relativo (ER), que refleja la diferencia porcentual entre las dos estimaciones.</p>
<p>Para el subgrupo <code>sexo</code>, se genera una tabla que muestra el error relativo calculado para cada categoría dentro del subgrupo, ordenado por el tamaño de la muestra (<code>n_sample</code>). Los gráficos generados para cada subgrupo se combinan en un único gráfico utilizando <code>patchwork</code>. Este gráfico combinado permite una visualización comparativa clara entre todos los subgrupos definidos.</p>
<p>Finalmente, el gráfico combinado se guarda como una imagen JPG en el directorio de salida, y los objetos <code>plot_subgrupo</code> y <code>poststrat_df</code> se almacenan en archivos RDS. Estos archivos proporcionan una referencia detallada de la validación del modelo a nivel de subgrupo, permitiendo revisiones y análisis adicionales si es necesario.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="postbenchmarking_ic_ali_nc.html#cb84-1" tabindex="-1"></a>subgrupo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ent&quot;</span>,</span>
<span id="cb84-2"><a href="postbenchmarking_ic_ali_nc.html#cb84-2" tabindex="-1"></a>              <span class="st">&quot;area&quot;</span>,</span>
<span id="cb84-3"><a href="postbenchmarking_ic_ali_nc.html#cb84-3" tabindex="-1"></a>              <span class="st">&quot;sexo&quot;</span>,</span>
<span id="cb84-4"><a href="postbenchmarking_ic_ali_nc.html#cb84-4" tabindex="-1"></a>              <span class="st">&quot;edad&quot;</span>,</span>
<span id="cb84-5"><a href="postbenchmarking_ic_ali_nc.html#cb84-5" tabindex="-1"></a>              <span class="st">&quot;discapacidad&quot;</span>,</span>
<span id="cb84-6"><a href="postbenchmarking_ic_ali_nc.html#cb84-6" tabindex="-1"></a>              <span class="st">&quot;hlengua&quot;</span>,<span class="st">&quot;nivel_edu&quot;</span>)</span>
<span id="cb84-7"><a href="postbenchmarking_ic_ali_nc.html#cb84-7" tabindex="-1"></a></span>
<span id="cb84-8"><a href="postbenchmarking_ic_ali_nc.html#cb84-8" tabindex="-1"></a></span>
<span id="cb84-9"><a href="postbenchmarking_ic_ali_nc.html#cb84-9" tabindex="-1"></a>plot_subgrupo <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb84-10"><a href="postbenchmarking_ic_ali_nc.html#cb84-10" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(subgrupo, subgrupo),</span>
<span id="cb84-11"><a href="postbenchmarking_ic_ali_nc.html#cb84-11" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_uni_validacion</span>(</span>
<span id="cb84-12"><a href="postbenchmarking_ic_ali_nc.html#cb84-12" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno_encuesta,</span>
<span id="cb84-13"><a href="postbenchmarking_ic_ali_nc.html#cb84-13" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb84-14"><a href="postbenchmarking_ic_ali_nc.html#cb84-14" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb84-15"><a href="postbenchmarking_ic_ali_nc.html#cb84-15" tabindex="-1"></a>  )</span>
<span id="cb84-16"><a href="postbenchmarking_ic_ali_nc.html#cb84-16" tabindex="-1"></a>)</span>
<span id="cb84-17"><a href="postbenchmarking_ic_ali_nc.html#cb84-17" tabindex="-1"></a></span>
<span id="cb84-18"><a href="postbenchmarking_ic_ali_nc.html#cb84-18" tabindex="-1"></a></span>
<span id="cb84-19"><a href="postbenchmarking_ic_ali_nc.html#cb84-19" tabindex="-1"></a>plot_subgrupo<span class="sc">$</span>sexo<span class="sc">$</span>tabla <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n_sample) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-20"><a href="postbenchmarking_ic_ali_nc.html#cb84-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ER =</span> <span class="fu">abs</span>((directo <span class="sc">-</span> stan_lmer)<span class="sc">/</span>directo )<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-21"><a href="postbenchmarking_ic_ali_nc.html#cb84-21" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(sexo<span class="sc">:</span>directo_upp,stan_lmer, ER)</span>
<span id="cb84-22"><a href="postbenchmarking_ic_ali_nc.html#cb84-22" tabindex="-1"></a></span>
<span id="cb84-23"><a href="postbenchmarking_ic_ali_nc.html#cb84-23" tabindex="-1"></a>plot_subgrupo<span class="sc">$</span>ent<span class="sc">$</span>gg_plot</span>
<span id="cb84-24"><a href="postbenchmarking_ic_ali_nc.html#cb84-24" tabindex="-1"></a></span>
<span id="cb84-25"><a href="postbenchmarking_ic_ali_nc.html#cb84-25" tabindex="-1"></a>plot_subgrupo<span class="sc">$</span>sexo<span class="sc">$</span>gg_plot <span class="sc">+</span> plot_subgrupo<span class="sc">$</span>nivel_edu<span class="sc">$</span>gg_plot <span class="sc">+</span></span>
<span id="cb84-26"><a href="postbenchmarking_ic_ali_nc.html#cb84-26" tabindex="-1"></a>  plot_subgrupo<span class="sc">$</span>edad<span class="sc">$</span>gg_plot <span class="sc">+</span> plot_subgrupo<span class="sc">$</span>hlengua<span class="sc">$</span>gg_plot <span class="sc">+</span></span>
<span id="cb84-27"><a href="postbenchmarking_ic_ali_nc.html#cb84-27" tabindex="-1"></a>  plot_subgrupo<span class="sc">$</span>area<span class="sc">$</span>gg_plot <span class="sc">+</span> plot_subgrupo<span class="sc">$</span>discapacidad<span class="sc">$</span>gg_plot  </span>
<span id="cb84-28"><a href="postbenchmarking_ic_ali_nc.html#cb84-28" tabindex="-1"></a></span>
<span id="cb84-29"><a href="postbenchmarking_ic_ali_nc.html#cb84-29" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> plot_subgrupo<span class="sc">$</span>ent<span class="sc">$</span>gg_plot  <span class="sc">/</span></span>
<span id="cb84-30"><a href="postbenchmarking_ic_ali_nc.html#cb84-30" tabindex="-1"></a>  (</span>
<span id="cb84-31"><a href="postbenchmarking_ic_ali_nc.html#cb84-31" tabindex="-1"></a>    plot_subgrupo<span class="sc">$</span>sexo<span class="sc">$</span>gg_plot <span class="sc">+</span> plot_subgrupo<span class="sc">$</span>nivel_edu<span class="sc">$</span>gg_plot <span class="sc">+</span></span>
<span id="cb84-32"><a href="postbenchmarking_ic_ali_nc.html#cb84-32" tabindex="-1"></a>      plot_subgrupo<span class="sc">$</span>edad<span class="sc">$</span>gg_plot <span class="sc">+</span> plot_subgrupo<span class="sc">$</span>hlengua<span class="sc">$</span>gg_plot <span class="sc">+</span></span>
<span id="cb84-33"><a href="postbenchmarking_ic_ali_nc.html#cb84-33" tabindex="-1"></a>      plot_subgrupo<span class="sc">$</span>area<span class="sc">$</span>gg_plot <span class="sc">+</span> plot_subgrupo<span class="sc">$</span>discapacidad<span class="sc">$</span>gg_plot</span>
<span id="cb84-34"><a href="postbenchmarking_ic_ali_nc.html#cb84-34" tabindex="-1"></a>  )</span>
<span id="cb84-35"><a href="postbenchmarking_ic_ali_nc.html#cb84-35" tabindex="-1"></a></span>
<span id="cb84-36"><a href="postbenchmarking_ic_ali_nc.html#cb84-36" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> plot_uni,</span>
<span id="cb84-37"><a href="postbenchmarking_ic_ali_nc.html#cb84-37" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;../output/2020/modelos/plot_uni_ic_ali_nc.jpg&quot;</span>,</span>
<span id="cb84-38"><a href="postbenchmarking_ic_ali_nc.html#cb84-38" tabindex="-1"></a>       <span class="at">scale =</span> <span class="dv">3</span>)</span>
<span id="cb84-39"><a href="postbenchmarking_ic_ali_nc.html#cb84-39" tabindex="-1"></a></span>
<span id="cb84-40"><a href="postbenchmarking_ic_ali_nc.html#cb84-40" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="at">object =</span>  plot_subgrupo,</span>
<span id="cb84-41"><a href="postbenchmarking_ic_ali_nc.html#cb84-41" tabindex="-1"></a>        <span class="at">file =</span> <span class="st">&quot;../output/2020/modelos/plot_uni_ic_ali_nc.rds&quot;</span>)</span>
<span id="cb84-42"><a href="postbenchmarking_ic_ali_nc.html#cb84-42" tabindex="-1"></a></span>
<span id="cb84-43"><a href="postbenchmarking_ic_ali_nc.html#cb84-43" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="at">object =</span>  poststrat_df,</span>
<span id="cb84-44"><a href="postbenchmarking_ic_ali_nc.html#cb84-44" tabindex="-1"></a>        <span class="at">file =</span> <span class="st">&quot;../input/2020/muestra_ampliada/poststrat_df_ic_ali_nc.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="postbenchmarking_ictpc.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="postbenchmarking_ic_segsoc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2023MEXsae/10_PostBenchmarking_ic_ali_nc.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020.pdf", "Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020.epub", "Manual de procesamiento del indicador de pobreza multidimensional mediante el uso de estimación de áreas pequeñas para México 2020.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

</body>

</html>
